import{_ as e}from"./index.vue_vue_type_style_index_0_lang-33584002.js";import{d as a,L as l,o as t,c as s,e as u,f as r,g as i,z as n,aZ as o,r as p,v as d,a as c,b as m,A as v,N as f,w as g,l as b,m as x,a_ as h,F as _,j as w,y,h as k,t as I,aF as j,a$ as C,b0 as D,b1 as q,aA as z,ag as U,ap as A,b2 as R,b3 as N,b4 as L}from"./index-62750275.js";import{_ as E}from"./appCard.vue_vue_type_script_setup_true_lang-8ad03fcd.js";import{N as F}from"./Select-e3a2205c.js";import{N as M}from"./Upload-3cc5e7bf.js";import{N as P}from"./Switch-68d9c753.js";import{_ as S,a as V}from"./Grid-f8a825d9.js";import{_ as G}from"./WishLayoutSilder.vue_vue_type_script_setup_true_lang-983a17ef.js";import"./Dropdown-0073002d.js";import"./Ellipsis-e9b4b389.js";import"./Popconfirm-b5167f80.js";const H={class:"m-auto flex h-14 max-w-screen-4xl items-center justify-between px-4"},O={class:"flex min-w-0 flex-1 items-center space-x-2 overflow-hidden pr-2"},T=u("h2",{class:"text-base font-bold"}," 我的自定义工作台 ",-1),W=u("div",{class:"flex items-center space-x-2"},null,-1),$=a({__name:"header",setup(e){const a=l();return(e,l)=>(t(),s("div",H,[u("div",O,[u("button",{onClick:l[0]||(l[0]=e=>r(a).go(-1))},[i(r(n),{class:"text-xl",icon:"ri:arrow-left-s-line"})]),T]),W]))}}),Q={class:"w-full h-full flex justify-center dark:bg-[#1C1E24]"},Z={class:"p-6 max-w-screen-4xl px-4 w-full"},B={class:"flex flex-col space-y-3 justify-between sm:flex-row sm:space-y-0"},J={class:"sm:w-full md:w-[300px] sm:mb-3 2xl:w-[380px]"},K=u("div",{class:"h-[10px]"},null,-1),X={class:"p-5 bg-white rounded dark:bg-slate-800"},Y={class:"font-bold text-base"},ee={class:"pt-5 mt-6"},ae=u("p",null,"Tips: 请知悉",-1),le=u("p",null,"选择共享提交之后审核状态将无法编辑应用",-1),te=u("p",null,"审核通过的应用将会在应用广场公开展示",-1),se=u("p",null,"管理审核通过后将会赠送一定的站内额度奖励用户",-1),ue=u("p",null,"一旦提交处于审核中、您将不能再编辑此应用",-1),re=a({__name:"main",setup(e){const a=o(),G=p(""),H=p(!1),O=p(!1),T=p([]),W=p(null),$=p(0),re=p(!1),ie=d((()=>0===$.value?"创建我的个人应用":"更新我的个人应用")),ne=d((()=>0===$.value?"创建专属应用":"更新个人应用")),oe=d((()=>G.value?a.mineApps.filter((e=>e.appName.includes(G.value))):a.mineApps)),pe=p("/api/upload/file"),de=p({catId:null,name:null,preset:null,des:null,demoData:"",coverImg:"",public:!1}),ce={catId:[{required:!0,message:"请选择分类"}],name:[{required:!0,message:"请输入应用名称",trigger:"blur"},{min:2,max:30,message:"长度应为2到10个字符之间",trigger:"blur"}],preset:[{required:!0,message:"请输入预设prompt",trigger:"blur"},{min:6,max:1200,message:"长度应为6到1200个字符之间",trigger:"blur"}],des:[{required:!0,message:"请输入简短的应用描述",trigger:"blur"},{max:50,message:"长度应为0到50个字符之间",trigger:"blur"}],demoData:[{required:!0,message:"请输入示例数据、按回车换行表示新增一条",trigger:"blur"},{max:100,message:"长度应为0到100个字符之间",trigger:"blur"}],coverImg:[{required:!0,message:"请上传应用Logo",trigger:"change"}],public:[{required:!0,message:"请选择是否公开"}]};c();const me=m(),ve=l(),fe=p([]),ge=p(null);function be(e){G.value=e}async function xe(){const e=await L();fe.value=e.data.rows}async function he(e){if(e.length){const a=e[0].file;ge.value=a;const l=new FormData;l.append("file",a);const t=await R.post(pe.value,l,{headers:{"Content-Type":"multipart/form-data"}});t.data.data?de.value.coverImg=t.data.data:me.error("上传图片失败、请检查后再试试吧！")}else ge.value=null}function _e({file:e,fileList:a}){return new Promise(((a,l)=>{const{size:t,type:s}=e.file;return"image/png"!==s&&"image/jpg"!==s&&"image/jpeg"!==s?(me.error("只能上传png/jpg/jpeg格式的图片"),a(!1)):t>307200?(me.error("图片大小不能超过300k"),a(!1)):void a(!0)}))}function we(){O.value=!0,xe()}function ye(){}function ke(){Ie()}function Ie(){$.value=0,re.value=!1,de.value={catId:null,name:null,preset:null,des:null,demoData:"",coverImg:"",public:!1}}async function je(e){await xe();const{catId:a,appName:l,preset:t,appDes:s,demoData:u,coverImg:r,public:i}=e;Object.assign(de.value,{catId:a,name:l,preset:t,des:s,demoData:u,coverImg:r,public:i}),$.value=e.appId,O.value=!0,re.value=e.public}function Ce(){var e;null==(e=W.value)||e.validate((async e=>{if(!e){const e=de.value;$.value&&(e.appId=$.value);const l=await N(e),t=$.value?"个人应用修改完成！":"个人应用创建完成！";l.success&&me.success(t),a.queryMineApps(),Ie(),O.value=!1}}))}return v((()=>{!oe.value.length&&a.queryMineApps()})),(e,a)=>{const l=S,o=V;return t(),s(_,null,[u("div",Q,[u("div",Z,[u("div",B,[u("div",J,[i(r(f),{modelValue:G.value,"onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),type:"text",placeholder:`您一共收录了${oe.value.length}个应用(关键词过滤)`,onInput:be},null,8,["modelValue","placeholder"])]),i(r(h),null,{default:g((()=>[i(r(b),{onClick:we},{icon:g((()=>[i(r(n),{icon:"gridicons:create"})])),default:g((()=>[x(" 创建自定义应用 ")])),_:1}),i(r(b),{type:"primary",onClick:a[1]||(a[1]=e=>r(ve).push("/app-store"))},{icon:g((()=>[i(r(n),{icon:"ri:add-line"})])),default:g((()=>[x(" 前往广场添加应用 ")])),_:1})])),_:1})]),K,i(o,{"item-responsive":"",cols:"1 s:2 m:3 l:3 xl:4 2xl:4","x-gap":"15px","y-gap":"15px",responsive:"screen"},{default:g((()=>[(t(!0),s(_,null,w(oe.value,(e=>(t(),y(l,{onClick:a=>async function(e){const a=await A(),{modelMaps:l}=a.data;if(!l[1])return me.warning("管理员未配置特定应用模型、请联系管理员配置~");ve.replace({path:"/chat",query:{appId:e.appId}})}(e),key:e.appId},{default:g((()=>[i(E,{onHandlerEditApp:je,type:"chat",item:e},null,8,["item"])])),_:2},1032,["onClick"])))),128))])),_:1}),k("",!0)])]),i(r(U),{show:O.value,title:"创建",style:{width:"90%","max-width":"640px"},"mask-closable":!1,"on-after-enter":ye,"on-after-leave":ke},{default:g((()=>[u("div",X,[u("div",{class:"absolute top-4 left-5 cursor-pointer z-30",onClick:a[4]||(a[4]=e=>O.value=!1)},[u("span",Y,I(ne.value),1)]),u("div",{class:"absolute top-3 right-3 cursor-pointer z-30",onClick:a[5]||(a[5]=e=>O.value=!1)},[i(r(j),{size:"20",color:"#0e7a0d"},{default:g((()=>[i(r(C))])),_:1})]),u("div",ee,[i(r(D),{ref_key:"formRef",ref:W,model:de.value,rules:ce,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",style:{maxWidth:"640px"}},{default:g((()=>[i(r(q),{label:"应用分类",path:"catId"},{default:g((()=>[i(r(F),{value:de.value.catId,"onUpdate:value":a[6]||(a[6]=e=>de.value.catId=e),clearable:"",size:"small","label-field":"name",placeholder:"请输入您的应用分类","value-field":"id",options:fe.value},null,8,["value","options"])])),_:1}),i(r(q),{label:"应用名称",path:"name"},{default:g((()=>[i(r(f),{value:de.value.name,"onUpdate:value":a[7]||(a[7]=e=>de.value.name=e),placeholder:"请输入您的应用名称",type:"name",maxlength:30,"show-name-on":"click",tabindex:"0"},null,8,["value"])])),_:1}),i(r(q),{label:"预设指令",path:"preset"},{default:g((()=>[i(r(f),{value:de.value.preset,"onUpdate:value":a[8]||(a[8]=e=>de.value.preset=e),max:255,autosize:{minRows:3,maxRows:10},type:"textarea",placeholder:"请填写prompt预设指令（核心）"},null,8,["value"])])),_:1}),i(r(q),{label:"应用描述",path:"des"},{default:g((()=>[i(r(f),{value:de.value.des,"onUpdate:value":a[9]||(a[9]=e=>de.value.des=e),autosize:{minRows:3,maxRows:10},type:"textarea",placeholder:"请对你的应用做以简要的描述以便于大家认识它！"},null,8,["value"])])),_:1}),i(r(q),{label:"示例内容",path:"demoData"},{default:g((()=>[i(r(f),{value:de.value.demoData,"onUpdate:value":a[10]||(a[10]=e=>de.value.demoData=e),autosize:{minRows:3,maxRows:10},type:"textarea",placeholder:"请填写一个示例、方便快速告诉别人如何使用、每点击回车换行一次则是新增一条示例！"},null,8,["value"])])),_:1}),i(r(q),{label:"应用Logo",path:"coverImg"},{default:g((()=>[i(r(M),{"on-update:file-list":he,"on-before-upload":_e,max:1,"default-upload":!1,action:pe.value,"default-file-list":T.value,"list-type":"image-card"},{default:g((()=>[x(" 点击上传 ")])),_:1},8,["action","default-file-list"])])),_:1}),i(r(q),{label:"是否共享",path:"public"},{default:g((()=>[i(r(P),{value:de.value.public,"onUpdate:value":a[11]||(a[11]=e=>de.value.public=e),disabled:re.value},null,8,["value","disabled"]),i(r(z),{placement:"top-start",trigger:"hover"},{trigger:g((()=>[i(r(n),{icon:"ri:error-warning-line",class:"text-base ml-3 cursor-pointer"})])),default:g((()=>[ae,le,te,se,ue])),_:1})])),_:1}),i(r(q),{class:"mt-3"},{default:g((()=>[i(r(b),{block:"",type:"primary",disabled:H.value,loading:H.value,onClick:Ce},{default:g((()=>[x(I(ie.value),1)])),_:1},8,["disabled","loading"])])),_:1})])),_:1},8,["model"])])])])),_:1},8,["show"])],64)}}}),ie={class:"flex h-full w-full flex-col bg-white dark:bg-[#111114]"},ne={class:"sticky left-0 right-0 top-0 z-40 border-b bg-white dark:border-b-neutral-800 dark:bg-[#111114]"},oe=a({__name:"index",setup:e=>(e,a)=>(t(),s("div",ie,[u("header",ne,[i($)]),i(re)]))}),pe={class:"h-full dark:bg-[#24272e] transition-all"},de=a({__name:"role",setup:a=>(a,l)=>(t(),s("div",pe,[i(G,{width:300},{slider:g((()=>[i(e)])),content:g((()=>[i(oe)])),_:1})]))});export{de as default};
