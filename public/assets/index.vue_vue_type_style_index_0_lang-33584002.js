import{a0 as e,z as t,d as a,a4 as l,a5 as s,J as i,o as n,c as o,e as u,y as c,g as r,w as p,m as d,t as v,C as f,f as y,n as m,_ as x,r as g,O as k,h,F as b,j as S,a as w,L as C,an as I,a6 as _,K as A,v as G,A as M,b5 as D,u as F,b as T,l as j,N as P,D as B,E as L,W as q,M as K,G as R,H as E}from"./index-62750275.js";import{_ as W}from"./Dropdown-0073002d.js";import{_ as z}from"./Ellipsis-e9b4b389.js";const H=a=>()=>e(t,{icon:a}),N={class:"font-bold flex items-center gap-1"},U=["src"],$={class:"flex gap-2 icon"},J=x(a({__name:"ListItemInfo",props:{dataSources:{},title:{},item:{}},emits:["update","delete","sticky","select"],setup(e,{emit:a}){const x=l(),g=s(),k=i(),h=a,b=e;const S=e=>{switch(e){case"sticky":!async function(e,t){null==t||t.stopPropagation(),await x.updateGroupInfo({isSticky:!e.isSticky,groupId:e.uuid}),await x.queryMyGroup()}(b.item);break;case"del":g.warning({title:"删除对话组",content:"确定删除该对话组吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{!async function(e,t){null==t||t.stopPropagation(),h("delete",e)}(b.item)}})}};return(e,a)=>{const l=t,s=z,i=W;return n(),o("div",{class:m(["new-toast bg-[#F5F6F8] dark:bg-[#353944] hover:bg-[--primarySecondColor] hover:dark:bg-[--darkPrimaryColor] hover:text-[--primaryColor] hover:dark:text-[#fff] border flex justify-between primaryRadius relative px-5 py-3 items-center cursor-pointer transition-all duration-300 ease-in-out",[(g=e.item.uuid,x.active===g&&"bg-[--primarySecondColor] dark:bg-[--darkPrimaryColor] text-[--primaryColor] dark:text-[#fff]"),e.item.isSticky&&"active"]]),key:`${e.item.uuid}`,onClick:a[1]||(a[1]=t=>async function(e){h("select",e)}(e.item))},[u("div",N,[e.item.appLogo?(n(),o("img",{key:1,class:"w-[30px] h-[30px]",src:e.item.appLogo},null,8,U)):(n(),c(l,{key:0,class:"text-[20px]",icon:"tabler:message-2"})),r(s,{style:{"max-width":"100px"}},{default:p((()=>[d(v(e.item.title),1)])),_:1})]),u("div",$,[r(l,{onClick:a[0]||(a[0]=f((e=>y(k).updateModelDialog(!0)),["stop"])),class:"cursor-pointer",icon:"jam:write-f"}),r(i,{trigger:"hover",options:[{label:e.item.isSticky?"取消置顶":"置顶",key:"sticky",icon:e.item.isSticky?y(H)("ri:unpin-line"):y(H)("ri:pushpin-2-line")},{label:"删除",key:"del",icon:y(H)("ic:outline-delete")}],onSelect:S},{default:p((()=>[r(l,{class:"cursor-pointer text-[15px]",icon:e.item.isSticky?"ri:pushpin-2-line":"icon-park-outline:more-three"},null,8,["icon"])])),_:1},8,["options"])])],2);var g}}}),[["__scopeId","data-v-f00c475c"]]),O={key:0,class:"mb-2 text-xs text-neutral-400 font-bold"},X={class:"ml-1"},Q=a({__name:"ListItem",props:{dataSources:{},title:{}},emits:["update","delete","sticky","select"],setup(e,{emit:t}){const a=e,s=t,i=g(a.dataSources||[]);async function r(e){s("select",e)}k((()=>a.dataSources),(e=>{i.value=e})),l();const p=function(e,t){let a;return(...l)=>{clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),e(...l)}),t)}}((async function(e,t){null==t||t.stopPropagation(),s("delete",e)}),600);return(e,t)=>{var l;return n(),o(b,null,[a.title?(n(),o("p",O,[d(v(a.title)+" ",1),u("span",X,"("+v(null==(l=e.dataSources)?void 0:l.length)+")",1)])):h("",!0),(n(!0),o(b,null,S(y(i),(e=>(n(),c(J,{item:e,key:e.uuid,onDelete:y(p),onSelect:r},null,8,["item","onDelete"])))),128))],64)}}}),V={class:"flex flex-col gap-3 text-sm"},Y={key:0,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},Z=a({__name:"List",setup(e){const{isMobile:a}=w(),s=C(),i=I(),d=_(),f=l(),m=A(),x=g(100),S=G((()=>f.groupList)),F=G((()=>f.groupKeyWord));function T(e){const t=new Date(e).getTime()+288e5;return new Date(t).getTime()}k(S,(()=>x.value=x.value+1)),k(F,(()=>x.value=x.value+1)),G((()=>m.isLogin));const j=(new Date).setHours(0,0,0,0),P=G((()=>F.value?S.value.filter((e=>e.title.includes(F.value)&&!e.appId)):S.value.filter((e=>!e.appId)))),B=G((()=>S.value.filter((e=>F.value?e.title.includes(F.value)&&e.isSticky&&!e.appId:e.isSticky&&!e.appId))));G((()=>S.value.filter((e=>F.value?e.title.includes(F.value)&&!e.isSticky&&e.appId:!e.isSticky&&e.appId))));const L=G((()=>S.value.filter((e=>F.value?e.title.includes(F.value)&&!e.isSticky&&!e.appId&&T(e.createdAt)>=j:!e.isSticky&&!e.appId&&T(e.createdAt)>=j)))),q=G((()=>S.value.filter((e=>F.value?e.title.includes(F.value)&&!e.isSticky&&!e.appId&&T(e.createdAt)<j:!e.isSticky&&!e.appId&&T(e.createdAt)<j))));async function K(e){const{uuid:t}=e;(function(e){return f.active===e})(t)||(await f.setActiveGroup(t),"chat"!==i.name&&s.push("/chat"),a.value&&d.setSiderCollapsed(!0))}async function R(e){null==event||event.stopPropagation(),await f.deleteGroup(e),await f.queryMyGroup(),a.value&&d.setSiderCollapsed(!0)}return M((()=>{f.queryMyGroup()})),(e,a)=>(n(),c(y(D),{class:""},{default:p((()=>[u("div",V,[S.value.length?(n(),o(b,{key:1},[(n(),c(Q,{key:4e3+x.value,"data-sources":P.value,onSelect:K,onDelete:R},null,8,["data-sources"])),(B.value.length,h("",!0)),(L.value.length,h("",!0)),(q.value.length,h("",!0))],64)):(n(),o("div",Y,[r(y(t),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),u("span",null,v(e.$t("common.noData")),1)]))])])),_:1}))}}),ee={class:"flex flex-col h-full flex-1 min-h-0 p-2 space-y-[10px]"},te={key:0,class:"h-[50px]"},ae={class:"flex justify-between items-center gap-4"},le=u("span",{class:"font-bold text-[20px]"},"智能对话",-1),se={class:"flex"},ie={class:"flex-1 min-h-0 overflow-hidden"},ne={class:"flex flex-col gap-2"},oe={class:"bg-white flex flex-col p-2 gap-3 dark:bg-[#1C1E24]"},ue={class:"flex items-center justify-between bg-[#F7F7FA] dark:bg-[#353944] p-1 primaryRadius px-5 text-[12px]"},ce={class:"flex gap-2"},re=u("span",{class:"text-[#7B7D80] dark:text-[white]"},"普通积分",-1),pe={class:"flex items-center gap-1"},de={class:"flex items-center justify-between bg-[#F7F7FA] dark:bg-[#353944] p-1 primaryRadius px-5 text-[12px]"},ve={class:"flex gap-2"},fe=u("span",{class:"text-[#7B7D80] dark:text-[white]"},"高级积分",-1),ye={class:"flex items-center gap-1"},me={class:"flex justify-between space-x-[5px] items-center"},xe={class:"flex items-center gap-1"},ge=u("div",null,"清空非置顶记录",-1),ke={class:"flex gap-1 items-center"},he=u("span",null,"前往工作台",-1),be=a({__name:"index",props:{isShowAide:{type:Boolean}},setup(e){const a=g(100),f=e,x=g("history"),b=F();k((()=>f.isShowAide),(()=>{f.isShowAide?x.value="aide":x.value="history"}),{immediate:!0,deep:!0});const S=G((()=>N.groupList)),D=G((()=>S.value.filter((e=>Me.value?e.title.includes(Me.value)&&e.appId:e.appId))));G((()=>S.value.filter((e=>Me.value?e.title.includes(Me.value)&&e.isSticky&&e.appId:e.isSticky&&e.appId)))),i();const W=I(),z=C(),H=_(),N=l(),U=A();T();const $=g(null),J=g(null),O=G((()=>U.userBalance)),X=s(),V=G((()=>U.globalConfig));G((()=>null==N?void 0:N.activeModelKeyDeductType)),G((()=>null==N?void 0:N.activeModelKeyPrice));const Y=g(0),be=g(0),Se=g(0),we=g(0),Ce=g(!1),Ie=g(null);k((()=>U.userBalance.useModel3Token),((e,t)=>{var a;Y.value=t||0,be.value=e||0,null==(a=$.value)||a.play()}),{immediate:!0,flush:"post"}),k((()=>U.userBalance.useModel4Token),((e,t)=>{var a;Se.value=t||0,we.value=e||0,null==(a=J.value)||a.play()}),{immediate:!0,flush:"post"});const{isMobile:_e,isSmallXl:Ae}=w(),Ge=g(!1);G((()=>H.siderCollapsed));const Me=g("");function De(e){Me.value=e,N.setGroupKeyWord(e)}function Fe(){Ce.value=!1}function Te(){z.push("/role")}async function je(){try{Ge.value=!0,await N.addNewChatGroup(),await N.queryMyGroup(),Ge.value=!1,_e.value&&H.setSiderCollapsed(!0)}catch(e){Ge.value=!1}}async function Pe(){X.warning({title:"清空分组",content:"是否删除所有非置顶的对话组？",positiveText:"确认删除",negativeText:"再想想",onPositiveClick:async()=>{await N.delAllGroup()}})}G((()=>_e.value?{position:"fixed",zIndex:50}:{}));const Be=G((()=>_e.value?{paddingBottom:"env(safe-area-inset-bottom)"}:{}));async function Le(e){const{uuid:t}=e;(function(e){return N.active===e})(t)||(await N.setActiveGroup(t),"chat"!==W.name&&z.push("/chat"),_e.value&&H.setSiderCollapsed(!0))}async function qe(e){null==event||event.stopPropagation(),await N.deleteGroup(e),await N.queryMyGroup(),_e.value&&H.setSiderCollapsed(!0)}k(_e,(e=>{H.setSiderCollapsed(e)}),{immediate:!0,flush:"post"});const Ke=g(!0);return k((()=>H.siderCollapsed),(e=>{Ke.value=e}),{immediate:!0}),k((()=>Ke.value),(e=>{H.setSiderCollapsed(e)})),M((()=>{f.isShowAide&&(x.value="aide")})),(e,l)=>{const s=R,i=E;return n(),o("div",{class:"flex flex-col h-full bg-[#fff] dark:bg-[#18181c]",style:K(Be.value)},[u("main",ee,[y(Ae)?(n(),o("div",te)):h("",!0),u("div",ae,[le,r(y(j),{type:"primary",onClick:je,loading:Ge.value},{default:p((()=>[r(y(t),{icon:"tabler:message-2",class:"dark:text-[#fff]"})])),_:1},8,["loading"])]),u("div",se,[r(y(P),{class:m([[{"!bg-[#F7F7FA]":!y(b)}],""]),bordered:!1,value:Me.value,"onUpdate:value":l[0]||(l[0]=e=>Me.value=e),ref_key:"searchRef",ref:Ie,type:"text",placeholder:"对话历史查找",onBlur:Fe,clearable:"",onInput:De},{prefix:p((()=>[r(y(t),{icon:"mingcute:search-line"})])),_:1},8,["class","value"])]),r(i,{type:"segment",animated:"","justify-content":"space-evenly",value:x.value,"onUpdate:value":l[1]||(l[1]=e=>x.value=e)},{default:p((()=>[r(s,{name:"history",tab:"对话历史"}),r(s,{name:"aide",tab:"助手列表"})])),_:1},8,["value"]),u("div",ie,["history"==x.value?(n(),c(Z,{key:0})):h("",!0),r(q,{hideBg:""},{default:p((()=>[B(u("div",ne,[D.value.length?(n(),c(Q,{key:2e3+a.value,"data-sources":D.value,onSelect:Le,onDelete:qe},null,8,["data-sources"])):h("",!0)],512),[[L,"aide"==x.value]])])),_:1})]),u("div",oe,[u("div",ue,[u("span",ce,[re,u("span",pe,[d(v(V.value.clientIntegralIcon)+" ",1),u("span",null,v(O.value.sumModel3Count||0),1)])])]),u("div",de,[u("span",ve,[fe,u("span",ye,[d(v(V.value.clientIntegralIcon||0)+" ",1),u("span",null,v(O.value.sumModel4Count||0),1)])])]),u("div",me,[r(y(j),{secondary:"",onClick:Pe},{default:p((()=>[u("div",xe,[r(y(t),{class:"text-[18px]",icon:"ic:outline-delete"}),ge])])),_:1}),r(y(j),{onClick:Te,secondary:""},{default:p((()=>[u("div",ke,[r(y(t),{icon:"tabler:category-2"}),he])])),_:1})])]),h("",!0)])],4)}}});export{be as _};
