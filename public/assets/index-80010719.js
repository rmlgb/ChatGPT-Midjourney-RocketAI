import{C as e,a}from"./mjDraw-f56e4ae3.js";import{d as l,r as t,O as n,A as u,c as s,e as i,o as r,v as c,t as o,g as v,w as f,f as d,m as p,y as h,h as g,l as m}from"./index-62750275.js";const x=l({__name:"index",props:{src:String,selectColor:String,maxSteps:Number,updateFileInfo:Function},setup(e,{expose:a}){const l=e,c=t(null),o=t(null);let v=new Set;const f=t([]),d=t(10);function p(){if(!o.value||!l.src)return;const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{var a;c.value.width=e.width,c.value.height=e.height,null==(a=l.updateFileInfo)||a.call(l,{width:e.width,height:e.height,scaleRatio:1}),o.value.drawImage(e,0,0,e.width,e.height)},e.src=l.src}function h(e,a){return 4*(a*c.value.width+e)}function g(e,a,l){const t=h(e,a);return[l[t],l[t+1],l[t+2],l[t+3]]}function m(e,a){return e.reduce(((e,l,t)=>e+Math.abs(l-a[t])),0)}function x(e,a,l,t,n){if(o.value&&c.value){!function(e){const a=new Set(v);f.value.push({imageData:e,currentModifiedPixels:a}),f.value.length>d.value&&f.value.shift()}(o.value.getImageData(0,0,c.value.width,c.value.height))}const u=[[e,a]];for(;u.length;){const[e,a]=u.shift();if(e<0||e>=c.value.width||a<0||a>=c.value.height)continue;const s=g(e,a,n);if(m(s,t)>50)continue;if(0===m(s,l))continue;const i=h(e,a);n.set(l,i),v.add(e+","+a),u.push([e+1,a]),u.push([e-1,a]),u.push([e,a+1]),u.push([e,a-1])}}function y(e){if(!o.value||!c.value)return;const a=e.offsetX,t=e.offsetY,n=o.value.getImageData(0,0,c.value.width,c.value.height),u=g(a,t,n.data);x(a,t,function(e){if(e&&e.startsWith("#")){const a=4===e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:e;return[parseInt(a.slice(1,3),16),parseInt(a.slice(3,5),16),parseInt(a.slice(5,7),16),255]}if(e&&e.startsWith("rgb")){const a=e.replace(/rgba?\(/,"").replace(/\)/,"").split(",").map((e=>parseInt(e)));return 3===a.length&&a.push(255),a}return[0,0,0,255]}(l.selectColor),u,n.data),o.value.putImageData(n,0,0)}return n((()=>l.maxSteps),(e=>{e&&(d.value=e)}),{immediate:!0}),u((()=>{c.value&&(o.value=c.value.getContext("2d",{willReadFrequently:!0}),p())})),n((()=>l.src),(e=>{e&&p()})),a({getBase:async function(){return await function(){if(!o.value||!c.value)return"";const e=o.value.getImageData(0,0,c.value.width,c.value.height),a=new Uint8ClampedArray(e.data);for(let n=0;n<c.value.height;n++)for(let e=0;e<c.value.width;e++){const l=h(e,n);v.has(e+","+n)?(a[l]=255,a[l+1]=255,a[l+2]=255):(a[l]=0,a[l+1]=0,a[l+2]=0),a[l+3]=255}const l=new ImageData(a,c.value.width,c.value.height),t=document.createElement("canvas");return t.width=c.value.width,t.height=c.value.height,t.getContext("2d").putImageData(l,0,0),t.toDataURL("image/png")}()},undo:function(){if(0===f.value.length||!o.value||!c.value)return;const e=f.value.pop();o.value.putImageData(e.imageData,0,0),v=new Set(e.currentModifiedPixels)},clear:function(){o.value&&c.value&&(o.value.clearRect(0,0,c.value.width,c.value.height),v.clear(),f.value=[],p())}}),(e,a)=>(r(),s("div",null,[i("canvas",{ref_key:"canvas",ref:c,onClick:y,crossOrigin:"anonymous"},null,512)]))}}),y={class:"w-full h-full bg-gray-100"},w={class:"h-[80px] w-full flex justify-center items-center space-x-5"},b={class:"text-2xl font-bold"},k={key:0,class:"bg-gray-100 flex-1 h-full w-full flex"},I={class:"w-[50%] flex flex-col border-r"},C=i("span",{class:"text-2xl w-full text-center"},"操作区域",-1),_={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},j={class:"mt-10 ml-10"},D={class:"w-[50%] flex flex-col"},R=i("span",{class:"text-2xl w-full text-center"},"预览区域",-1),S={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},F={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},M=i("span",null,"图片原始信息：",-1),O=["src"],A={key:1,class:"bg-gray-100 flex-1 h-full w-full flex"},B={class:"w-[50%] flex flex-col border-r"},E=i("span",{class:"text-2xl w-full text-center"},"操作区域",-1),P={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},U={class:"mt-10 ml-10"},W={class:"w-[50%] flex flex-col"},q=i("span",{class:"text-2xl w-full text-center"},"预览区域",-1),L={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},N={class:"border-b border-t h-[50px] flex justify-center items-center space-x-5"},X=i("span",null,"图片原始信息：",-1),Y=["src"],z=l({__name:"index",setup(l){const u=t(""),z=t(null),G=t(""),H=t(1),J=t(!1),K=t({}),Q=c((()=>1===H.value?"模块选区":"自由绘制")),T=c((()=>2===H.value?"模块选区模式":"自由绘制模式"));async function V(){var e;const a=await(null==(e=z.value)?void 0:e.getBase());u.value=a}const Z=c((()=>J.value?"橡皮擦模式":"画笔模式"));function $(){G.value=null,H.value=1===H.value?2:1}function ee(){var e;null==(e=z.value)||e.undo()}function ae(){var e;null==(e=z.value)||e.clear()}function le(e){K.value=e}function te(){var e;null==(e=z.value)||e.toggleEraser(),J.value=!J.value}return n(H,(()=>{!async function(){const e=1===H.value?"https://chevereto.jiangly.com/images/2023/11/21/61888bd4ede4.png":"https://chevereto.jiangly.com/images/2023/11/19/shoes.jpg",l="data:image/png;base64,"+(await a({url:e})).data;G.value=l}()}),{immediate:!0}),(a,l)=>(r(),s("div",y,[i("div",w,[i("span",b," 当前测试模式："+o(T.value),1),v(d(m),{type:"primary",onClick:$},{default:f((()=>[p("切换至"+o(Q.value)+"模式",1)])),_:1})]),1===H.value?(r(),s("div",k,[i("div",I,[C,i("div",_,[v(d(m),{type:"primary",onClick:ee},{default:f((()=>[p("返回上一步")])),_:1}),v(d(m),{type:"primary",onClick:ae},{default:f((()=>[p("清空画布")])),_:1}),v(d(m),{type:"primary",onClick:te},{default:f((()=>[p("切换橡皮擦模式")])),_:1}),p(" 当前模式: "+o(Z.value),1)]),i("div",j,[i("div",null,[G.value&&1===H.value?(r(),h(e,{key:0,ref_key:"canvasRef",ref:z,updateFileInfo:le,max:700,src:G.value},null,8,["src"])):g("",!0)])])]),i("div",D,[R,i("div",S,[v(d(m),{type:"primary",onClick:V},{default:f((()=>[p("获取蒙层")])),_:1})]),i("div",F,[M,i("span",null,"宽度： "+o(K.value.width),1),i("span",null,"高度： "+o(K.value.height),1),i("span",null,"缩放比： "+o(K.value.scaleRatio),1)]),i("div",null,[u.value?(r(),s("img",{key:0,src:u.value,alt:""},null,8,O)):g("",!0)])])])):g("",!0),2===H.value?(r(),s("div",A,[i("div",B,[E,i("div",P,[v(d(m),{type:"primary",onClick:ee},{default:f((()=>[p("返回上一步")])),_:1}),v(d(m),{type:"primary",onClick:ae},{default:f((()=>[p("清空画布")])),_:1}),p(" 当前模式: "+o(Z.value),1)]),i("div",U,[i("div",null,[G.value&&2===H.value?(r(),h(x,{key:0,selectColor:"#fff",ref_key:"canvasRef",ref:z,updateFileInfo:le,max:500,src:G.value},null,8,["src"])):g("",!0)])])]),i("div",W,[q,i("div",L,[v(d(m),{type:"primary",onClick:V},{default:f((()=>[p("获取蒙层")])),_:1})]),i("div",N,[X,i("span",null,"宽度： "+o(K.value.width),1),i("span",null,"高度： "+o(K.value.height),1),i("span",null,"缩放比： "+o(K.value.scaleRatio),1)]),i("div",null,[u.value?(r(),s("img",{key:0,src:u.value,alt:""},null,8,Y)):g("",!0)])])])):g("",!0)]))}});export{z as default};
