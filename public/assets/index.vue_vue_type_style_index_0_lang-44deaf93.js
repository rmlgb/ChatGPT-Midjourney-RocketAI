import{d as e,K as t,aL as a,b as s,r,v as o,L as l,O as n,A as i,ah as u,c,e as d,M as p,F as f,j as m,o as v,g,w as h,aM as y,t as x,y as w,C as b,f as k,z as I,aN as L,h as j,a2 as $}from"./index-62750275.js";import{c as C}from"./index-d02c8616.js";const _={class:"min-h-full overflow-hidden flex flex-col"},M={class:"flex-1 min-h-full p-4 relative"},P=["id"],E=["id","src","onLoad","onError","onClick"],O={class:"menu p-2 text-[#cbd5e1]"},B={class:"prompt"},D={class:"flex justify-end items-end space-x-2"},N=["onClick"],W={class:"text-sm dark:text-slate-400"},z=d("span",null,"画同款",-1),U=["onClick"],S={class:"text-sm dark:text-slate-400"},A=d("span",null,"使用当前画同款",-1),J=["onClick"],R={class:"text-sm dark:text-slate-400"},F=d("span",null,"复制提示词",-1),K=d("div",{id:"footer",class:"w-full absolute bottom-[350px]"},null,-1),T=e({__name:"index",props:{dataList:{},scaleWidth:{},isDrawLike:{type:Boolean},usePropmpt:{type:Boolean},copyPropmpt:{type:Boolean},gap:{default:5},preOrigin:{type:Boolean}},emits:["loadMore","usePropmptDraw"],setup(e,{emit:T}){var q;const G=t(),H=e=>{let{fileInfo:t}=e;if(t&&"string"==typeof t)try{t=JSON.parse(t)}catch(a){}if(t&&"object"==typeof t){const{cosUrl:s}=t;return s||(e=>{const t=e.messageInfo;if("object"==typeof e.messageInfo)return t;try{return JSON.parse(e.messageInfo)}catch(a){console.error("getSeed error",a)}return t})(e).imageUrl}return""},Q=e,V=T,X=null==(q=a())?void 0:q.appContext.config.globalProperties.$viewerApi,Y=s(),Z=r({}),ee=r(0),te=r(160),ae=r(0),se=r([]),re=r(null),oe=r(0),le=o((()=>G.isLogin)),ne=o((()=>Q.scaleWidth?2*Number(Q.scaleWidth)+Q.gap+150:150)),ie=l();function ue(){!function(){const{showName:e=0,showOther:t=0}={};ee.value=15*[e,t].filter((e=>e)).length}(),function(){if(!re.value)return;const e=re.value.clientWidth;ae.value=Math.floor(e/ne.value);const t=e-ae.value*ne.value,a=(ae.value-1)*Q.gap;t-a<0&&(ae.value-=1);te.value=Math.floor((e-a)/ae.value)}();const e=ae.value,t=te.value,a=[];Q.dataList.forEach(((s,r)=>{const{width:o,height:l}=s.fileInfo,n=l*(t/o)+Q.gap+ee.value,i=Z.value[s.id];if(a.length<e)i.style.top="0px",i.style.left=(t+Q.gap)*r+"px",a.push(n);else{const e=Math.min.apply(null,a),t=a.findIndex((t=>t===e));i.style.top=`${e+0}px`,i.style.left=t*(te.value+Q.gap)+"px",a[t]+=n}})),oe.value=Math.max(...a)+100}n((()=>Q.scaleWidth),(e=>{de()})),n((()=>Q.dataList),(e=>{e&&$((()=>{de()}))}),{immediate:!0});const ce=o((()=>e=>{const{fileInfo:t}=e,{width:a,height:s}=t;return s/(a/te.value)})),de=function(e,t){let a,s;return function(...r){s=r,a||(a=setTimeout((()=>{e.apply(this,s),a=null}),t))}}((function(){ue()}),200);return i((async()=>{window.addEventListener("resize",de);const e=document.getElementById("footer");new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&V("loadMore")}))})).observe(e)})),u((()=>{window.removeEventListener("resize",de)})),(e,t)=>(v(),c("div",_,[d("div",M,[d("div",{id:"wapper",class:"wapper",ref_key:"wapperRef",ref:re,style:p({height:`${oe.value}px`})},[(v(!0),c(f,null,m(e.dataList,((t,a)=>(v(),c("div",{id:`${t.id}`,key:a,ref_for:!0,ref:e=>function(e,t){e&&t&&(Z.value[t.id]=e)}(e,t),class:"wapper-item",style:p({width:`${te.value}px`})},[g(y,{name:"img",css:!0},{default:h((()=>[d("img",{id:`${t.id}`,class:"item-file primaryRadius",style:p({width:`${te.value}px`,height:`${ce.value(t)}px`}),src:e.preOrigin?t.fileInfo.cosUrl||H(t):t.fileInfo.thumbImg||H(t),loading:"lazy",onLoad:e=>function(e,t){se.value.push(t.id)}(0,t),onError:e=>function(e,t){se.value.push(t.id)}(0,t),onClick:e=>function(e){const{fileInfo:t}=e,{cosUrl:a}=t;X&&X({options:{},images:[a]})}(t)},null,44,E)])),_:2},1024),d("div",O,[d("div",B,x(t.fullPrompt),1),d("div",D,[e.isDrawLike?(v(),w(k(L),{key:0,trigger:"hover"},{trigger:h((()=>[d("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((e=>function(e){ie.push(`/midjourney?mjId=${e.id}`)}(t)),["stop"])},[d("span",W,[g(k(I),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,N)])),default:h((()=>[z])),_:2},1024)):j("",!0),e.usePropmpt?(v(),w(k(L),{key:1,trigger:"hover"},{trigger:h((()=>[d("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((e=>function(e){const{prompt:t}=e;V("usePropmptDraw",t)}(t)),["stop"])},[d("span",S,[g(k(I),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,U)])),default:h((()=>[A])),_:2},1024)):j("",!0),e.copyPropmpt?(v(),w(k(L),{key:2,trigger:"hover"},{trigger:h((()=>[d("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:b((e=>function(e){if(!le.value)return G.setLoginDialog(!0);const{prompt:t}=e;C({text:t}),Y.success("复制prompt成功")}(t)),["stop"])},[d("span",R,[g(k(I),{icon:"tabler:copy",class:"text-sm"})])],8,J)])),default:h((()=>[F])),_:2},1024)):j("",!0)])]),se.value.includes(t.id)?j("",!0):(v(),c("div",{key:0,class:"item-loading",style:p({width:`${te.value}px`,height:`${ce.value(t)}px`})},null,4))],12,P)))),128)),K],4)])]))}});export{T as _};
