import{d as e,ac as t,r as l,v as a,b as s,ad as i,au as o,A as u,o as r,c as n,D as c,E as p,e as f,g as d,w as m,t as y,h as v,y as g,aP as h,f as x,C as w,F as S,z as b,_ as k}from"./index-62750275.js";import{N as T,_}from"./Upload-3cc5e7bf.js";const U={class:"flex w-full h-full"},B={key:0,class:"flex flex-col items-center gap-2 text-[#7B7D80]"},C={key:0},D=["onClick"],j={key:1,class:"h-full w-full relative group"},z=k(e({__name:"WishUpload",props:t({max:{default:1},listType:{default:"image-card"},msg:{default:""},customStyle:{type:Boolean,default:!1},showUpload:{type:Boolean,default:!0},fileSize:{default:5},astrictTypes:{default:()=>["image/png","image/jpg","image/jpeg","image/bmp"]},isBase64Img:{type:Boolean,default:!1}},{urlList:{type:Array,default:()=>[]},urlListModifiers:{},url:{type:String,default:""},urlModifiers:{}}),emits:["update:urlList","update:url"],setup(e){const t=l(),k=e,z=a((()=>k.astrictTypes.map((e=>e.split("/")[1])).join("/"))),L=s(),P=i(e,"urlList"),$=i(e,"url"),F=l(),I=l("/api/upload/file");async function A(e){F.value=e;const t=[];if(k.isBase64Img)for(const l of e){const{file:e}=l;if(!e)continue;const a=await new Promise((t=>{const l=new FileReader;l.onload=e=>{var l;t(null==(l=e.target)?void 0:l.result)},l.readAsDataURL(e)}));t.push(a)}else e.length&&e.map((e=>{e.url&&t.push(e.url)}));t.length?P.value=t:P.value=[]}function M(e){return new Promise(((t,l)=>{const{file:a}=e;if(!a.file)return t(!1);const{size:s,type:i}=a.file,o=i.split("/")[0];console.log("fileType",o);let u=!1;if(k.astrictTypes.length)for(const e of k.astrictTypes)if(e.includes(o))return u=!0,t(!0);return!u&&k.astrictTypes.length?(L.error(`只能上传${z.value}格式!`),l(!1)):s>1e3*k.fileSize*1024?(L.error(`大小不能超过${k.fileSize}mb`),l(!1)):t(!0)}))}o((()=>{$.value||(P.value=[])})),o((()=>{const e=P.value[P.value.length-1];$.value=e||""})),u((()=>{F.value=P.value.map((e=>({id:""+(+new Date+1e3*Math.random()+ +new Date),name:e,url:e,fullPath:e,thumbnailUrl:e,status:"finished"})))}));const R=({file:e,event:t})=>{if(t&&t.target&&t.target.response){let l=JSON.parse(t.target.response).data;const a="https://";l.replace(a,"").includes(a)&&(l=l.replace(a,""));const s="http://";l.includes(s)&&l.replace(s,"").includes(s)&&(l=l.replace(s,"")),e.fullPath=l,e.thumbnailUrl=l,e.url=l}return L.success("上传成功"),e},N=()=>{var e;F.value=[],null==(e=t.value)||e.openOpenFileDialog()},O=()=>{P.value=[],L.success("删除成功")};return(e,l)=>{const a=b,s=_;return r(),n(S,null,[c(f("div",U,[d(x(T),{ref_key:"uploadRef",ref:t,"on-before-upload":M,"on-update:file-list":A,max:k.max||1,action:e.isBase64Img?void 0:x(I),"default-file-list":x(F),"list-type":e.customStyle?"text":e.listType||"image-card",onFinish:R,abstract:e.customStyle||"text"===e.listType,"file-list":x(F)},{default:m((()=>["text"==e.listType||e.customStyle?v("",!0):(r(),n("div",B,[d(a,{class:"text-[25px]",icon:"tabler:cloud-upload"}),e.msg?(r(),n("div",C,y(e.msg),1)):v("",!0)])),"text"==e.listType||e.customStyle?(r(),g(s,{key:1,abstract:""},{default:m((({handleClick:t})=>[f("div",{onClick:t,class:"w-full h-full"},[h(e.$slots,"default",{},void 0,!0)],8,D)])),_:3})):v("",!0)])),_:3},8,["max","action","default-file-list","list-type","abstract","file-list"])],512),[[p,!e.customStyle]]),e.showUpload&&e.customStyle?(r(),n("div",{key:0,class:"h-full w-full",onClick:N},[h(e.$slots,"content",{},void 0,!0)])):v("",!0),!e.showUpload&&e.customStyle?(r(),n("div",j,[h(e.$slots,"priview",{},void 0,!0),d(a,{onClick:w(O,["stop"]),class:"opacity-0 group-hover:opacity-100 transition-all duration-300 ease-linear absolute text-[50px] left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 text-[--primaryColor]",icon:"mingcute:delete-2-line"})])):v("",!0)],64)}}}),[["__scopeId","data-v-eb60da12"]]);export{z as W};
