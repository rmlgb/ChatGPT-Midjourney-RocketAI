import{d as ye,r as _,O as R,I as H,y as be,c as r,Q as we,o as n,e as U,h as l,i as t,J as T,K as q,L as m,g as d,k as Ae,m as Ve,l as p,w as Ie,t as g,f as D,F as I,M as ke,R as k,S as he,E as h,z as Ce,s as J}from"./index-a2cde0ca.js";import{u as xe}from"./utcformatTime-e76e5157.js";import{E as Ue,A as De,Q as Ge}from"./index-f74fb548.js";const Pe={style:{maxWidth:"350px"}},ze={style:{maxHeight:"50px",cursor:"pointer"}},Se={style:{maxWidth:"350px"}},Te={style:{maxHeight:"50px",cursor:"pointer"}},qe=["src"],$e={class:"flex justify-end mr-5"},Le=ye({__name:"application",setup(Ne){const B=_(),F=_(0),A=_(!1),G=_(!1),i=R({catId:"",name:"",status:"",role:"",page:1,size:10}),X=_("/api/upload/file"),$=_(),C=_(0),L=_(!1),j=_(0),s=R({catId:"",name:"",preset:"",des:"",coverImg:"",demoData:"",order:100,status:0,isGpts:0,gptsId:void 0}),Z=R({catId:[{required:!0,message:"请选择App分类",trigger:"change"}],name:[{required:!0,message:"请填写App名称",trigger:"blur"}],gptsId:[{required:!0,message:"请填写GptsId",trigger:"blur"}],preset:[{required:!0,message:"请填写App预设信息",trigger:"blur"}],des:[{required:!0,message:"请填写App描述",trigger:"blur"}],coverImg:[{required:!1,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!1,message:"请填写App演示数据",trigger:"blur"}],order:[{required:!1,message:"请填写排序ID",trigger:"blur"}],status:[{required:!0,message:"请选择App状态",trigger:"change"}]}),K=_([]),N=_([]),E=H(()=>C.value?"更新套餐":"新增套餐"),ee=H(()=>C.value?"确认更新":"确认新增");async function v(){try{G.value=!0;const o=await k.queryApp(i),{rows:a,count:b}=o.data;G.value=!1,F.value=b,K.value=a.sort((V,w)=>w.order-V.order)}catch{G.value=!1}}async function le(){const o=await k.queryCats({size:100}),{rows:a}=o.data;N.value=a}function te(o){C.value=o.id,L.value=o.role==="user",j.value=o.status;const{name:a,status:b,des:V,order:w,coverImg:x,catId:u,preset:y,demoData:f,gptsId:P,isGpts:z}=o;he(()=>{Object.assign(s,{name:a,status:b,des:V,order:w,coverImg:x,catId:u,preset:y,demoData:f,gptsId:P,isGpts:z})}),A.value=!0}function ae(o){C.value=0,o==null||o.resetFields()}async function oe(o){await k.deleteApp({id:o.id}),h.success("删除分类成功"),v()}function se(o){o==null||o.resetFields(),v()}const re=(o,a)=>{console.log("response: ",o.data),s.coverImg=o.data},ne=o=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(o.type)){if(o.size/1024>300)return h.error("当前限制文件最大不超过 300KB!"),!1}else return h.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1};function ue(o){o==null||o.validate(async a=>{if(a){if(C.value){const b={id:C.value,...s};L.value&&Object.assign(b,{status:j.value}),await k.updateApp(b),h({type:"success",message:"更新套餐成功！"})}else await k.createApp(s),h({type:"success",message:"创建新的套餐成功！"});A.value=!1,v()}})}async function de(o){const a=await k.auditPassApp({id:o.id});h({type:"success",message:a.data}),v()}async function pe(o){const a=await k.auditFailApp({id:o.id});h({type:"success",message:a.data}),v()}return be(()=>{v(),le()}),(o,a)=>{const b=r("el-alert"),V=Ce,w=r("el-option"),x=r("el-select"),u=r("el-form-item"),y=r("el-input"),f=r("el-button"),P=r("Plus"),z=r("el-icon"),Y=r("el-form"),ie=r("el-image"),c=r("el-table-column"),S=r("el-tag"),Q=r("el-tooltip"),M=r("el-popconfirm"),ce=r("el-table"),me=r("el-pagination"),fe=r("el-row"),W=r("el-switch"),_e=r("el-upload"),ge=r("el-dialog"),ve=we("loading");return n(),U("div",null,[l(V,null,{default:t(()=>[l(b,{closable:!1,"show-icon":"",title:"应用说明",description:"[由于各模型的使用不同、暂时关闭其他模型的应用使用、仅仅支持使用OpenAi的key使用、请配置了openAi的key之后再进行使用、如果没有配置将不能使用此功能、但用户可以自定义选择模型]  ====     应用一旦创建、可能会被多处使用后续将限制删除、请保持良好习惯、规范命名分类、后续尽量变更而不是删除。用户创建的应用我们不允许删除、但是可以做一定的变更和修改、审核通过的应用也将限制用户更改、一旦通过或者拒绝、将不允许再次对其状态进行变更、请知悉！",type:"success"})]),_:1}),l(V,null,{default:t(()=>[l(Y,{ref_key:"formRef",ref:B,inline:!0,model:i},{default:t(()=>[l(u,{label:"App分类",prop:"catId"},{default:t(()=>[l(x,{modelValue:i.catId,"onUpdate:modelValue":a[0]||(a[0]=e=>i.catId=e),placeholder:"请选择App分类",clearable:""},{default:t(()=>[(n(!0),U(T,null,q(d(N),e=>(n(),m(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"App状态",prop:"status"},{default:t(()=>[l(x,{modelValue:i.status,"onUpdate:modelValue":a[1]||(a[1]=e=>i.status=e),placeholder:"请选择App状态",clearable:""},{default:t(()=>[(n(!0),U(T,null,q(d(Ue),e=>(n(),m(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"App名称",prop:"name"},{default:t(()=>[l(y,{modelValue:i.name,"onUpdate:modelValue":a[2]||(a[2]=e=>i.name=e),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:Ae(Ve(v,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),l(u,{label:"App角色",prop:"status"},{default:t(()=>[l(x,{modelValue:i.role,"onUpdate:modelValue":a[3]||(a[3]=e=>i.role=e),placeholder:"请选择App角色",clearable:""},{default:t(()=>[(n(!0),U(T,null,q(d(De),e=>(n(),m(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(f,{type:"primary",onClick:v},{default:t(()=>[p(" 查询 ")]),_:1}),l(f,{onClick:a[4]||(a[4]=e=>se(d(B)))},{default:t(()=>[p(" 重置 ")]),_:1})]),_:1}),l(f,{type:"success",style:{float:"right"},onClick:a[5]||(a[5]=e=>A.value=!0)},{default:t(()=>[p(" 创建应用 "),l(z,{class:"ml-3"},{default:t(()=>[l(P)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{style:{width:"100%"}},{default:t(()=>[Ie((n(),m(ce,{border:"",data:d(K),style:{width:"100%"},size:"large"},{default:t(()=>[l(c,{prop:"coverImg",label:"应用封面",width:"100"},{default:t(e=>[l(ie,{style:{height:"50px"},src:e.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),l(c,{prop:"catName",label:"应用分类",width:"100"}),l(c,{prop:"name",label:"应用名称",width:"120"}),l(c,{prop:"status",label:"应用状态",width:"100"},{default:t(e=>[l(S,{type:e.row.status===1?"success":"danger"},{default:t(()=>[p(g(d(Ge)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"isGpts",label:"是否是GPTS",width:"100"},{default:t(e=>[l(S,{type:e.row.isGpts?"success":"danger"},{default:t(()=>[p(g(e.row.isGpts?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"gptsId",label:"GptsId",width:"100"},{default:t(e=>[p(g(e.row.gptsId.length>5?e.row.gptsId:"无"),1)]),_:1}),l(c,{prop:"public",label:"是否共享",width:"100"},{default:t(e=>[l(S,{type:e.row.public?"success":""},{default:t(()=>[p(g(e.row.public?"共享":"私有"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"public",label:"应用创建角色",width:"120"},{default:t(e=>[l(S,{type:e.row.role==="system"?"success":""},{default:t(()=>[p(g(e.row.role==="system"?"系统":"用户"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"order",label:"排序ID"}),p(" /> "),l(c,{prop:"preset",label:"预设信息",width:"400"},{default:t(e=>[l(Q,{class:"box-item",effect:"dark",placement:"top-start"},{content:t(()=>[D("div",Pe,g(e.row.preset),1)]),default:t(()=>[D("div",ze,g(e.row.preset),1)]),_:2},1024)]),_:1}),l(c,{prop:"des",label:"描述信息",width:"300"},{default:t(e=>[l(Q,{class:"box-item",effect:"dark",placement:"top-start"},{content:t(()=>[D("div",Se,g(e.row.des),1)]),default:t(()=>[D("div",Te,g(e.row.des),1)]),_:2},1024)]),_:1}),l(c,{prop:"createdAt",label:"创建时间",width:"120"},{default:t(e=>[p(g(d(xe)(e.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(c,{label:"操作",width:"200"},{default:t(e=>[e.row.role==="system"||e.row.public?(n(),m(f,{key:0,link:"",type:"primary",size:"small",onClick:O=>te(e.row)},{default:t(()=>[p(" 编辑 ")]),_:2},1032,["onClick"])):I("",!0),e.row.role==="system"?(n(),m(M,{key:1,title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:O=>oe(e.row)},{reference:t(()=>[l(f,{link:"",type:"danger",size:"small"},{default:t(()=>[p(" 删除应用 ")]),_:1})]),_:2},1032,["onConfirm"])):I("",!0),e.row.role==="user"&&e.row.status===3?(n(),m(M,{key:2,title:"确认通过审核此应用么?",width:"200","icon-color":"red",onConfirm:O=>de(e.row)},{reference:t(()=>[l(f,{link:"",type:"success",size:"small"},{default:t(()=>[p(" 通过审核 ")]),_:1})]),_:2},1032,["onConfirm"])):I("",!0),e.row.role==="user"&&e.row.status===3?(n(),m(M,{key:3,title:"确认拒绝通过此应用共享请求么?",width:"200","icon-color":"red",onConfirm:O=>pe(e.row)},{reference:t(()=>[l(f,{link:"",type:"danger",size:"small"},{default:t(()=>[p(" 拒绝审核 ")]),_:1})]),_:2},1032,["onConfirm"])):I("",!0)]),_:1})]),_:1},8,["data"])),[[ve,d(G)]]),l(fe,{class:"flex justify-end mt-5"},{default:t(()=>[l(me,{"current-page":i.page,"onUpdate:currentPage":a[6]||(a[6]=e=>i.page=e),"page-size":i.size,"onUpdate:pageSize":a[7]||(a[7]=e=>i.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:d(F),onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(ge,{modelValue:d(A),"onUpdate:modelValue":a[19]||(a[19]=e=>ke(A)?A.value=e:null),"close-on-click-modal":!1,title:d(E),width:"570",onClose:a[20]||(a[20]=e=>ae(d($)))},{footer:t(()=>[D("span",$e,[l(f,{onClick:a[17]||(a[17]=e=>A.value=!1)},{default:t(()=>[p("取消")]),_:1}),l(f,{type:"primary",onClick:a[18]||(a[18]=e=>ue(d($)))},{default:t(()=>[p(g(d(ee)),1)]),_:1})])]),default:t(()=>[l(Y,{ref_key:"formPackageRef",ref:$,"label-position":"right","label-width":"100px",model:s,rules:Z},{default:t(()=>[l(u,{label:"App分类",prop:"catId"},{default:t(()=>[l(x,{modelValue:s.catId,"onUpdate:modelValue":a[8]||(a[8]=e=>s.catId=e),placeholder:"请选择App分类",clearable:"",style:{width:"100%"}},{default:t(()=>[(n(!0),U(T,null,q(d(N),e=>(n(),m(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"是否是Gpts",prop:"isGpts"},{default:t(()=>[l(W,{modelValue:s.isGpts,"onUpdate:modelValue":a[9]||(a[9]=e=>s.isGpts=e),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),s.isGpts?(n(),m(u,{key:0,label:"GptsId",prop:"gptsId"},{default:t(()=>[l(y,{modelValue:s.gptsId,"onUpdate:modelValue":a[10]||(a[10]=e=>s.gptsId=e),placeholder:"请填写App名称"},null,8,["modelValue"])]),_:1})):I("",!0),l(u,{label:"App名称",prop:"name"},{default:t(()=>[l(y,{modelValue:s.name,"onUpdate:modelValue":a[11]||(a[11]=e=>s.name=e),placeholder:"请填写App名称"},null,8,["modelValue"])]),_:1}),d(L)?I("",!0):(n(),m(u,{key:1,label:"App状态",prop:"status"},{default:t(()=>[l(W,{modelValue:s.status,"onUpdate:modelValue":a[12]||(a[12]=e=>s.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})),s.isGpts?I("",!0):(n(),m(u,{key:2,label:"App预设",prop:"preset"},{default:t(()=>[l(y,{modelValue:s.preset,"onUpdate:modelValue":a[13]||(a[13]=e=>s.preset=e),type:"textarea",placeholder:"请填写App预设信息、用于给AI预设身份...",rows:4},null,8,["modelValue"])]),_:1})),l(u,{label:"App描述",prop:"des"},{default:t(()=>[l(y,{modelValue:s.des,"onUpdate:modelValue":a[14]||(a[14]=e=>s.des=e),type:"textarea",placeholder:"请填写App介绍信息、用于对外展示...",rows:4},null,8,["modelValue"])]),_:1}),l(u,{label:"示例内容",prop:"demoData"},{default:t(()=>[l(y,{modelValue:s.demoData,"onUpdate:modelValue":a[15]||(a[15]=e=>s.demoData=e),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4},null,8,["modelValue"])]),_:1}),l(u,{label:"应用Logo",prop:"coverImg"},{default:t(()=>[l(_e,{class:"avatar-uploader",action:d(X),"show-file-list":!1,"on-success":re,"before-upload":ne},{default:t(()=>[s.coverImg?(n(),U("img",{key:0,src:s.coverImg,style:{width:"100px"},class:"avatar"},null,8,qe)):(n(),m(z,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[l(P)]),_:1}))]),_:1},8,["action"])]),_:1}),l(u,{label:"排序ID",prop:"order"},{default:t(()=>[l(y,{modelValue:s.order,"onUpdate:modelValue":a[16]||(a[16]=e=>s.order=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof J=="function"&&J(Le);export{Le as default};
