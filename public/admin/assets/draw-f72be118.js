import{d as te,r as _,O as ae,y as oe,c as o,Q as ne,o as m,e as x,h as l,i as t,f as h,l as s,g as i,M as B,J as T,K as j,L as z,w as re,t as v,E as P,z as se,s as J}from"./index-a2cde0ca.js";import{A as ie}from"./mj-f300045d.js";import{A}from"./chat-ff09c793.js";import{u as ce}from"./utcformatTime-e76e5157.js";import{i as ue,W as de,j as pe}from"./index-f74fb548.js";import{D as fe}from"./draw-6ac66bab.js";const _e={class:"flex items-center gap-2"},me=h("span",null,"推荐分类:",-1),ge={style:{float:"right"}},we={class:"answer"},ve={class:"answer_container"},he=["src"],ye=te({__name:"draw",setup(be){const L=_(),N=_(0),S=_(!1),c=ae({rec:null,status:null,page:1,size:10}),O=_([]);async function d(){try{S.value=!0;const n=await ie.queryAdminDrawList(c);S.value=!1;const{rows:a,count:g}=n.data;N.value=g,console.log(a),a.forEach((I,p)=>{try{const w=I.fileInfo,M=w.startsWith('\\"')?JSON.parse(w):w,C=JSON.parse(M);a[p].fileInfo=C}catch(w){console.error("Error processing item:",w)}}),console.log(a),O.value=a}catch{S.value=!1}}function Y(n){n==null||n.resetFields(),d()}async function q(n,a){if(U.value=n,a!==1)return y.value=!0;const g=await A.recMjDrawImg({id:n});P.success(g.data),d()}async function F(n){const a=await A.delChatLog({id:n});P.success(a.data),d()}oe(async()=>{d();const n=await fe.list();R.value=n.data});const y=_(!1),U=_(),b=_(),R=_([]);async function H(){await A.recMjDrawImg({id:U.value,category_id:b.value}),await A.recommedMjDrawImg({id:U.value,category_id:b.value}),P.success("推荐成功"),b.value=null,y.value=!1,d()}return(n,a)=>{const g=o("el-option"),I=o("el-select"),p=o("el-button"),w=o("el-dialog"),V=o("el-form-item"),M=o("el-form"),C=se,K=o("el-alert"),r=o("el-table-column"),Q=o("el-image"),$=o("el-tag"),G=o("el-popover"),E=o("el-popconfirm"),X=o("el-table"),Z=o("el-pagination"),ee=o("el-row"),le=ne("loading");return m(),x("div",null,[l(w,{modelValue:i(y),"onUpdate:modelValue":a[2]||(a[2]=e=>B(y)?y.value=e:null),title:"推荐",width:"30%"},{footer:t(()=>[h("span",null,[l(p,{onClick:a[1]||(a[1]=e=>y.value=!1)},{default:t(()=>[s("取消")]),_:1}),l(p,{type:"primary",onClick:H},{default:t(()=>[s("确认")]),_:1})])]),default:t(()=>[h("div",_e,[me,l(I,{modelValue:i(b),"onUpdate:modelValue":a[0]||(a[0]=e=>B(b)?b.value=e:null),placeholder:"请选择分类",clearable:"",filterable:""},{default:t(()=>[(m(!0),x(T,null,j(i(R),e=>(m(),z(g,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),l(C,null,{default:t(()=>[l(M,{ref_key:"formRef",ref:L,inline:!0,model:c},{default:t(()=>[l(V,{label:"推荐状态",prop:"rec"},{default:t(()=>[l(I,{modelValue:c.rec,"onUpdate:modelValue":a[3]||(a[3]=e=>c.rec=e),placeholder:"请选择推荐状态",clearable:""},{default:t(()=>[(m(!0),x(T,null,j(i(ue),e=>(m(),z(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"绘制状态",prop:"status"},{default:t(()=>[l(I,{modelValue:c.status,"onUpdate:modelValue":a[4]||(a[4]=e=>c.status=e),placeholder:"请选择绘制状态",clearable:""},{default:t(()=>[(m(!0),x(T,null,j(i(de),e=>(m(),z(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,null,{default:t(()=>[l(p,{type:"primary",onClick:d},{default:t(()=>[s(" 查询 ")]),_:1}),l(p,{onClick:a[5]||(a[5]=e=>Y(i(L)))},{default:t(()=>[s(" 重置 ")]),_:1})]),_:1}),h("span",ge,[l(p,{type:"success",onClick:d},{default:t(()=>[s(" 刷新列表 ")]),_:1})])]),_:1},8,["model"])]),_:1}),l(C,null,{default:t(()=>[l(K,{"show-icon":"",title:"MJ绘图历史说明",description:"点击推荐的图片将会出现在画廊当中！",type:"success"})]),_:1}),l(C,{style:{width:"100%"}},{default:t(()=>[re((m(),z(X,{border:"",data:i(O),style:{width:"100%"},size:"large"},{default:t(()=>[l(r,{prop:"id",align:"center",label:"ID",width:"70"}),l(r,{prop:"fileInfo.cosUrl",align:"center",label:"绘图结果"},{default:t(e=>{var u,f,D,k;return[l(Q,{style:{height:"120px"},"preview-teleported":"",fit:"contain","preview-src-list":[(f=(u=e.row)==null?void 0:u.fileInfo)==null?void 0:f.cosUrl],src:(k=(D=e.row)==null?void 0:D.fileInfo)==null?void 0:k.cosUrl,lazy:"","hide-on-click-modal":""},null,8,["preview-src-list","src"])]}),_:1}),l(r,{prop:"userInfo.username",align:"center",label:"用户名",width:"120"}),l(r,{prop:"fileInfo.cosUrl",align:"center",label:"推荐状态",width:"90"},{default:t(e=>[l($,{type:e.row.rec===1?"success":""},{default:t(()=>[s(v(e.row.rec===1?"已推荐":"未推荐"),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"userInfo.email",label:"邮箱",width:"180",align:"center"}),l(r,{prop:"status",align:"center",label:"绘图状态",width:"105"},{default:t(e=>[l($,{type:e.row.status===100?"success":""},{default:t(()=>[s(v(i(pe)[e.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"fullPrompt",label:"绘图指令",align:"center",width:"200"},{default:t(e=>[l(G,{placement:"top",width:400,trigger:"click"},{reference:t(()=>[h("div",we,v(e.row.fullPrompt),1)]),default:t(()=>[h("div",ve,v(e.row.fullPrompt),1)]),_:2},1024)]),_:1}),l(r,{prop:"progress",align:"center",label:"绘图进度",width:"90"}),l(r,{prop:"fileInfo.cosUrl",align:"center",label:"绘图尺寸",width:"120"},{default:t(e=>{var u,f,D,k,W;return[s(v((u=e.row)!=null&&u.fileInfo?`${(D=(f=e.row)==null?void 0:f.fileInfo)==null?void 0:D.width}*${(W=(k=e.row)==null?void 0:k.fileInfo)==null?void 0:W.height}`:"---"),1)]}),_:1}),l(r,{prop:"userInfo.avatar",label:"用户头像",width:"90"},{default:t(e=>{var u,f;return[h("img",{src:(f=(u=e.row)==null?void 0:u.userInfo)==null?void 0:f.avatar,style:{height:"50px"}},null,8,he)]}),_:1}),l(r,{prop:"createdAt",label:"提问时间",align:"center",width:"200"},{default:t(e=>[s(v(i(ce)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),l(r,{fixed:"right",label:"操作",width:"200",align:"center"},{default:t(e=>[l(E,{title:`确认${e.row.rec===1?"取消推荐":"推荐"}图片吗！`,width:"260","icon-color":"red",onConfirm:u=>q(e.row.id,e.row.rec)},{reference:t(()=>[l(p,{link:"",type:e.row.rec===1?"success":"",size:"small"},{default:t(()=>[s(v(e.row.rec?"取消推荐":"推荐图片"),1)]),_:2},1032,["type"])]),_:2},1032,["title","onConfirm"]),l(E,{title:"`确认删除此条记录么！",width:"260","icon-color":"red",onConfirm:u=>F(e.row.id)},{reference:t(()=>[l(p,{type:"warning",size:"small"},{default:t(()=>[s(" 删除记录 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[le,i(S)]]),l(ee,{class:"flex justify-end mt-5"},{default:t(()=>[l(Z,{"current-page":c.page,"onUpdate:currentPage":a[6]||(a[6]=e=>c.page=e),"page-size":c.size,"onUpdate:pageSize":a[7]||(a[7]=e=>c.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:i(N),onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])]),_:1})]),_:1})])}}});typeof J=="function"&&J(ye);export{ye as default};
