import{d as ie,r as x,O as K,I,y as pe,c as u,Q as me,o as y,e as R,h as e,i as l,J as C,K as L,g as m,L as D,l as r,f as p,w as J,t as b,M as ce,E as W,S as fe,z as _e,s as G}from"./index-a2cde0ca.js";import{A as Y}from"./models-863c7044.js";import{u as ye}from"./utcformatTime-e76e5157.js";import{M as ge,b as be,c as ke,d as we,e as xe,f as ve,g as Te}from"./index-f74fb548.js";const Ve={style:{float:"right"}},he=p("div",{style:{width:"250px"}}," 开放状态的模型可以供用户选择、关闭的模型仅不支持用户切换、但是例如、插件、Dall-e绘画、系统内的翻译、思维导图等依然需要使用此类模型。 ",-1),De=p("div",{style:{width:"250px"}}," 给定了部分可选的模型列表、你可以可以手动填写您需要调用的模型、请确保填写的模型是当前key支持的类型、否则可能会在调用中出现不可预知错误！ ",-1),Ue=p("div",{style:{width:"250px"}}," 设置当前key的扣费类型、扣除普通余额或是高级余额。 ",-1),Me=p("div",{style:{width:"250px"}}," 设置当前key的单次调用扣除余额、建议同模型或名称key设置相同的金额、避免扣费发生异常！ ",-1),Re=p("div",{style:{width:"250px"}}," 填写此配置可以限制用户在选择模型时候的高级配置中的最大上下文轮次、可以通过限制此数量减少token的损耗、减低上下文的损耗量、 如果设置了模型的最大token和返回量、那么两个限制会同时生效！ ",-1),Ee=p("div",{style:{width:"250px"}}," 最大token值可以限制模型单次使用允许开放的最大上下文、设置为0表示使用模型的最大上下文、超出依然使用模型允许最大值 ",-1),Ce=p("div",{style:{width:"250px"}}," 限制最大token可回复值以限制模型单次使用允许回复的最大上下文、如不了解此参数请填写0为自适应！ ",-1),Le=p("div",{style:{width:"250px"}}," 当前轮询是根据模型下的列表按顺序调用、如果权重为2则表示轮到此key的时候会调用两次之后再轮询下一个key 保证每个key的调用顺序以及限制每次调用的准确次数 ",-1),Ne=p("div",{style:{width:"250px"}}," 设为默认模型则会优先使用此模型、比如在新建对话时将会默认为此模型、设置多个无效、只会以第一个为准！ ",-1),Se=p("div",{style:{width:"250px"}}," 基础绘画来自于OPENAI的DALL-E模型、所以需要为官方的apiKey、或者你的中转支持绘画！请确定至少设置一张key为基础绘画key即可使用绘画功能！ 可与工具模型同时开启、且推荐只设置单独一个模型即可。 ",-1),Ie=p("div",{style:{width:"250px"}}," 工具key仅可来自于OPENAI的的模型、在应用、翻译、联想、思维导图等特殊场景需要使用此模型处理内置操作、建议设置一个模型转为特殊工具使用即可！ 可与绘画模型同时开启、且推荐只设置单独一个模型即可。 ",-1),Oe=p("div",{style:{width:"250px"}}," 部分模型支持识别图片文件、例如 gpt-4-all、勾选此选择则用户端使用对应的模型时可以显示上传按钮、允许用户端上传文件！ ",-1),Pe=p("div",{style:{width:"250px"}}," 开启联网模式后模型名称改为 net-原始模型名称调用、官方内置中转支持这种模式、如果是三方其他中转请自行适配、不支持请勿打开此选项！ ",-1),ze={class:"flex justify-end mr-5"},Ae=ie({__name:"index",setup(qe){x();const B=x(),F=x(0),v=x(!1),N=x(!1),H=x(!1);x(!1);const g=K({keyType:"",model:"",status:null,page:1,size:10}),O=x(),T=x(0),o=K({keyType:1,modelName:"",status:!0,model:"",temperature:"",deduct:1,deductType:1,order:100,maxTokens:4096,maxResponseTokens:2048,maxRounds:12,isDallE3:!1,isUseTool:!1}),X=K({keyType:[{required:!0,message:"请填写您的调用模型类型",trigger:"blur"}],modelName:[{required:!0,message:"请填写您的模型名称",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],temperature:[{required:!0,message:"请设置模型默认温度",trigger:"change"}],maxTokens:[{required:!0,message:"请填写模型允许的最大token数",trigger:"blur"}],maxResponseTokens:[{required:!0,message:"请填写允许用户使用的最大回复token数",trigger:"blur"}],deductType:[{required:!0,message:"请选择当前模型扣费类型",trigger:"change"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],maxRounds:[{required:!0,message:"请填写允许用户选择的最大上下文轮次",trigger:"blur"}]});function Z(s){T.value=0,s==null||s.resetFields()}const ee=I(()=>ge[o.keyType]),le=I(()=>T.value?"更新模型":"新增模型");I(()=>be[o.keyType]);const te=I(()=>T.value?"确认更新":"确认新增"),j=x([]);async function V(){try{N.value=!0;const s=await Y.queryModels(g);N.value=!1;const{rows:a,count:c}=s.data;F.value=c,j.value=a}catch{N.value=!1}}async function ae(s){const{id:a}=s;await Y.delModels({id:a}),W({type:"success",message:"操作完成！"}),V()}function oe(s){T.value=s.id;const{keyType:a,modelName:c,key:h,secret:n,status:k,model:P,keyWeight:i,maxTokens:S,maxResponseTokens:E,proxyUrl:z,timeout:w,deductType:d,deduct:A,maxRounds:q,isDraw:$}=s;fe(()=>{Object.assign(o,{keyType:a,modelName:c,key:h,secret:n,status:k,model:P,keyWeight:i,maxTokens:S,maxResponseTokens:E,proxyUrl:z,timeout:w,deductType:d,deduct:A,maxRounds:q,isDraw:$})}),v.value=!0}function se(s){s==null||s.resetFields(),V()}async function ne(s){s==null||s.validate(async a=>{if(a){const c=JSON.parse(JSON.stringify(o));delete c.id,T.value&&(c.id=T.value),await Y.setModels(c),W({type:"success",message:"操作成功！"}),T.value=0,v.value=!1,V()}})}return pe(()=>{V()}),(s,a)=>{const c=u("el-option"),h=u("el-select"),n=u("el-form-item"),k=u("el-button"),P=u("Plus"),i=u("el-icon"),S=u("el-form"),E=_e,z=u("el-alert"),w=u("el-tag"),d=u("el-table-column"),A=u("el-popconfirm"),q=u("el-table"),$=u("el-pagination"),de=u("el-row"),U=u("el-switch"),f=u("QuestionFilled"),_=u("el-tooltip"),M=u("el-input"),ue=u("el-dialog"),Q=me("loading");return y(),R("div",null,[e(E,null,{default:l(()=>[e(S,{ref_key:"formRef",ref:B,inline:!0,model:g},{default:l(()=>[e(n,{label:"模型类别",prop:"model"},{default:l(()=>[e(h,{modelValue:g.keyType,"onUpdate:modelValue":a[0]||(a[0]=t=>g.keyType=t),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:l(()=>[(y(!0),R(C,null,L(m(ke),t=>(y(),D(c,{key:t,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"模型名称",prop:"model"},{default:l(()=>[e(h,{modelValue:g.model,"onUpdate:modelValue":a[1]||(a[1]=t=>g.model=t),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:l(()=>[(y(!0),R(C,null,L(m(we),t=>(y(),D(c,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"启用状态",prop:"status"},{default:l(()=>[e(h,{modelValue:g.status,"onUpdate:modelValue":a[2]||(a[2]=t=>g.status=t),placeholder:"请选择模型启用状态",clearable:""},{default:l(()=>[(y(!0),R(C,null,L(m(xe),t=>(y(),D(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:l(()=>[e(k,{type:"primary",onClick:V},{default:l(()=>[r(" 查询 ")]),_:1}),e(k,{onClick:a[3]||(a[3]=t=>se(m(B)))},{default:l(()=>[r(" 重置 ")]),_:1})]),_:1}),p("span",Ve,[e(k,{type:"success",onClick:a[4]||(a[4]=t=>v.value=!0)},{default:l(()=>[r(" 添加模型 "),e(i,{class:"ml-3"},{default:l(()=>[e(P)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(E,null,{default:l(()=>[e(z,{"show-icon":"",title:"模型说明",description:"所有开启的模型将会直接应用到客户端供用户选择使用、请注意在添加模型时候如果您需要使用DALL-E绘画你需要特别指定模型为绘画时候、同时例如思维导图、应用、翻译、联想等功能【目前绑定为OPENAI类目】请在添加模型的时候勾选上设置为工具Key、届时调用此类功能将使用我们指定的模型！",type:"success"})]),_:1}),e(E,{style:{width:"100%"}},{default:l(()=>[J((y(),D(q,{border:"",data:m(j),style:{width:"100%"},size:"large"},{default:l(()=>[e(d,{prop:"keyType",label:"ID"},{default:l(t=>[e(w,{type:"success"},{default:l(()=>[r(b(m(ve)[t.row.keyType]),1)]),_:2},1024)]),_:1}),e(d,{prop:"order",align:"center",label:"排序ID"}),e(d,{prop:"modelName",align:"center",label:"自定义模型名称",width:"260px"}),e(d,{prop:"useCount",align:"center",label:"key数量",width:"90"}),e(d,{prop:"status",align:"center",label:"用户可见状态",width:"140px"},{default:l(t=>[e(w,{type:t.row.status?"success":"danger"},{default:l(()=>[r(b(t.row.status?"使用中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"model",align:"center",label:"绑定模型",width:"240px"},{default:l(t=>[e(w,{type:t.row.model.includes("gpt-4")?"success":""},{default:l(()=>[r(b(t.row.model),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"maxTokens",align:"center",label:"最大Token数",width:"120"}),e(d,{prop:"maxResponseTokens",align:"center",label:"限制最大回复",width:"160"},{default:l(t=>[e(k,{type:"info",text:""},{default:l(()=>[r(b(t.row.maxResponseTokens||"-"),1)]),_:2},1024)]),_:1}),e(d,{prop:"isDraw",align:"center",label:"默认工具",width:"120"},{default:l(t=>[e(w,{type:t.row.isDraw?"success":"danger"},{default:l(()=>[r(b(t.row.isDraw?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"isDraw",align:"center",label:"DALL绘图工具",width:"120"},{default:l(t=>[e(w,{type:t.row.isDraw?"success":"danger"},{default:l(()=>[r(b(t.row.isDraw?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"isDraw",align:"center",label:"通用工具",width:"120"},{default:l(t=>[e(w,{type:t.row.isDraw?"success":"danger"},{default:l(()=>[r(b(t.row.isUseTool?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"deductType",align:"center",label:"扣费类型",width:"120"},{default:l(t=>[e(w,{type:t.row.deductType===1?"":"error"},{default:l(()=>[r(b(t.row.deductType===1?"普通余额":"高级余额"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"deduct",align:"center",label:"单次扣除",width:"100"},{default:l(t=>[e(w,{type:t.row.deductType===1?"success":"warning"},{default:l(()=>[r(b(`${t.row.deduct} 积分`),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),e(d,{prop:"useToken",align:"center",label:"调用Token",width:"120"}),e(d,{prop:"maxRounds",align:"center",label:"限制上下文轮次",width:"160"},{default:l(t=>[r(b(t.row.maxRounds||"-"),1)]),_:1}),e(d,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:l(t=>[r(b(m(ye)(t.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),e(d,{fixed:"right",label:"操作",width:"200"},{default:l(t=>[e(k,{link:"",type:"primary",size:"small",onClick:re=>oe(t.row)},{default:l(()=>[r(" 变更 ")]),_:2},1032,["onClick"]),e(A,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:re=>ae(t.row)},{reference:l(()=>[e(k,{link:"",type:"danger",size:"small"},{default:l(()=>[r(" 删除秘钥 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Q,m(N)]]),e(de,{class:"flex justify-end mt-5"},{default:l(()=>[e($,{"current-page":g.page,"onUpdate:currentPage":a[5]||(a[5]=t=>g.page=t),"page-size":g.size,"onUpdate:pageSize":a[6]||(a[6]=t=>g.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:m(F),onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(ue,{modelValue:m(v),"onUpdate:modelValue":a[23]||(a[23]=t=>ce(v)?v.value=t:null),"close-on-click-modal":!1,title:le.value,width:"770",onClose:a[24]||(a[24]=t=>Z(m(O)))},{footer:l(()=>[p("span",ze,[e(k,{onClick:a[21]||(a[21]=t=>v.value=!1)},{default:l(()=>[r("取消")]),_:1}),e(k,{type:"primary",onClick:a[22]||(a[22]=t=>ne(m(O)))},{default:l(()=>[r(b(te.value),1)]),_:1})])]),default:l(()=>[J((y(),D(S,{ref_key:"formPackageRef",ref:O,"label-position":"right","label-width":"120px",model:o,rules:X},{default:l(()=>[e(n,{label:"模型启用状态",prop:"status"},{default:l(()=>[e(U,{modelValue:o.status,"onUpdate:modelValue":a[7]||(a[7]=t=>o.status=t)},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[he]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"模型中文名称",prop:"modelName"},{default:l(()=>[e(M,{modelValue:o.modelName,"onUpdate:modelValue":a[8]||(a[8]=t=>o.modelName=t),placeholder:"请填写模型中文名称（用户选择的）"},null,8,["modelValue"])]),_:1}),e(n,{label:"账号关联模型",prop:"model"},{default:l(()=>[e(h,{modelValue:o.model,"onUpdate:modelValue":a[9]||(a[9]=t=>o.model=t),filterable:"",clearable:"",placeholder:"请选用或填写绑定的模型","allow-create":Number(o.keyType)===1,style:{width:"80%"}},{default:l(()=>[(y(!0),R(C,null,L(ee.value,t=>(y(),D(c,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[De]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"模型扣费类型",prop:"deductType"},{default:l(()=>[e(h,{modelValue:o.deductType,"onUpdate:modelValue":a[10]||(a[10]=t=>o.deductType=t),filterable:"","allow-create":"",clearable:"",placeholder:"请选用模型扣费类型",style:{width:"80%"}},{default:l(()=>[(y(!0),R(C,null,L(m(Te),t=>(y(),D(c,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ue]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"单次扣除金额",prop:"deduct"},{default:l(()=>[e(M,{modelValue:o.deduct,"onUpdate:modelValue":a[11]||(a[11]=t=>o.deduct=t),modelModifiers:{number:!0},placeholder:"请填写单次调用此key的扣费金额！",style:{width:"80%"}},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Me]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"上下文限制",prop:"maxRounds"},{default:l(()=>[e(M,{modelValue:o.maxRounds,"onUpdate:modelValue":a[12]||(a[12]=t=>o.maxRounds=t),modelModifiers:{number:!0},placeholder:"请填写允许用户选择的最高上下文轮次！",style:{width:"80%"}},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Re]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"Token限制",prop:"maxTokens"},{default:l(()=>[e(M,{modelValue:o.maxTokens,"onUpdate:modelValue":a[13]||(a[13]=t=>o.maxTokens=t),modelModifiers:{number:!0},placeholder:"请填写单次调用此key的扣费金额！",style:{width:"80%"}},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ee]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"Token回复限制",prop:"maxRounds"},{default:l(()=>[e(M,{modelValue:o.maxRounds,"onUpdate:modelValue":a[14]||(a[14]=t=>o.maxRounds=t),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ce]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"自定义排序",prop:"maxRounds"},{default:l(()=>[e(M,{modelValue:o.maxRounds,"onUpdate:modelValue":a[15]||(a[15]=t=>o.maxRounds=t),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Le]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"设为默认模型",prop:"isDallE3"},{default:l(()=>[e(U,{modelValue:o.isDallE3,"onUpdate:modelValue":a[16]||(a[16]=t=>o.isDallE3=t)},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ne]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"设为特殊key",prop:"isDallE3"},{default:l(()=>[e(U,{modelValue:o.isDallE3,"onUpdate:modelValue":a[17]||(a[17]=t=>o.isDallE3=t)},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Se]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"设为工具模型",prop:"isDallE3"},{default:l(()=>[e(U,{modelValue:o.isDallE3,"onUpdate:modelValue":a[18]||(a[18]=t=>o.isDallE3=t)},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ie]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"支持文件上传",prop:"isDallE3"},{default:l(()=>[e(U,{modelValue:o.isDallE3,"onUpdate:modelValue":a[19]||(a[19]=t=>o.isDallE3=t)},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Oe]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1}),e(n,{label:"支持联网模式",prop:"isDallE3"},{default:l(()=>[e(U,{modelValue:o.isDallE3,"onUpdate:modelValue":a[20]||(a[20]=t=>o.isDallE3=t)},null,8,["modelValue"]),e(_,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Pe]),default:l(()=>[e(i,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(f)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[Q,m(H)]])]),_:1},8,["modelValue","title"])])}}});typeof G=="function"&&G(Ae);export{Ae as default};
