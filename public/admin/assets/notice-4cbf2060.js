import{V as x,d as re,U as de,O as R,I as $,r as i,y as pe,$ as fe,c as n,o as N,e as B,h as e,i as o,f as d,l as _,g as V,N as C,t as P,J as me,K as _e,L as ve,F as ge,w as we,v as ye,k as be,m as xe,P as F,E as k,z as Ne,s as L}from"./index-a2cde0ca.js";/* empty css              */import{_ as Ve}from"./WishEditor.vue_vue_type_script_setup_true_lang-af37067f.js";class h{static queryNotice(u=1){return x.get("/noticeBoard",{params:{page:u}})}static delNotice(u){return x.delete(`/noticeBoard/${u}`)}static upNotice(u,c){return x.patch(`/noticeBoard/${u}`,c)}static addNotice(u){return x.post("/noticeBoard",u)}}const Ce={class:"flex justify-between"},ke=d("b",null,"公共公告设置",-1),he={class:"flex"},Ie={class:"flex justify-end"},Te={class:"flex flex-col w-full overflow-hidden"},Se={class:"flex space-x-[15px] items-center flex-wrap"},Ae={class:"flex items-center"},$e={key:0},Be=re({__name:"notice",setup(H){const u=de(),c=R({isAutoOpenNotice:"",noticeInfo:"",noticeTitle:""});$(()=>u.settings.app.colorScheme);const J=i({noticeTitle:[{required:!0,trigger:"blur",message:"请填写公告标题"}],noticeInfo:[{required:!0,trigger:"blur",message:"请填写公告具体信息"}]}),O=i();async function U(){const l=await F.queryConfig({keys:["noticeInfo","noticeTitle","isAutoOpenNotice"]}),{noticeInfo:t,noticeTitle:r,isAutoOpenNotice:A}=l.data;t&&Object.assign(c,{noticeInfo:t,noticeTitle:r,isAutoOpenNotice:A})}function G(){var l;(l=O.value)==null||l.validate(async t=>{if(t){try{await F.setConfig({settings:Q(c)}),k.success("变更配置信息成功")}catch{}U()}else k.error("请填写完整信息")})}i("/api/upload/file");function Q(l){return Object.keys(l).map(t=>({configKey:t,configVal:l[t]}))}pe(()=>{U()});const j=i([]),s=i({}),q=$(()=>{const{id:l}=s.value;return!!l}),w=i(!1),v=i(""),z=i(),I=$(()=>{var l;return(l=s.value.tags)==null?void 0:l.split(",")}),E=R({page:1}),K=i(0),g=i(!1),T=async()=>{const l=await h.queryNotice(E.page);j.value=l.data.rows,K.value=l.data.count};fe(()=>{T()});const S=async(l,t={})=>{s.value={...t},l=="edit"?g.value=!0:l=="del"&&t.id&&(await h.delNotice(t.id),T(),k.success("删除成功")),l=="add"&&(g.value=!0,s.value={})},W=(l,t)=>{const r=I.value;r&&(r.splice(t,1),s.value.tags=r.join(","))},X=()=>{var l;w.value=!0,(l=z.value)==null||l.focus()},Y=()=>{if(v.value){const l=I.value||[];s.value.tags=[...l,v.value.replaceAll(",","")].join(",")}else return;v.value=""},Z=async()=>{if(q.value){const{id:l}=s.value;l&&await h.upNotice(l,s.value)}else await h.addNotice(s.value);k.success("操作成功"),T(),g.value=!1};return(l,t)=>{const r=n("el-alert"),A=Ne,p=n("el-button"),f=n("el-form-item"),y=n("el-col"),ee=n("el-switch"),te=n("el-tooltip"),D=n("el-row"),M=n("el-form"),m=n("el-table-column"),le=n("el-popconfirm"),oe=n("el-table"),ae=n("el-pagination"),ne=n("el-card"),se=n("el-tag"),ie=n("Plus"),ue=n("el-icon"),ce=n("el-drawer");return N(),B("div",null,[e(A,null,{default:o(()=>[e(r,{closable:!1,"show-icon":"",title:"公告设置说明",description:"这里的公告设置是对应用户端的公告页面的、你可以使用MD语法或直接使用Html标签进行发布、您也可以直接粘贴上传图片、作为图床使用、其他地方比如上传商品等地方的图片也可以暂时在此作为临时方案。",type:"success"})]),_:1}),e(ne,{style:{margin:"20px"}},{header:o(()=>[d("div",Ce,[ke,d("div",he,[e(p,{class:"button",text:"",onClick:G},{default:o(()=>[_(" 保存设置 ")]),_:1}),e(p,{type:"primary",class:"button",onClick:t[0]||(t[0]=a=>S("add"))},{default:o(()=>[_(" 新增公告 ")]),_:1})])])]),default:o(()=>[e(M,{ref_key:"formRef",ref:O,rules:J.value,model:c,"label-width":"120px"},{default:o(()=>[e(D,null,{default:o(()=>[e(y,{xs:24,md:20,lg:15,xl:10},{default:o(()=>[e(f,{label:"公告标题",prop:"noticeTitle"},{default:o(()=>[e(V(C),{modelValue:c.noticeTitle,"onUpdate:modelValue":t[1]||(t[1]=a=>c.noticeTitle=a),rows:1,placeholder:"公告标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{offset:2,xs:24,md:20,lg:15,xl:10},{default:o(()=>[e(f,{label:"自动打开公告",prop:"isAutoOpenNotice"},{default:o(()=>[e(te,{content:"设为自动打开则网站初始化会打开、用户仍可以选择24小时不再查看、选择关闭则不会主动打开！",placement:"top","show-after":500},{default:o(()=>[e(ee,{modelValue:c.isAutoOpenNotice,"onUpdate:modelValue":t[2]||(t[2]=a=>c.isAutoOpenNotice=a),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{xs:24,md:20,lg:15,xl:12})]),_:1})]),_:1}),e(D,null,{default:o(()=>[e(y,{span:24})]),_:1})]),_:1},8,["rules","model"]),e(oe,{data:j.value,border:""},{default:o(()=>[e(m,{label:"id",prop:"id"}),e(m,{label:"排序",prop:"order"}),e(m,{label:"标题",prop:"title"}),e(m,{label:"标签",prop:"tags"}),e(m,{label:"创建时间",prop:"createdAt"}),e(m,{label:"操作",prop:"id",fixed:"right"},{default:o(a=>[e(le,{title:"确认删除本条公告吗？",onConfirm:b=>S("del",a.row)},{reference:o(()=>[e(p,{type:"danger",size:"small"},{default:o(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"]),e(p,{type:"primary",size:"small",onClick:b=>S("edit",a.row)},{default:o(()=>[_("修改")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),d("div",Ie,[e(ae,{layout:"prev, pager, next","page-size":10,total:K.value,onChange:t[3]||(t[3]=a=>{E.page=a})},null,8,["total"])])]),_:1}),e(ce,{modelValue:g.value,"onUpdate:modelValue":t[9]||(t[9]=a=>g.value=a),title:"公告",size:800},{footer:o(()=>[e(p,{type:"primary",onClick:Z},{default:o(()=>[_(P(q.value?"更新":"创建"),1)]),_:1})]),default:o(()=>[d("div",Te,[e(M,{model:s.value},{default:o(()=>[e(f,{label:"标题"},{default:o(()=>[e(V(C),{modelValue:s.value.title,"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.title=a)},null,8,["modelValue"])]),_:1}),e(f,{label:"排序"},{default:o(()=>[e(V(C),{modelValue:s.value.order,"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.order=a)},null,8,["modelValue"])]),_:1}),e(f,{label:"标签"},{default:o(()=>[d("div",Se,[(N(!0),B(me,null,_e(I.value,(a,b)=>(N(),ve(se,{key:b,type:"danger",effect:"dark",closable:"",onClose:Oe=>W(a,b)},{default:o(()=>[_(P(a),1)]),_:2},1032,["onClose"]))),128)),d("div",Ae,[w.value?ge("",!0):(N(),B("div",$e,[e(p,{size:"small",type:"primary",onClick:X},{default:o(()=>[e(ue,null,{default:o(()=>[e(ie)]),_:1})]),_:1})])),we(e(V(C),{ref_key:"tagInputRef",ref:z,modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=a=>v.value=a),onBlur:t[7]||(t[7]=a=>w.value=!1),onKeydown:be(xe(Y,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),[[ye,w.value]])])])]),_:1}),e(f,{label:"内容"},{default:o(()=>[e(Ve,{html:s.value.content,"onUpdate:html":t[8]||(t[8]=a=>s.value.content=a)},null,8,["html"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"])])}}});typeof L=="function"&&L(Be);export{Be as default};
