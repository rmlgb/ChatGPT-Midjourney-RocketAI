import{d as H,r as d,O as k,I as x,y as X,c as n,Q as Z,o as g,e as I,h as l,i as a,l as m,w as ee,L as U,g as o,t as h,f as te,J as le,K as ae,F as oe,k as se,m as ne,G as re,S as ue,E as L,z as ie,s as M}from"./index-a2cde0ca.js";import{A as C}from"./chatgpt-578817a1.js";import{h as de,Q as pe}from"./index-f74fb548.js";import{u as ce}from"./utcformatTime-e76e5157.js";const me={class:"flex justify-end mr-5"},_e=H({__name:"whiteList",setup(fe){const v=d(),u=d(0),y=d(!1),p=d(!1),V=d([]),z=d(0),_=k({page:1,size:10}),D=x(()=>u.value?"更新用户":"新增用户"),P=x(()=>u.value?"确认更新":"确认新增"),S=d([]),r=k({userId:"",status:1,count:10}),q=k({userId:[{required:!0,message:"请选择白名单用户",trigger:"change"}],status:[{required:!0,message:"请选择当前用户状态",trigger:"change"}],count:[{required:!0,message:"请填写限制使用次数",trigger:"blur"}]});async function B(s){const e=await re.queryAllUser({size:30,username:s});S.value=e.data.rows}async function b(){try{y.value=!0;const s=await C.queryWhiteUserList(_);y.value=!1;const{rows:e,count:f}=s.data;V.value=e,z.value=f}catch{y.value=!1}}function N(s){u.value=0,s==null||s.resetFields()}function Y(s){u.value=s.id;const{userId:e,count:f,status:c}=s;ue(()=>{Object.assign(r,{userId:e,count:f,status:c})}),p.value=!0}function T(s){s==null||s.validate(async e=>{e&&(u.value?(await C.updateWhiteUser({id:u.value,...r}),L.success("修改白名单用户成功")):(await C.addWhiteUser(r),L.success("添加白名单用户成功")),p.value=!1,b())})}return X(()=>{b()}),(s,e)=>{const f=n("el-alert"),c=n("el-button"),A=ie,i=n("el-table-column"),$=n("el-tag"),W=n("el-table"),j=n("el-pagination"),K=n("el-row"),F=n("el-option"),O=n("el-select"),w=n("el-form-item"),Q=n("el-input"),G=n("el-switch"),R=n("el-form"),E=n("el-dialog"),J=Z("loading");return g(),I("div",null,[l(A,null,{default:a(()=>[l(f,{closable:!1,"show-icon":"",title:"KEY池说明",description:"所有key会按key绑定的模型自动划分为卡池3模型与卡池4模型、key余额耗尽将会自动锁定、每张key支持单独绑定模型与代理、已经上下文长度设置、如果不设置默认以全局配置为准！",type:"success"}),l(c,{class:"mt-5",type:"primary",onClick:e[0]||(e[0]=t=>p.value=!0)},{default:a(()=>[m(" 添加白名单用户[添加用户可以使用GPT4模型] ")]),_:1})]),_:1}),l(A,null,{default:a(()=>[ee((g(),U(W,{border:"",data:V.value,style:{width:"100%"},size:"large"},{default:a(()=>[l(i,{prop:"username",label:"用户昵称"}),l(i,{prop:"email",label:"用户邮箱"}),l(i,{prop:"useCount",label:"调用次数"}),l(i,{prop:"count",label:"剩余额度"}),l(i,{prop:"status",align:"center",label:"启用状态"},{default:a(t=>[l($,{type:o(de)[t.row.status]},{default:a(()=>[m(h(o(pe)[t.row.status]),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"createdAt",align:"center",label:"添加时间"},{default:a(t=>[m(h(o(ce)(t.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),l(i,{label:"操作"},{default:a(t=>[l(c,{link:"",type:"primary",size:"small",onClick:ge=>Y(t.row)},{default:a(()=>[m(" 变更 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,y.value]]),l(K,{class:"flex justify-end mt-5"},{default:a(()=>[l(j,{"current-page":o(_).page,"onUpdate:currentPage":e[1]||(e[1]=t=>o(_).page=t),"page-size":o(_).size,"onUpdate:pageSize":e[2]||(e[2]=t=>o(_).size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(E,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=t=>p.value=t),"close-on-click-modal":!1,title:o(D),width:"400",onClose:e[10]||(e[10]=t=>N(v.value))},{footer:a(()=>[te("span",me,[l(c,{onClick:e[7]||(e[7]=t=>p.value=!1)},{default:a(()=>[m("取消")]),_:1}),l(c,{type:"primary",onClick:e[8]||(e[8]=t=>T(v.value))},{default:a(()=>[m(h(o(P)),1)]),_:1})])]),default:a(()=>[l(R,{ref_key:"formPackageRef",ref:v,"label-position":"right","label-width":"100px",model:o(r),rules:o(q)},{default:a(()=>[u.value?oe("",!0):(g(),U(w,{key:0,label:"用户昵称",prop:"userId"},{default:a(()=>[l(O,{modelValue:o(r).userId,"onUpdate:modelValue":e[3]||(e[3]=t=>o(r).userId=t),filterable:"",clearable:"",style:{width:"100%"},remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":B},{default:a(()=>[(g(!0),I(le,null,ae(S.value,t=>(g(),U(F,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),l(w,{label:"限制次数",prop:"count"},{default:a(()=>[l(Q,{modelValue:o(r).count,"onUpdate:modelValue":e[4]||(e[4]=t=>o(r).count=t),modelModifiers:{number:!0},placeholder:"请填写限制用户的访问次数！",onKeydown:e[5]||(e[5]=se(ne(t=>T(v.value),["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1}),l(w,{label:"启用状态",prop:"status"},{default:a(()=>[l(G,{modelValue:o(r).status,"onUpdate:modelValue":e[6]||(e[6]=t=>o(r).status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof M=="function"&&M(_e);export{_e as default};
