import{d as Q,r as f,O as N,y as W,c as o,Q as X,o as _,e as S,h as t,i as l,J as I,K as T,L as C,g as s,l as d,w as Z,f as V,t as m,M as ee,G as D,E as te,z as le,s as P}from"./index-a2cde0ca.js";import{m as z}from"./marked.esm-76161808.js";import{A as ae}from"./badWords-44370626.js";import{u as ne}from"./utcformatTime-e76e5157.js";import{T as oe,U as se,q as re,r as ue}from"./index-f74fb548.js";const ie=["src"],de={class:"answer"},pe=["innerHTML"],_e=Q({__name:"violation",setup(ce){const Y=new z.Renderer;z.setOptions({renderer:Y,gfm:!0,pedantic:!1,sanitize:!1});const b=f(!1),x=f([]),O=f(),A=f(0),u=N({userId:"",typeOriginCn:"",page:1,size:10}),M=f([]),g=f(!1),c=N({status:0,id:0});function B(n){g.value=!0,c.status=n.status,c.id=n.userId}async function j(){(await D.updateUserStatus(c)).success&&te({type:"success",message:"变更用户状态成功！"}),g.value=!1}async function v(){b.value=!0;try{const n=await ae.queryViolation(u);b.value=!1;const{rows:a,count:y}=n.data;A.value=y,M.value=a}catch{b.value=!1}}async function q(n){const a=await D.queryAllUser({size:30,username:n});x.value=a.data.rows}function E(n){n==null||n.resetFields(),v()}return W(()=>{v()}),(n,a)=>{const y=o("el-option"),U=o("el-select"),w=o("el-form-item"),h=o("el-button"),R=o("el-form"),L=le,r=o("el-table-column"),k=o("el-tag"),J=o("el-popover"),F=o("el-table"),G=o("el-pagination"),H=o("el-row"),$=o("el-dialog"),K=X("loading");return _(),S("div",null,[t(L,null,{default:l(()=>[t(R,{ref_key:"formRef",ref:O,inline:!0,model:u},{default:l(()=>[t(w,{label:"用户名称",prop:"userId"},{default:l(()=>[t(U,{modelValue:u.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>u.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":q},{default:l(()=>[(_(!0),S(I,null,T(s(x),e=>(_(),C(y,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"检测平台",prop:"typeOriginCn"},{default:l(()=>[t(U,{modelValue:u.typeOriginCn,"onUpdate:modelValue":a[1]||(a[1]=e=>u.typeOriginCn=e),placeholder:"请选择检测平台",clearable:""},{default:l(()=>[(_(!0),S(I,null,T(s(oe),e=>(_(),C(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:l(()=>[t(h,{type:"primary",onClick:v},{default:l(()=>[d(" 查询 ")]),_:1}),t(h,{onClick:a[2]||(a[2]=e=>E(s(O)))},{default:l(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(L,{style:{width:"100%"}},{default:l(()=>[Z((_(),C(F,{border:"",data:s(M),style:{width:"100%"},size:"large","tooltip-options":{}},{default:l(()=>[t(r,{fixed:"",prop:"userInfo.username",label:"用户名称",width:"150"}),t(r,{prop:"userInfo.avatar",label:"头像",width:"120"},{default:l(e=>{var i,p;return[V("img",{src:(p=(i=e.row)==null?void 0:i.userInfo)==null?void 0:p.avatar,style:{height:"50px"}},null,8,ie)]}),_:1}),t(r,{prop:"userInfo.email",label:"邮箱",width:"200"}),t(r,{prop:"status",label:"用户状态",width:"120",align:"center"},{default:l(({row:e})=>[t(k,{type:s(se)[e.userInfo.status]},{default:l(()=>[d(m(s(re)[e.userInfo.status]),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"userInfo.violationCount",label:"累计次数",width:"90",align:"center"}),t(r,{label:"违规类型"},{default:l(e=>[t(k,{type:"danger"},{default:l(()=>{var i,p;return[d(m((i=e.row)!=null&&i.typeCn?JSON.parse((p=e.row)==null?void 0:p.typeCn).join("  |  "):""),1)]}),_:2},1024)]),_:1}),t(r,{label:"违规关键词"},{default:l(e=>{var i,p;return[d(m((i=e.row)!=null&&i.words?JSON.parse((p=e.row)==null?void 0:p.words).join("  |  "):""),1)]}),_:1}),t(r,{prop:"typeOriginCn",label:"违规检测来源",width:"120"},{default:l(e=>[t(k,{type:"success"},{default:l(()=>[d(m(e.row.typeOriginCn),1)]),_:2},1024)]),_:1}),t(r,{prop:"answer",label:"违规内容",width:"200"},{default:l(e=>[t(J,{placement:"top",width:400,trigger:"click"},{reference:l(()=>[V("div",de,m(e.row.content),1)]),default:l(()=>[V("div",{class:"answer_container",innerHTML:s(z)(e.row.content||"")},null,8,pe)]),_:2},1024)]),_:1}),t(r,{prop:"createdAt",label:"违规时间",width:"200"},{default:l(e=>[d(m(s(ne)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(r,{fixed:"right",label:"操作",width:"120",align:"center"},{default:l(e=>[t(h,{link:"",type:"primary",size:"small",onClick:i=>B(e.row)},{default:l(()=>[d(" 变更用户状态 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,s(b)]]),t(H,{class:"flex justify-end mt-5"},{default:l(()=>[t(G,{"current-page":u.page,"onUpdate:currentPage":a[3]||(a[3]=e=>u.page=e),"page-size":u.size,"onUpdate:pageSize":a[4]||(a[4]=e=>u.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:s(A),onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t($,{modelValue:s(g),"onUpdate:modelValue":a[6]||(a[6]=e=>ee(g)?g.value=e:null),title:"变更用户状态",width:"500px"},{default:l(()=>[t(R,{model:c,inline:!0},{default:l(()=>[t(w,{label:"用户状态","label-width":"90px"},{default:l(()=>[t(U,{modelValue:c.status,"onUpdate:modelValue":a[5]||(a[5]=e=>c.status=e),placeholder:"请选择用户状态",clearable:""},{default:l(()=>[(_(!0),S(I,null,T(s(ue),e=>(_(),C(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:l(()=>[t(h,{type:"primary",onClick:j},{default:l(()=>[d(" 确认变更 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});typeof P=="function"&&P(_e);export{_e as default};
