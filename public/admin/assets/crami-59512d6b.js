import{d as ye,r as c,O as q,I as be,y as Ce,c as u,Q as ve,o as s,e as v,h as t,i as a,J as z,K as A,L as _,g as n,l as d,f as D,F as k,w as we,t as x,M as L,G as ke,E as R,z as Ve,s as Q}from"./index-a2cde0ca.js";import{A as M}from"./package-3a4bddab.js";import{u as he}from"./utcformatTime-e76e5157.js";import{C as Ue}from"./index-f74fb548.js";const xe={style:{float:"right"}},Me={key:1},Ie={class:"dialog-footer"},ze={style:{"max-height":"200px",overflow:"scroll"}},Ae={class:"dialog-footer"},De=ye({__name:"crami",setup($e){const S=c(),N=c(0),w=c(!1),V=c(!1),$=c(),h=c(0),T=c([]),P=c([]),y=c(!1),b=c([]),B=c([]),i=q({packageId:null,count:1,drawMjCount:0,model3Count:0,model4Count:0}),f=q({useId:"",status:"",page:1,size:15}),H=q({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],drawMjCount:[{required:!0,message:"卡密携带绘画数量",trigger:"blur"}],model3Count:[{required:!0,message:"卡密携带基础模型对话数量",trigger:"blur"}],model4Count:[{required:!0,message:"卡密携带高级模型金额",trigger:"blur"}]}),j=c([]);async function g(){try{y.value=!0;const o=await M.queryAllCrami(f),{rows:l,count:C}=o.data;y.value=!1,N.value=C,j.value=l}catch{y.value=!1}}async function W(o){const l=await ke.queryAllUser({size:30,username:o});P.value=l.data.rows}async function X(){const o=await M.queryAllPackage({size:100});T.value=o.data.rows}function Z(){X(),w.value=!0}async function E(o){o==null||o.validate(async l=>{l&&(await M.createCrami(i),R({type:"success",message:"生成卡密成功！"}),w.value=!1,g())})}function ee(o){o==null||o.resetFields()}function le(o){o==null||o.resetFields(),g()}async function te(o){await M.delCrami({id:o.id}),R({type:"success",message:"删除卡密成功！"}),g()}async function ae(o){b.value=o}async function oe(){try{y.value=!0,await M.batchDelCrami({ids:b.value.map(o=>o.id)}),y.value=!1,R({type:"success",message:"删除卡密成功！"}),g()}catch{y.value=!1}}function ne(){V.value=!0;const o=b.value.map(l=>`${l.code}<---->${l.packageName||"自定义套餐"}`);B.value=o}function re(o){return o.join(`
`)}function ue(o,l){const C=re(o),U=new Blob([C],{type:"text/plain"}),m=URL.createObjectURL(U),r=document.createElement("a");r.href=m,r.download=`${l}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>URL.revokeObjectURL(m),0)}function se(){const o=b.value.map(l=>`${l.code}<---->${l.packageName||"自定义套餐"}`);ue(o,"卡密信息")}const de=be(()=>j.value.some(o=>o.email));return Ce(()=>{g()}),(o,l)=>{const C=u("el-option"),U=u("el-select"),m=u("el-form-item"),r=u("el-button"),ie=u("Plus"),me=u("el-icon"),F=u("el-form"),O=Ve,p=u("el-table-column"),Y=u("el-tag"),pe=u("el-popconfirm"),ce=u("el-table"),fe=u("el-pagination"),G=u("el-row"),_e=u("el-switch"),I=u("el-input"),J=u("el-dialog"),ge=ve("loading");return s(),v("div",null,[t(O,null,{default:a(()=>[t(F,{ref_key:"formRef",ref:S,inline:!0,model:f},{default:a(()=>[t(m,{label:"用户名称",prop:"useId"},{default:a(()=>[t(U,{modelValue:f.useId,"onUpdate:modelValue":l[0]||(l[0]=e=>f.useId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":W},{default:a(()=>[(s(!0),v(z,null,A(n(P),e=>(s(),_(C,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"卡密状态",prop:"status"},{default:a(()=>[t(U,{modelValue:f.status,"onUpdate:modelValue":l[1]||(l[1]=e=>f.status=e),placeholder:"请选择卡密状态",clearable:""},{default:a(()=>[(s(!0),v(z,null,A(n(Ue),e=>(s(),_(C,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(r,{type:"primary",onClick:g},{default:a(()=>[d(" 查询 ")]),_:1}),t(r,{onClick:l[2]||(l[2]=e=>le(n(S)))},{default:a(()=>[d(" 重置 ")]),_:1})]),_:1}),D("div",xe,[n(b).length?(s(),_(r,{key:0,type:"danger",onClick:ne},{default:a(()=>[d(" 显示选中卡密 ")]),_:1})):k("",!0),n(b).length?(s(),_(r,{key:1,type:"danger",onClick:oe},{default:a(()=>[d(" 批量删除卡密 ")]),_:1})):k("",!0),n(b).length?(s(),_(r,{key:2,type:"primary",onClick:se},{default:a(()=>[d(" 批量导出卡密 ")]),_:1})):k("",!0),t(r,{type:"success",onClick:Z},{default:a(()=>[d(" 批量生成卡密 "),t(me,{class:"ml-3"},{default:a(()=>[t(ie)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),t(O,{style:{width:"100%"}},{default:a(()=>[we((s(),_(ce,{border:"",data:n(j),style:{width:"100%"},size:"large",onSelectionChange:ae},{default:a(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"code",label:"卡密账号",width:"180"}),t(p,{prop:"packageName",label:"套餐类型",width:"180"},{default:a(e=>[t(Y,{type:e.row.packageName?"success":"danger"},{default:a(()=>[d(x(e.row.packageName||"自定义卡密"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"code",label:"卡密状态",width:"180"},{default:a(e=>[t(Y,{type:e.row.status?"danger":"success"},{default:a(()=>[d(x(e.row.status?"已使用":"未使用"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"useId",label:"使用人ID",width:"90"}),n(de)?(s(),_(p,{key:0,prop:"email",label:"使用人邮箱",width:"180"})):k("",!0),t(p,{prop:"model3Count",label:"基础模型额度"}),t(p,{prop:"model4Count",label:"高级模型额度"}),t(p,{prop:"drawMjCount",label:"绘画模型额度"}),t(p,{prop:"days",label:"有效天数"},{default:a(e=>[d(x(e.row.days>0?`${e.row.days}天`:"永久"),1)]),_:1}),t(p,{prop:"createdAt",label:"注册时间",width:"200"},{default:a(e=>[d(x(n(he)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(p,{label:"操作"},{default:a(e=>[t(pe,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:K=>te(e.row)},{reference:a(()=>[t(r,{link:"",type:"danger",size:"small"},{default:a(()=>[d(" 删除卡密 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[ge,n(y)]]),t(G,{class:"flex justify-end mt-5"},{default:a(()=>[t(fe,{"current-page":f.page,"onUpdate:currentPage":l[3]||(l[3]=e=>f.page=e),"page-size":f.size,"onUpdate:pageSize":l[4]||(l[4]=e=>f.size=e),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:n(N),onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(J,{modelValue:n(w),"onUpdate:modelValue":l[13]||(l[13]=e=>L(w)?w.value=e:null),title:"生成卡密",width:"450",onClose:l[14]||(l[14]=e=>ee(n($)))},{footer:a(()=>[D("span",Ie,[t(r,{onClick:l[11]||(l[11]=e=>w.value=!1)},{default:a(()=>[d("放弃生成")]),_:1}),t(r,{type:"primary",onClick:l[12]||(l[12]=e=>E(n($)))},{default:a(()=>[d(" 确定生成 ")]),_:1})])]),default:a(()=>[t(F,{ref_key:"formCramiRef",ref:$,"label-position":"right","label-width":"100px",model:i,rules:H},{default:a(()=>[t(G,null,{default:a(()=>[t(m,{label:"是否生成自定义卡密","label-width":"170px"},{default:a(()=>[t(_e,{modelValue:n(h),"onUpdate:modelValue":l[5]||(l[5]=e=>L(h)?h.value=e:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),n(h)?k("",!0):(s(),_(m,{key:0,label:"套餐类型",prop:"packageId"},{default:a(()=>[t(U,{modelValue:i.packageId,"onUpdate:modelValue":l[6]||(l[6]=e=>i.packageId=e),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),v(z,null,A(n(T),e=>(s(),_(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),n(h)?(s(),v("div",Me,[t(m,{label:"基础模型额度",prop:"model3Count"},{default:a(()=>[t(I,{modelValue:i.model3Count,"onUpdate:modelValue":l[7]||(l[7]=e=>i.model3Count=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带基础模型额度"},null,8,["modelValue"])]),_:1}),t(m,{label:"高级模型额度",prop:"model4Count"},{default:a(()=>[t(I,{modelValue:i.model4Count,"onUpdate:modelValue":l[8]||(l[8]=e=>i.model4Count=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带高级模型额度"},null,8,["modelValue"])]),_:1}),t(m,{label:"绘画模型额度",prop:"drawMjCount"},{default:a(()=>[t(I,{modelValue:i.drawMjCount,"onUpdate:modelValue":l[9]||(l[9]=e=>i.drawMjCount=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带绘画积分额度"},null,8,["modelValue"])]),_:1})])):k("",!0),t(m,{label:"生成数量",prop:"count"},{default:a(()=>[t(I,{modelValue:i.count,"onUpdate:modelValue":l[10]||(l[10]=e=>i.count=e),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(J,{modelValue:n(V),"onUpdate:modelValue":l[16]||(l[16]=e=>L(V)?V.value=e:null),title:"卡密列表"},{footer:a(()=>[D("span",Ae,[t(r,{onClick:l[15]||(l[15]=e=>V.value=!1)},{default:a(()=>[d("关闭弹窗")]),_:1})])]),default:a(()=>[D("div",ze,[(s(!0),v(z,null,A(n(B),(e,K)=>(s(),v("div",{key:K},x(e),1))),128))])]),_:1},8,["modelValue"])])}}});typeof Q=="function"&&Q(De);export{De as default};
