'use strict';function _0x134a(){const _0x33e726=['@nestjs/passport','__metadata','50aKIIuO','verify','slice','../../modules/auth/auth.service','fingerprint','155KYCZEq','__decorate','@nestjs/common','env','authService','extractToken','HttpException','4208GItyKA','29034PZalFI','length','__esModule','authorization','err:\x20','6QXmeyq','2520UeIyqf','UnauthorizedException','2666148yXgDve','toString','function','getOwnPropertyDescriptor','design:paramtypes','AuthGuard','JWT_SECRET','UNAUTHORIZED','GlobalConfigService','user','split','metadata','object','RedisCacheService','Bearer','headers','switchToHttp','getRocKetAiToken','亲爱的用户,请登录后继续操作,我们正在等您的到来！','671937fywHzv','validateToken','18870HgpVih','14012bdTPuJ','@nestjs/core','decorate','../../modules/globalConfig/globalConfig.service','redisCacheService','1670WOESdJ','jsonwebtoken','globalConfigService','moduleRef','handleRequest','defineProperty','jwt','9031QNstDB','canActivate'];_0x134a=function(){return _0x33e726;};return _0x134a();}const _0x303f85=_0x55fd;(function(_0x2d7793,_0x31d42b){const _0xfcea6b=_0x55fd,_0x3e79f4=_0x2d7793();while(!![]){try{const _0x11c3bc=parseInt(_0xfcea6b(0x143))/0x1+-parseInt(_0xfcea6b(0x171))/0x2*(-parseInt(_0xfcea6b(0x160))/0x3)+parseInt(_0xfcea6b(0x161))/0x4*(parseInt(_0xfcea6b(0x176))/0x5)+parseInt(_0xfcea6b(0x148))/0x6*(-parseInt(_0xfcea6b(0x15e))/0x7)+parseInt(_0xfcea6b(0x142))/0x8*(-parseInt(_0xfcea6b(0x149))/0x9)+parseInt(_0xfcea6b(0x166))/0xa*(-parseInt(_0xfcea6b(0x16d))/0xb)+parseInt(_0xfcea6b(0x14b))/0xc;if(_0x11c3bc===_0x31d42b)break;else _0x3e79f4['push'](_0x3e79f4['shift']());}catch(_0x64882d){_0x3e79f4['push'](_0x3e79f4['shift']());}}}(_0x134a,0x215e6));var __decorate=this&&this[_0x303f85(0x13c)]||function(_0x2425c3,_0x5730c3,_0x30e11a,_0x50ba50){const _0x18c9a4=_0x303f85;var _0x5f1c1d=arguments[_0x18c9a4(0x144)],_0x9695a4=_0x5f1c1d<0x3?_0x5730c3:_0x50ba50===null?_0x50ba50=Object[_0x18c9a4(0x14e)](_0x5730c3,_0x30e11a):_0x50ba50,_0x3fd75c;if(typeof Reflect===_0x18c9a4(0x157)&&typeof Reflect[_0x18c9a4(0x163)]===_0x18c9a4(0x14d))_0x9695a4=Reflect[_0x18c9a4(0x163)](_0x2425c3,_0x5730c3,_0x30e11a,_0x50ba50);else{for(var _0x4c7e9e=_0x2425c3['length']-0x1;_0x4c7e9e>=0x0;_0x4c7e9e--)if(_0x3fd75c=_0x2425c3[_0x4c7e9e])_0x9695a4=(_0x5f1c1d<0x3?_0x3fd75c(_0x9695a4):_0x5f1c1d>0x3?_0x3fd75c(_0x5730c3,_0x30e11a,_0x9695a4):_0x3fd75c(_0x5730c3,_0x30e11a))||_0x9695a4;}return _0x5f1c1d>0x3&&_0x9695a4&&Object[_0x18c9a4(0x16b)](_0x5730c3,_0x30e11a,_0x9695a4),_0x9695a4;},__metadata=this&&this[_0x303f85(0x170)]||function(_0x34f086,_0x551a8d){const _0x2a41cf=_0x303f85;if(typeof Reflect===_0x2a41cf(0x157)&&typeof Reflect[_0x2a41cf(0x156)]===_0x2a41cf(0x14d))return Reflect[_0x2a41cf(0x156)](_0x34f086,_0x551a8d);};Object[_0x303f85(0x16b)](exports,_0x303f85(0x145),{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const redisCache_service_1=require('../../modules/redisCache/redisCache.service'),common_1=require(_0x303f85(0x13d)),passport_1=require(_0x303f85(0x16f)),jwt=require(_0x303f85(0x167)),core_1=require(_0x303f85(0x162)),globalConfig_service_1=require(_0x303f85(0x164)),auth_service_1=require(_0x303f85(0x174));function _0x55fd(_0xef7169,_0x44dab6){const _0x134aae=_0x134a();return _0x55fd=function(_0x55fd8f,_0x1e2ffb){_0x55fd8f=_0x55fd8f-0x13c;let _0xad2307=_0x134aae[_0x55fd8f];return _0xad2307;},_0x55fd(_0xef7169,_0x44dab6);}let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x303f85(0x150)])(_0x303f85(0x16c)){constructor(_0x5185c2,_0x50afa6,_0x22ef1c,_0x3b8b53){const _0x304ed7=_0x303f85;super(),this[_0x304ed7(0x165)]=_0x5185c2,this[_0x304ed7(0x169)]=_0x50afa6,this[_0x304ed7(0x168)]=_0x22ef1c,this['authService']=_0x3b8b53;}async[_0x303f85(0x16e)](_0x1bf5e3){const _0x1dd4d5=_0x303f85;!this[_0x1dd4d5(0x165)]&&(this[_0x1dd4d5(0x165)]=this[_0x1dd4d5(0x169)]['get'](redisCache_service_1['RedisCacheService'],{'strict':![]}));const _0x27af1f=_0x1bf5e3[_0x1dd4d5(0x15b)]()['getRequest'](),_0x4b5507=_0x27af1f[_0x1dd4d5(0x15a)]['x-website-domain'],_0x44e47c=this[_0x1dd4d5(0x140)](_0x27af1f);_0x27af1f[_0x1dd4d5(0x154)]=this['validateToken'](_0x44e47c);const _0xaaecf5=this['globalConfigService'][_0x1dd4d5(0x15c)]();return await this[_0x1dd4d5(0x165)]['checkTokenAuth'](_0x44e47c,_0x27af1f),!![];}[_0x303f85(0x140)](_0x4036f0){const _0xf9c9af=_0x303f85;if(!_0x4036f0['headers'][_0xf9c9af(0x146)]){if(_0x4036f0[_0xf9c9af(0x15a)][_0xf9c9af(0x175)]){let _0x292939=_0x4036f0[_0xf9c9af(0x15a)][_0xf9c9af(0x175)];_0x292939>0x7fffffff&&(_0x292939=_0x292939[_0xf9c9af(0x14c)]()[_0xf9c9af(0x173)](-0x9),_0x292939=Number(String(Number(_0x292939))));const _0x1200cd=this[_0xf9c9af(0x13f)]['createTokenFromFingerprint'](_0x292939);return _0x1200cd;}return null;}const _0x3fca58=_0x4036f0[_0xf9c9af(0x15a)][_0xf9c9af(0x146)][_0xf9c9af(0x155)]('\x20');if(_0x3fca58['length']!==0x2||_0x3fca58[0x0]!==_0xf9c9af(0x159))return null;return _0x3fca58[0x1];}[_0x303f85(0x15f)](_0x2e476c){const _0xd6cbe6=_0x303f85;try{return jwt[_0xd6cbe6(0x172)](_0x2e476c,process[_0xd6cbe6(0x13e)][_0xd6cbe6(0x151)]);}catch(_0x5ca75e){throw new common_1[(_0xd6cbe6(0x141))](_0xd6cbe6(0x15d),common_1['HttpStatus'][_0xd6cbe6(0x152)]);}}[_0x303f85(0x16a)](_0x51e9c7,_0x3316ca,_0xbb58c2){const _0x917a91=_0x303f85;if(_0x51e9c7||!_0x3316ca){console['log'](_0x917a91(0x147),_0x51e9c7);throw _0x51e9c7||new common_1[(_0x917a91(0x14a))]();}return _0x3316ca;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x303f85(0x14f),[redisCache_service_1[_0x303f85(0x158)],core_1['ModuleRef'],globalConfig_service_1[_0x303f85(0x153)],auth_service_1['AuthService']])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;