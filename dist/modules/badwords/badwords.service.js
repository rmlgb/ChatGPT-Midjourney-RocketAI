'use strict';const _0xed7e0a=_0x5aa9;(function(_0x1e475d,_0x44b6c4){const _0x5ca583=_0x5aa9,_0x4c4d96=_0x1e475d();while(!![]){try{const _0x2e158d=parseInt(_0x5ca583(0xe8))/0x1*(-parseInt(_0x5ca583(0xb1))/0x2)+-parseInt(_0x5ca583(0xbd))/0x3*(-parseInt(_0x5ca583(0xda))/0x4)+-parseInt(_0x5ca583(0xf0))/0x5*(-parseInt(_0x5ca583(0xa2))/0x6)+parseInt(_0x5ca583(0xf6))/0x7*(parseInt(_0x5ca583(0xb8))/0x8)+parseInt(_0x5ca583(0xe1))/0x9*(-parseInt(_0x5ca583(0xbc))/0xa)+-parseInt(_0x5ca583(0xde))/0xb*(parseInt(_0x5ca583(0xf9))/0xc)+parseInt(_0x5ca583(0xad))/0xd;if(_0x2e158d===_0x44b6c4)break;else _0x4c4d96['push'](_0x4c4d96['shift']());}catch(_0x5beb19){_0x4c4d96['push'](_0x4c4d96['shift']());}}}(_0x5f27,0xd1253));var __decorate=this&&this[_0xed7e0a(0xc3)]||function(_0x2e0df9,_0x17163c,_0x2a1d91,_0x2ca1f3){const _0x277541=_0xed7e0a;var _0x20a785=arguments['length'],_0x111ac9=_0x20a785<0x3?_0x17163c:_0x2ca1f3===null?_0x2ca1f3=Object[_0x277541(0xf2)](_0x17163c,_0x2a1d91):_0x2ca1f3,_0x3618;if(typeof Reflect===_0x277541(0xed)&&typeof Reflect['decorate']==='function')_0x111ac9=Reflect[_0x277541(0xb9)](_0x2e0df9,_0x17163c,_0x2a1d91,_0x2ca1f3);else{for(var _0x24c27e=_0x2e0df9[_0x277541(0xef)]-0x1;_0x24c27e>=0x0;_0x24c27e--)if(_0x3618=_0x2e0df9[_0x24c27e])_0x111ac9=(_0x20a785<0x3?_0x3618(_0x111ac9):_0x20a785>0x3?_0x3618(_0x17163c,_0x2a1d91,_0x111ac9):_0x3618(_0x17163c,_0x2a1d91))||_0x111ac9;}return _0x20a785>0x3&&_0x111ac9&&Object[_0x277541(0xa3)](_0x17163c,_0x2a1d91,_0x111ac9),_0x111ac9;},__metadata=this&&this[_0xed7e0a(0xb5)]||function(_0x38eb51,_0x341259){const _0x4afe36=_0xed7e0a;if(typeof Reflect===_0x4afe36(0xed)&&typeof Reflect[_0x4afe36(0xd0)]==='function')return Reflect['metadata'](_0x38eb51,_0x341259);},__param=this&&this[_0xed7e0a(0xc2)]||function(_0x3774a1,_0x16f507){return function(_0x232f70,_0x27f73e){_0x16f507(_0x232f70,_0x27f73e,_0x3774a1);};};Object['defineProperty'](exports,_0xed7e0a(0x91),{'value':!![]}),exports[_0xed7e0a(0xa5)]=void 0x0;function _0x5aa9(_0x34b655,_0x22b6c9){const _0x5f275c=_0x5f27();return _0x5aa9=function(_0x5aa904,_0x1017bb){_0x5aa904=_0x5aa904-0x8c;let _0x23ec92=_0x5f275c[_0x5aa904];return _0x23ec92;},_0x5aa9(_0x34b655,_0x22b6c9);}const globalConfig_service_1=require(_0xed7e0a(0xf7)),common_1=require(_0xed7e0a(0xe9)),badwords_entity_1=require(_0xed7e0a(0xcf)),typeorm_1=require('typeorm'),typeorm_2=require(_0xed7e0a(0x8f)),axios_1=require(_0xed7e0a(0xeb)),violationLog_entity_1=require(_0xed7e0a(0x8d)),user_entity_1=require('../user/user.entity'),utils_1=require(_0xed7e0a(0xbb));function _0x5f27(){const _0x47288c=['violation','log','category','ASC','删除敏感词成功','1493oITpTX','@nestjs/common','push','axios','Injectable','object','rocketaiCheckBadWords','length','5540795WsEBLA','RocKetAi检测','getOwnPropertyDescriptor','findOne','globalConfigService','stringify','469BoXZKZ','./../globalConfig/globalConfig.service','join','2078940CnyzEN','checkBadWordsByConfig','extractContent','badWords','post','update','敏感词已存在,请检查您的提交信息','./violationLog.entity','design:paramtypes','@nestjs/typeorm','baiduTextAccessToken','__esModule','rocketai','您提交的内容中包含','status','baidu','userId','InjectRepository','formarTips','更新敏感词失败','word_list','addBadWord','HttpStatus','find','includes','hideString','delete','application/x-www-form-urlencoded','6hyOmzP','defineProperty','的信息、我们已对您账号进行标记、请合规使用！','BadwordsService','userInfo','map','BadWordsEntity','HttpException','***','delBadWords','recordUserBadWords','1937611NUQczW','save','findAndCount','user','2070iRRfxt','violationLogEntity','code','data','__metadata','baiduCheckBadWords','word','99688mqyHqC','decorate','error:\x20','../../common/utils','327130RRPKPW','3hnVlOu','BAD_REQUEST','百度云检测','添加敏感词成功','您提交的信息中包含','__param','__decorate','customSensitiveWords','affected','敏感词检测\x20|\x20','UserEntity','username','删除敏感词失败','keyword','execute','violationCount','loadBadWords','msg','./badwords.entity','metadata','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','queryBadWords','onModuleInit','badWordsEntity','getSensitiveConfig','default','检测失败','application/json','createQueryBuilder','5726972tYATpI','更新敏感词成功','set','自定义','11gWbKxl','email','userEntity','261TDKvZQ','敏感词已经存在了、请勿重复添加'];_0x5f27=function(){return _0x47288c;};return _0x5f27();}let BadwordsService=class BadwordsService{constructor(_0x2b5296,_0x4affaf,_0x4f9398,_0x5a3cac){const _0x9e1755=_0xed7e0a;this[_0x9e1755(0xd4)]=_0x2b5296,this[_0x9e1755(0xb2)]=_0x4affaf,this[_0x9e1755(0xe0)]=_0x4f9398,this[_0x9e1755(0xf4)]=_0x5a3cac,this[_0x9e1755(0xfc)]=[];}async[_0xed7e0a(0xd3)](){const _0x41d60f=_0xed7e0a;this[_0x41d60f(0xcd)]();}async[_0xed7e0a(0xc4)](_0xb3c157,_0x382663){const _0x5b46ee=_0xed7e0a,_0x1911f2=[];for(let _0x59aa5b=0x0;_0x59aa5b<this[_0x5b46ee(0xfc)][_0x5b46ee(0xef)];_0x59aa5b++){const _0x5568c3=this[_0x5b46ee(0xfc)][_0x59aa5b];_0xb3c157[_0x5b46ee(0x9e)](_0x5568c3)&&_0x1911f2[_0x5b46ee(0xea)](_0x5568c3);}if(_0x1911f2[_0x5b46ee(0xef)]){await this[_0x5b46ee(0xac)](_0x382663,_0xb3c157,_0x1911f2,[_0x5b46ee(0xdd)],'自定义检测');const _0x12d489=_0x5b46ee(0xd1);throw new common_1[(_0x5b46ee(0xa9))](_0x12d489,common_1['HttpStatus'][_0x5b46ee(0xbe)]);}}async['checkBadWords'](_0x2abffa,_0x375032){const _0x44a478=_0xed7e0a,_0x4137a0=await this[_0x44a478(0xf4)][_0x44a478(0xd5)]();_0x4137a0&&await this[_0x44a478(0xfa)](_0x2abffa,_0x4137a0,_0x375032),await this['customSensitiveWords'](_0x2abffa,_0x375032);}async['checkBadWordsByConfig'](_0x5046b1,_0x227bdc,_0x410110){const _0x3ae271=_0xed7e0a,{useType:_0x2cee1f}=_0x227bdc;_0x2cee1f===_0x3ae271(0x95)&&await this[_0x3ae271(0xb6)](_0x5046b1,_0x227bdc[_0x3ae271(0x90)],_0x410110),_0x2cee1f===_0x3ae271(0x92)&&await this['rocketaiCheckBadWords'](_0x5046b1,_0x227bdc,_0x410110);}['extractContent'](_0x48921f){const _0x2b3b4b=/存在(.*?)不合规/,_0x479bd8=_0x48921f['match'](_0x2b3b4b);return _0x479bd8?_0x479bd8[0x1]:'';}async['baiduCheckBadWords'](_0x3a6ba9,_0x4ca5b3,_0x190dc1){const _0x901c7f=_0xed7e0a;if(!_0x4ca5b3)return;const _0x40623f='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x4ca5b3+'}',_0x3f734c={'Content-Type':_0x901c7f(0xa1),'Accept':'application/json'},_0x4f9490=await axios_1[_0x901c7f(0xd6)][_0x901c7f(0xfd)](_0x40623f,{'text':_0x3a6ba9},{'headers':_0x3f734c}),{conclusion:_0x3e1936,error_code:_0x20f363,error_msg:_0x584caf,conclusionType:_0x48b9cb,data:_0x478ff9}=_0x4f9490['data'];_0x20f363&&console[_0x901c7f(0xe4)]('百度文本检测出现错误、请查看配置信息:\x20',_0x584caf);if(_0x48b9cb!==0x1){const _0x475d8d=[...new Set(_0x478ff9[_0x901c7f(0xa7)](_0x3153db=>this[_0x901c7f(0xfb)](_0x3153db[_0x901c7f(0xce)])))];await this[_0x901c7f(0xac)](_0x190dc1,_0x3a6ba9,[_0x901c7f(0xaa)],_0x475d8d,_0x901c7f(0xbf));const _0x50086e=_0x901c7f(0xc1)+_0x475d8d[_0x901c7f(0xf8)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x901c7f(0xa9))](_0x50086e,common_1['HttpStatus'][_0x901c7f(0xbe)]);}}async[_0xed7e0a(0xee)](_0x187edd,_0x337921,_0x172071){const _0x3210cb=_0xed7e0a;var _0x5edacc;const {rocketaiBuiltInSensitiveApiBase:_0x1f017a,rocketaiBuiltInSensitiveAuthKey:_0x2ea5f9}=_0x337921;if(!_0x1f017a||!_0x2ea5f9)return;const _0x470366=await axios_1[_0x3210cb(0xd6)][_0x3210cb(0xfd)](_0x1f017a,{'content':_0x187edd},{'headers':{'Content-Type':_0x3210cb(0xd8),'Authorization':_0x2ea5f9}});if(!_0x470366['data'])return;if(_0x470366[_0x3210cb(0xb4)][_0x3210cb(0xb3)]!=='0'){const {msg:msg=_0x3210cb(0xd7)}=_0x470366[_0x3210cb(0xb4)];throw new common_1['HttpException'](_0x3210cb(0xc6)+msg,common_1[_0x3210cb(0x9c)]['BAD_REQUEST']);}if(_0x470366[_0x3210cb(0xb4)][_0x3210cb(0x9a)]&&((_0x5edacc=_0x470366[_0x3210cb(0xb4)]['word_list'])===null||_0x5edacc===void 0x0?void 0x0:_0x5edacc[_0x3210cb(0xef)])){const _0xcafc3a=[...new Set(_0x470366['data'][_0x3210cb(0x9a)]['map'](_0x2245a4=>_0x2245a4[_0x3210cb(0xca)]))],_0x1cc09c=[...new Set(_0x470366[_0x3210cb(0xb4)]['word_list'][_0x3210cb(0xa7)](_0x409900=>_0x409900[_0x3210cb(0xe5)]))];await this[_0x3210cb(0xac)](_0x172071,_0x187edd,_0xcafc3a,_0x1cc09c,_0x3210cb(0xf1));const _0xd7d50c=this[_0x3210cb(0x98)](_0x470366[_0x3210cb(0xb4)][_0x3210cb(0x9a)]);throw new common_1[(_0x3210cb(0xa9))](_0xd7d50c,common_1[_0x3210cb(0x9c)]['BAD_REQUEST']);}}[_0xed7e0a(0x98)](_0x3dda7c){const _0x2088fa=_0xed7e0a,_0x215150=_0x3dda7c['map'](_0x126e3a=>_0x126e3a[_0x2088fa(0xe5)]),_0x458a8e=[...new Set(_0x215150)];return _0x2088fa(0x93)+_0x458a8e['join'](',')+_0x2088fa(0xa4);}async['loadBadWords'](){const _0x583909=_0xed7e0a,_0x1bed46=await this['badWordsEntity'][_0x583909(0x9d)]({'where':{'status':0x1},'select':[_0x583909(0xb7)]});this[_0x583909(0xfc)]=_0x1bed46[_0x583909(0xa7)](_0x2a2d19=>_0x2a2d19[_0x583909(0xb7)]);}async[_0xed7e0a(0xd2)](_0x2d387f){const _0x28ae6f=_0xed7e0a,{page:page=0x1,size:size=0x1f4,word:_0xabc43d,status:_0x29a055}=_0x2d387f,_0x1653e8={};[0x0,0x1,'0','1'][_0x28ae6f(0x9e)](_0x29a055)&&(_0x1653e8[_0x28ae6f(0x94)]=_0x29a055),_0xabc43d&&(_0x1653e8[_0x28ae6f(0xb7)]=(0x0,typeorm_1['Like'])('%'+_0xabc43d+'%'));const [_0x2277b7,_0x4df83f]=await this[_0x28ae6f(0xd4)][_0x28ae6f(0xaf)]({'where':_0x1653e8,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x28ae6f(0xe6)}});return{'rows':_0x2277b7,'count':_0x4df83f};}async[_0xed7e0a(0xab)](_0x49f7e2){const _0xa163dc=_0xed7e0a,_0x498421=await this[_0xa163dc(0xd4)][_0xa163dc(0xf3)]({'where':{'id':_0x49f7e2['id']}});if(!_0x498421)throw new common_1['HttpException']('敏感词不存在,请检查您的提交信息',common_1[_0xa163dc(0x9c)][_0xa163dc(0xbe)]);const _0x40ab09=await this[_0xa163dc(0xd4)][_0xa163dc(0xa0)]({'id':_0x49f7e2['id']});if(_0x40ab09[_0xa163dc(0xc5)]>0x0)return await this[_0xa163dc(0xcd)](),_0xa163dc(0xe7);else throw new common_1[(_0xa163dc(0xa9))](_0xa163dc(0xc9),common_1[_0xa163dc(0x9c)][_0xa163dc(0xbe)]);}async['updateBadWords'](_0x43c855){const _0xcb9bdc=_0xed7e0a,{id:_0x5be8f0,word:_0x950d13,status:_0x1769f5}=_0x43c855,_0x25a580=await this[_0xcb9bdc(0xd4)][_0xcb9bdc(0xf3)]({'where':{'word':_0x950d13}});if(_0x25a580)throw new common_1[(_0xcb9bdc(0xa9))](_0xcb9bdc(0xe2),common_1[_0xcb9bdc(0x9c)][_0xcb9bdc(0xbe)]);const _0x26dec3=await this['badWordsEntity'][_0xcb9bdc(0xfe)]({'id':_0x5be8f0},{'word':_0x950d13,'status':_0x1769f5});if(_0x26dec3['affected']>0x0)return await this['loadBadWords'](),_0xcb9bdc(0xdb);else throw new common_1[(_0xcb9bdc(0xa9))](_0xcb9bdc(0x99),common_1['HttpStatus']['BAD_REQUEST']);}async[_0xed7e0a(0x9b)](_0x48b5ad){const _0x29dff8=_0xed7e0a,{word:_0x1860a4}=_0x48b5ad,_0x9632db=await this[_0x29dff8(0xd4)][_0x29dff8(0xf3)]({'where':{'word':_0x1860a4}});if(_0x9632db)throw new common_1['HttpException'](_0x29dff8(0x8c),common_1[_0x29dff8(0x9c)][_0x29dff8(0xbe)]);return await this[_0x29dff8(0xd4)][_0x29dff8(0xae)]({'word':_0x1860a4}),await this[_0x29dff8(0xcd)](),_0x29dff8(0xc0);}async[_0xed7e0a(0xac)](_0x352c5f,_0x4ad9d8,_0xb73a20,_0x1922b5,_0x3c471d){const _0xb98211=_0xed7e0a,_0x1921c4={'userId':_0x352c5f,'content':_0x4ad9d8,'words':JSON[_0xb98211(0xf5)](_0xb73a20),'typeCn':JSON[_0xb98211(0xf5)](_0x1922b5),'typeOriginCn':_0x3c471d};try{await this[_0xb98211(0xe0)][_0xb98211(0xd9)]()[_0xb98211(0xfe)](user_entity_1['UserEntity'])[_0xb98211(0xdc)]({'violationCount':()=>'violationCount\x20+\x201'})['where']('id\x20=\x20:userId',{'userId':_0x352c5f})[_0xb98211(0xcb)](),await this[_0xb98211(0xb2)][_0xb98211(0xae)](_0x1921c4);}catch(_0x5419e9){console[_0xb98211(0xe4)](_0xb98211(0xba),_0x5419e9);}}async[_0xed7e0a(0xe3)](_0x408f72,_0x2fc552){const _0x3de9f7=_0xed7e0a,{role:_0x6db16a}=_0x408f72[_0x3de9f7(0xb0)],{page:page=0x1,size:size=0xa,userId:_0x35ce2e,typeOriginCn:_0x52fa05}=_0x2fc552,_0x246a0c={};_0x35ce2e&&(_0x246a0c['userId']=_0x35ce2e),_0x52fa05&&(_0x246a0c['typeOriginCn']=_0x52fa05);const [_0x264726,_0x4fec47]=await this[_0x3de9f7(0xb2)][_0x3de9f7(0xaf)]({'where':_0x246a0c,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x2a8b5f=[...new Set(_0x264726['map'](_0x60d5c8=>_0x60d5c8['userId']))],_0x2ee768=await this['userEntity'][_0x3de9f7(0x9d)]({'where':{'id':(0x0,typeorm_1['In'])(_0x2a8b5f)},'select':['id','avatar',_0x3de9f7(0xc8),_0x3de9f7(0xdf),_0x3de9f7(0xcc),'status']});return _0x264726['forEach'](_0xbf7afc=>{const _0x1062ff=_0x3de9f7,_0x29f9b2=_0x2ee768[_0x1062ff(0x9d)](_0xe0a81b=>_0xe0a81b['id']===_0xbf7afc[_0x1062ff(0x96)]);_0x6db16a!=='super'&&(_0x29f9b2[_0x1062ff(0xdf)]=(0x0,utils_1[_0x1062ff(0x9f)])(_0x29f9b2['email'])),_0xbf7afc[_0x1062ff(0xa6)]=_0x29f9b2;}),{'rows':_0x264726,'count':_0x4fec47};}};BadwordsService=__decorate([(0x0,common_1[_0xed7e0a(0xec)])(),__param(0x0,(0x0,typeorm_2[_0xed7e0a(0x97)])(badwords_entity_1[_0xed7e0a(0xa8)])),__param(0x1,(0x0,typeorm_2[_0xed7e0a(0x97)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0xed7e0a(0x97)])(user_entity_1[_0xed7e0a(0xc7)])),__metadata(_0xed7e0a(0x8e),[typeorm_1['Repository'],typeorm_1['Repository'],typeorm_1['Repository'],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports[_0xed7e0a(0xa5)]=BadwordsService;