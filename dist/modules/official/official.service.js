'use strict';const _0x3e6379=_0x3e1a;(function(_0x51884f,_0x44902c){const _0x1a508a=_0x3e1a,_0x2e91f4=_0x51884f();while(!![]){try{const _0x3e0b9c=-parseInt(_0x1a508a(0x14c))/0x1+parseInt(_0x1a508a(0x14b))/0x2*(-parseInt(_0x1a508a(0x162))/0x3)+-parseInt(_0x1a508a(0x16a))/0x4*(parseInt(_0x1a508a(0x132))/0x5)+-parseInt(_0x1a508a(0x17c))/0x6+parseInt(_0x1a508a(0x144))/0x7+parseInt(_0x1a508a(0x178))/0x8+parseInt(_0x1a508a(0x13f))/0x9*(parseInt(_0x1a508a(0x176))/0xa);if(_0x3e0b9c===_0x44902c)break;else _0x2e91f4['push'](_0x2e91f4['shift']());}catch(_0x353e44){_0x2e91f4['push'](_0x2e91f4['shift']());}}}(_0x4c8d,0x7d5d4));function _0x3e1a(_0x543a26,_0x5e19f){const _0x4c8dbc=_0x4c8d();return _0x3e1a=function(_0x3e1aad,_0x287e3f){_0x3e1aad=_0x3e1aad-0x128;let _0xc626e4=_0x4c8dbc[_0x3e1aad];return _0xc626e4;},_0x3e1a(_0x543a26,_0x5e19f);}var __decorate=this&&this['__decorate']||function(_0x9f4abb,_0x4d99ad,_0x142513,_0x1ed2b2){const _0x2ae188=_0x3e1a;var _0x59964f=arguments['length'],_0x5895fd=_0x59964f<0x3?_0x4d99ad:_0x1ed2b2===null?_0x1ed2b2=Object['getOwnPropertyDescriptor'](_0x4d99ad,_0x142513):_0x1ed2b2,_0x44fc8d;if(typeof Reflect===_0x2ae188(0x179)&&typeof Reflect[_0x2ae188(0x147)]==='function')_0x5895fd=Reflect['decorate'](_0x9f4abb,_0x4d99ad,_0x142513,_0x1ed2b2);else{for(var _0x4e760c=_0x9f4abb[_0x2ae188(0x12f)]-0x1;_0x4e760c>=0x0;_0x4e760c--)if(_0x44fc8d=_0x9f4abb[_0x4e760c])_0x5895fd=(_0x59964f<0x3?_0x44fc8d(_0x5895fd):_0x59964f>0x3?_0x44fc8d(_0x4d99ad,_0x142513,_0x5895fd):_0x44fc8d(_0x4d99ad,_0x142513))||_0x5895fd;}return _0x59964f>0x3&&_0x5895fd&&Object['defineProperty'](_0x4d99ad,_0x142513,_0x5895fd),_0x5895fd;},__metadata=this&&this['__metadata']||function(_0x195643,_0x5ef0a1){const _0x36031a=_0x3e1a;if(typeof Reflect===_0x36031a(0x179)&&typeof Reflect[_0x36031a(0x16e)]==='function')return Reflect['metadata'](_0x195643,_0x5ef0a1);};function _0x4c8d(){const _0x17c87b=['hex','length','getUserById','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','100giGoRh','wechatOfficialAppSecret',']]></Content>\x0a\x20\x20\x20\x20</xml>','str:\x20','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','./../chatgpt/chatgpt.service','getRedirectUrl','回跳跳转地址:\x20','&url=','&grant_type=authorization_code','design:paramtypes','post','Injectable','8312697ylOuur','genXmlMsgByConfig','aotoPlay','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','4297923FGxklZ','fetchQRCodeTicket','HttpException','decorate','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','checkAutoReply','getQRCodeTicket','1263228zYdZdQ','540908MWQuyr','jsapi_ticket=',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','OfficialService','genXmlMsg','scanedSceneStrMap','fromusername','race','default','appId:\x20','verify','wechatOfficialAppId','createRandomNonceStr','tousername','BAD_REQUEST','axios','sort','getJsapiTicket','authService','非法参数','toFixed','chatSyncFree','3AannPO','@nestjs/common','getTime','loginBySceneStr','UserService','&secret=','globalConfigService','jiangly','44860pMNlKo','scanBindWx','createHash','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','metadata','./../autoreply/autoreply.service','log','autoreplyService','chatgptService','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','AutoreplyService','10rczmcb','./../auth/auth.service','4422144SuiGhF','object','__esModule','wechatOfficialToken','1080456gJHUqv','getUserFromOpenId','getQRSceneStrByBind','digest','&redirect_uri=','split','bindWxBySceneStr','crypto','onModuleInit','sha1','GlobalConfigService','jsapiTicket:\x20','sceneStrMap','../../common/utils','loginByOpenId','getConfigs','officialAutoReplyText','getUserOpenId','user','userService','defineProperty','HttpStatus','AuthService'];_0x4c8d=function(){return _0x17c87b;};return _0x4c8d();}Object[_0x3e6379(0x12b)](exports,_0x3e6379(0x17a),{'value':!![]}),exports[_0x3e6379(0x14f)]=void 0x0;const chatgpt_service_1=require(_0x3e6379(0x137)),globalConfig_service_1=require('./../globalConfig/globalConfig.service'),auth_service_1=require(_0x3e6379(0x177)),user_service_1=require('./../user/user.service'),autoreply_service_1=require(_0x3e6379(0x16f)),common_1=require(_0x3e6379(0x163)),crypto=require(_0x3e6379(0x183)),axios_1=require(_0x3e6379(0x15b)),utils_1=require(_0x3e6379(0x189));let OfficialService=class OfficialService{constructor(_0x5ade7b,_0x38581c,_0x5b3fa2,_0x434926,_0x3d2271){const _0x5cc2c3=_0x3e6379;this[_0x5cc2c3(0x171)]=_0x5ade7b,this['userService']=_0x38581c,this['authService']=_0x5b3fa2,this[_0x5cc2c3(0x168)]=_0x434926,this[_0x5cc2c3(0x172)]=_0x3d2271,this['sceneStrMap']={},this['scanedSceneStrMap']={};}async[_0x3e6379(0x184)](){const _0x1eaa34=_0x3e6379;await this[_0x1eaa34(0x168)]['getWechatAccessToken'](!![]);}async['getQRSceneStr'](_0x197e2f){const _0x4943f0=_0x3e6379,{invitedBy:_0x33b008}=_0x197e2f;let _0x4e6d76=(0x0,utils_1[_0x4943f0(0x158)])(0x20);return _0x33b008&&(_0x4e6d76+=':'+_0x33b008),this[_0x4943f0(0x188)][_0x4e6d76]=!![],_0x4e6d76;}async[_0x3e6379(0x17e)](_0x44fd7){const _0x5cace6=_0x3e6379,{id:_0x556df9}=_0x44fd7[_0x5cace6(0x129)],_0x18cbf8=(0x0,utils_1[_0x5cace6(0x158)])(0x20)+'/'+_0x556df9;return this[_0x5cace6(0x188)][_0x18cbf8]=!![],_0x18cbf8;}async[_0x3e6379(0x14a)](_0x48ce7c){const _0xeafc1a=_0x3e6379;return this[_0xeafc1a(0x145)](_0x48ce7c);}async[_0x3e6379(0x138)](_0x25e366){const _0x489f78=_0x3e6379,_0x558f0e=await this[_0x489f78(0x168)]['getConfigs'](['wechatOfficialAppId']),_0x3a9c27=_0x489f78(0x148)+_0x558f0e+_0x489f78(0x180)+encodeURIComponent(_0x25e366)+_0x489f78(0x174);return console['log'](_0x489f78(0x139),_0x3a9c27),_0x3a9c27;}async[_0x3e6379(0x15d)](_0x2d817e){const _0x195704=_0x3e6379,_0x306fd3=(0x0,utils_1[_0x195704(0x158)])(0x20),_0x19b67e=(Date['now']()/0x3e8)[_0x195704(0x160)](0x0),_0x1f9797=await this[_0x195704(0x168)][_0x195704(0x18b)](['wechatJsapiTicket']);console[_0x195704(0x170)](_0x195704(0x187),_0x1f9797);const _0x2775b5=await this[_0x195704(0x168)]['getConfigs'](['wechatOfficialAppId']);console['log'](_0x195704(0x155),_0x2775b5);const _0x31554d=_0x195704(0x14d)+_0x1f9797+'&noncestr='+_0x306fd3+'&timestamp='+_0x19b67e+_0x195704(0x13a)+_0x2d817e;console['log'](_0x195704(0x135),_0x31554d);const _0x3909fe=this['sha1'](_0x31554d);return{'appId':_0x2775b5,'nonceStr':_0x306fd3,'timestamp':_0x19b67e,'signature':_0x3909fe};}async[_0x3e6379(0x145)](_0x14fb28){const _0x44fcf8=_0x3e6379,_0x5cdf26=await this[_0x44fcf8(0x168)][_0x44fcf8(0x18b)](['wechatAccessToken']),_0x4382f9={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x14fb28}}},_0x4531e0=await axios_1['default'][_0x44fcf8(0x13d)](_0x44fcf8(0x131)+_0x5cdf26,_0x4382f9),{data:{errmsg:_0x5e2fcf,ticket:_0x3d64ba}}=_0x4531e0;if(_0x5e2fcf)throw new common_1[(_0x44fcf8(0x146))](_0x5e2fcf,common_1[_0x44fcf8(0x12c)][_0x44fcf8(0x15a)]);return _0x3d64ba;}async['loginByCode'](_0x16d252,_0x5cc920){const _0x5b556c=_0x3e6379,_0x1d8599=await this[_0x5b556c(0x168)][_0x5b556c(0x18b)]([_0x5b556c(0x157)]),_0x416145=await this[_0x5b556c(0x168)][_0x5b556c(0x18b)]([_0x5b556c(0x133)]),_0x3f27a8=await axios_1[_0x5b556c(0x154)]['get'](_0x5b556c(0x136)+_0x1d8599+_0x5b556c(0x167)+_0x416145+'&code='+_0x5cc920+_0x5b556c(0x13b)),{data:{errmsg:_0x249324,openid:_0x25a4fb}}=_0x3f27a8;if(_0x249324)throw new common_1['HttpException'](_0x249324,common_1[_0x5b556c(0x12c)]['BAD_REQUEST']);let _0x490ec5;return _0x490ec5=await this[_0x5b556c(0x12a)][_0x5b556c(0x128)](_0x25a4fb),!_0x490ec5&&(_0x490ec5=await this[_0x5b556c(0x12a)][_0x5b556c(0x17d)](_0x25a4fb)),this[_0x5b556c(0x15e)][_0x5b556c(0x18a)](_0x490ec5,_0x16d252);}async['scan'](_0xe5254e,_0x70513f){const _0x575fdd=_0x3e6379;if(!this[_0x575fdd(0x188)][_0x70513f])throw new common_1['HttpException'](_0x575fdd(0x15f),common_1['HttpStatus'][_0x575fdd(0x15a)]);const _0x5475ad=await this[_0x575fdd(0x12a)][_0x575fdd(0x17d)](_0xe5254e,_0x70513f);this[_0x575fdd(0x151)][_0x70513f]=_0x5475ad['id'];}async[_0x3e6379(0x165)](_0x2d9a3e,_0x64b05a){const _0x505dc2=_0x3e6379;if(!this[_0x505dc2(0x188)][_0x64b05a])return;const _0x34337d=this[_0x505dc2(0x151)][_0x64b05a];if(!_0x34337d)return'';const _0x3932df=await this[_0x505dc2(0x12a)][_0x505dc2(0x130)](_0x34337d);return delete this[_0x505dc2(0x151)][_0x64b05a],this['authService'][_0x505dc2(0x18a)](_0x3932df,_0x2d9a3e);}async[_0x3e6379(0x16b)](_0x445061,_0x27afd5){const _0x47d89c=_0x3e6379;if(!this[_0x47d89c(0x188)][_0x27afd5])throw new common_1[(_0x47d89c(0x146))](_0x47d89c(0x15f),common_1[_0x47d89c(0x12c)]['BAD_REQUEST']);const _0x494995=_0x27afd5[_0x47d89c(0x181)]('/')[0x1],_0x27b2b4=await this[_0x47d89c(0x12a)]['bindWx'](_0x445061,_0x494995);this['scanedSceneStrMap'][_0x27afd5]=_0x27b2b4;}async[_0x3e6379(0x182)](_0x4110cb,_0x1a3242){const _0x140ec2=_0x3e6379;if(!this[_0x140ec2(0x188)][_0x1a3242])throw new common_1[(_0x140ec2(0x146))](_0x140ec2(0x15f),common_1[_0x140ec2(0x12c)][_0x140ec2(0x15a)]);const {id:_0xa4a9a0}=_0x4110cb['user'],_0x596f56=this[_0x140ec2(0x151)][_0x1a3242];if(!_0x596f56)return'';return delete this[_0x140ec2(0x151)][_0x1a3242],_0x596f56;}async[_0x3e6379(0x156)](_0x174243,_0x2e493f,_0x43948c){const _0x2e190c=_0x3e6379,_0x50b24f=await this['globalConfigService']['getConfigs']([_0x2e190c(0x17b)])||_0x2e190c(0x169);return await this[_0x2e190c(0x185)]([_0x50b24f,_0x2e493f,_0x43948c][_0x2e190c(0x15c)]()['join'](''))==_0x174243;}['sha1'](_0x21e79f){const _0x1ab6c0=_0x3e6379;return crypto[_0x1ab6c0(0x16c)](_0x1ab6c0(0x185))['update'](_0x21e79f)[_0x1ab6c0(0x17f)](_0x1ab6c0(0x12e));}async[_0x3e6379(0x140)](_0x4b97ce,_0x324048){const _0x1409d9=_0x3e6379,_0x2b4fb8=await this[_0x1409d9(0x168)][_0x1409d9(0x18b)]([_0x324048]);return this[_0x1409d9(0x150)](_0x4b97ce,_0x2b4fb8);}async[_0x3e6379(0x150)](_0x1c923e,_0x25c5ec){const _0x4134ae=_0x3e6379;return _0x4134ae(0x16d)+_0x1c923e[_0x4134ae(0x152)][0x0]+_0x4134ae(0x143)+_0x1c923e[_0x4134ae(0x159)][0x0]+_0x4134ae(0x14e)+new Date()[_0x4134ae(0x164)]()+_0x4134ae(0x142)+_0x25c5ec+_0x4134ae(0x134);}async[_0x3e6379(0x141)](_0x2b0c54){const _0x1c208e=_0x3e6379,_0x517e3a=new Promise((_0x10ccb3,_0x319b25)=>{setTimeout(()=>{_0x319b25(new Error('请求超时'));},0x12c0);});let _0x15a004='';try{console['log']('来自公众号的询问问题\x20=======>\x20',_0x2b0c54);const _0xe75dc3=await Promise[_0x1c208e(0x153)]([this[_0x1c208e(0x172)][_0x1c208e(0x161)](_0x2b0c54),_0x517e3a]);_0x15a004=_0xe75dc3||await this[_0x1c208e(0x171)][_0x1c208e(0x149)](_0x2b0c54);}catch(_0x116d07){console[_0x1c208e(0x170)](_0x1c208e(0x173)),_0x15a004=await this[_0x1c208e(0x168)][_0x1c208e(0x18b)]([_0x1c208e(0x18c)])||'由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！';}return _0x15a004;}};OfficialService=__decorate([(0x0,common_1[_0x3e6379(0x13e)])(),__metadata(_0x3e6379(0x13c),[autoreply_service_1[_0x3e6379(0x175)],user_service_1[_0x3e6379(0x166)],auth_service_1[_0x3e6379(0x12d)],globalConfig_service_1[_0x3e6379(0x186)],chatgpt_service_1['ChatgptService']])],OfficialService),exports[_0x3e6379(0x14f)]=OfficialService;