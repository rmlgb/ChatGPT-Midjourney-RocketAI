'use strict';const _0x2d06eb=_0x177b;function _0x3c40(){const _0x1be120=['公众号静默登录','UseGuards','scanBindWx','Controller','2444302MsdFGP','unsubscribe','officialScanLoginText','aotoPlay','eventkey','扫码登录轮询查询','VIEW','TRUE','CLICK','official','design:paramtypes','length','获取登录二维码sceneStr','ApiOperation','Res','notify','980212ckoISt','genXmlMsg','./official.service','officialSubscribeText','env','scan','获取绑定二维码的sceneStr','object','getQRSceneStrByBind','./dto/getQrSceneStr.dto','design:type','获取登录跳转地址','Query','Req','timestamp','event','echostr','nonce','3717472SAQFak','loginByCode','3126mHfQBZ','verify','defineProperty','send','Body','getJsapiTicket','704151BNUxFb','getQRSceneStr','getQRCode','fromusername','bindWxBySceneStr','getQRCodeTicket','../../common/auth/jwtAuth.guard','GetQrCodeDto','xml:\x20','design:returntype','prototype','genXmlMsgByConfig','officialService','公众号通知接口GET','msgtype','Post','loginBySceneStr','status','code','扫码绑定轮询查询','./dto/getQrCode.dto','OfficialController','GetQrSceneStrDto','226702RINoFp','__esModule','split','sceneStr','includes','2545VpPVMX','getOwnPropertyDescriptor','officialBindAccountText','function','799972EePPGa','https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=','__param','log','url','__decorate','sceneStr:\x20','JwtAuthGuard','qrscene_','SCAN'];_0x3c40=function(){return _0x1be120;};return _0x3c40();}(function(_0x49b539,_0x352182){const _0x533053=_0x177b,_0x5b947e=_0x49b539();while(!![]){try{const _0x2307dd=-parseInt(_0x533053(0xb6))/0x1+parseInt(_0x533053(0xbf))/0x2+parseInt(_0x533053(0xf7))/0x3+-parseInt(_0x533053(0xdd))/0x4+-parseInt(_0x533053(0xbb))/0x5*(-parseInt(_0x533053(0xf1))/0x6)+parseInt(_0x533053(0xcd))/0x7+-parseInt(_0x533053(0xef))/0x8;if(_0x2307dd===_0x352182)break;else _0x5b947e['push'](_0x5b947e['shift']());}catch(_0x3f1f0f){_0x5b947e['push'](_0x5b947e['shift']());}}}(_0x3c40,0x4c53f));var __decorate=this&&this[_0x2d06eb(0xc4)]||function(_0x56c78b,_0x25b140,_0x368a40,_0x512fb0){const _0x46918d=_0x2d06eb;var _0x54d3fc=arguments[_0x46918d(0xd8)],_0x13fdc7=_0x54d3fc<0x3?_0x25b140:_0x512fb0===null?_0x512fb0=Object[_0x46918d(0xbc)](_0x25b140,_0x368a40):_0x512fb0,_0x59a234;if(typeof Reflect===_0x46918d(0xe4)&&typeof Reflect['decorate']==='function')_0x13fdc7=Reflect['decorate'](_0x56c78b,_0x25b140,_0x368a40,_0x512fb0);else{for(var _0x2c3aa8=_0x56c78b[_0x46918d(0xd8)]-0x1;_0x2c3aa8>=0x0;_0x2c3aa8--)if(_0x59a234=_0x56c78b[_0x2c3aa8])_0x13fdc7=(_0x54d3fc<0x3?_0x59a234(_0x13fdc7):_0x54d3fc>0x3?_0x59a234(_0x25b140,_0x368a40,_0x13fdc7):_0x59a234(_0x25b140,_0x368a40))||_0x13fdc7;}return _0x54d3fc>0x3&&_0x13fdc7&&Object[_0x46918d(0xf3)](_0x25b140,_0x368a40,_0x13fdc7),_0x13fdc7;},__metadata=this&&this['__metadata']||function(_0x433ee4,_0x4adaa3){const _0x202cba=_0x2d06eb;if(typeof Reflect===_0x202cba(0xe4)&&typeof Reflect['metadata']===_0x202cba(0xbe))return Reflect['metadata'](_0x433ee4,_0x4adaa3);},__param=this&&this[_0x2d06eb(0xc1)]||function(_0x2176c3,_0x59efbe){return function(_0x34c63d,_0x3add60){_0x59efbe(_0x34c63d,_0x3add60,_0x2176c3);};};Object[_0x2d06eb(0xf3)](exports,_0x2d06eb(0xb7),{'value':!![]}),exports[_0x2d06eb(0xb4)]=void 0x0;const common_1=require('@nestjs/common'),swagger_1=require('@nestjs/swagger'),jwtAuth_guard_1=require(_0x2d06eb(0xfd)),official_service_1=require(_0x2d06eb(0xdf)),getQrCode_dto_1=require(_0x2d06eb(0xb3)),getQrSceneStr_dto_1=require(_0x2d06eb(0xe6));function _0x177b(_0x29b543,_0x113ddc){const _0x3c40d3=_0x3c40();return _0x177b=function(_0x177ba4,_0x20010f){_0x177ba4=_0x177ba4-0xad;let _0x1b353f=_0x3c40d3[_0x177ba4];return _0x1b353f;},_0x177b(_0x29b543,_0x113ddc);}let OfficialController=class OfficialController{constructor(_0x65853c){const _0x281653=_0x2d06eb;this[_0x281653(0x103)]=_0x65853c;}async[_0x2d06eb(0xdc)](_0x222aba,_0x405807,_0x21f5ce){const _0x4aa5be=_0x2d06eb;console[_0x4aa5be(0xc2)]('get\x20通知>>>',_0x405807,_0x21f5ce);const _0x397bf1=await this[_0x4aa5be(0x103)][_0x4aa5be(0xf2)](_0x405807['signature'],_0x405807[_0x4aa5be(0xee)],_0x405807[_0x4aa5be(0xeb)]);return _0x397bf1?_0x405807[_0x4aa5be(0xed)]:'';}async['notifyPost'](_0x543417,_0x59fe2a,_0x238027,_0x20146c){const _0x39ab7b=_0x2d06eb,{xml:_0x1c53b5}=_0x238027;console[_0x39ab7b(0xc2)](_0x39ab7b(0xff),_0x1c53b5);if(_0x1c53b5[_0x39ab7b(0xad)][0x0]==_0x39ab7b(0xec)){if(_0x1c53b5['event'][0x0]==_0x39ab7b(0xd3)||_0x1c53b5[_0x39ab7b(0xec)][0x0]==_0x39ab7b(0xd5))return _0x20146c[_0x39ab7b(0xb0)](0xc8)[_0x39ab7b(0xf4)]('');if(_0x1c53b5['event'][0x0]==_0x39ab7b(0xc8)){console['log']('扫码');const _0xa9a20d=_0x1c53b5[_0x39ab7b(0xd1)][0x0];if(_0xa9a20d[_0x39ab7b(0xba)]('/')){this[_0x39ab7b(0x103)][_0x39ab7b(0xcb)](_0x1c53b5['fromusername'][0x0],_0xa9a20d);const _0xfa7584=await this[_0x39ab7b(0x103)][_0x39ab7b(0x102)](_0x1c53b5,'officialBindAccountText');return _0x20146c[_0x39ab7b(0xb0)](0xc8)['send'](_0xfa7584);}this[_0x39ab7b(0x103)][_0x39ab7b(0xe2)](_0x1c53b5[_0x39ab7b(0xfa)][0x0],_0xa9a20d);const _0xbdc8e1=await this[_0x39ab7b(0x103)][_0x39ab7b(0x102)](_0x1c53b5,_0x39ab7b(0xcf));return _0x20146c[_0x39ab7b(0xb0)](0xc8)[_0x39ab7b(0xf4)](_0xbdc8e1);}if(_0x1c53b5[_0x39ab7b(0xec)][0x0]=='subscribe'){console[_0x39ab7b(0xc2)]('订阅',_0x1c53b5[_0x39ab7b(0xd1)][0x0]);const _0x4cd24a=_0x1c53b5['eventkey'][0x0][_0x39ab7b(0xb8)](_0x39ab7b(0xc7))[0x1];console[_0x39ab7b(0xc2)](_0x39ab7b(0xc5),_0x4cd24a);if(!_0x4cd24a){const _0x8016c9=await this[_0x39ab7b(0x103)]['genXmlMsgByConfig'](_0x1c53b5,_0x39ab7b(0xe0));return _0x20146c['status'](0xc8)['send'](_0x8016c9);}if(_0x4cd24a[_0x39ab7b(0xba)]('/')){this[_0x39ab7b(0x103)][_0x39ab7b(0xcb)](_0x1c53b5[_0x39ab7b(0xfa)][0x0],_0x4cd24a);const _0x125bed=await this['officialService'][_0x39ab7b(0x102)](_0x1c53b5,_0x39ab7b(0xbd));return _0x20146c[_0x39ab7b(0xb0)](0xc8)[_0x39ab7b(0xf4)](_0x125bed);}this['officialService']['scan'](_0x1c53b5[_0x39ab7b(0xfa)][0x0],_0x4cd24a);const _0x113b69=await this[_0x39ab7b(0x103)][_0x39ab7b(0x102)](_0x1c53b5,_0x39ab7b(0xe0));return _0x20146c[_0x39ab7b(0xb0)](0xc8)[_0x39ab7b(0xf4)](_0x113b69);}if(_0x1c53b5[_0x39ab7b(0xec)][0x0]==_0x39ab7b(0xce))return _0x20146c[_0x39ab7b(0xb0)](0xc8)[_0x39ab7b(0xf4)]('');}if(_0x1c53b5[_0x39ab7b(0xad)][0x0]=='text'){const _0x1bd2bb=await this[_0x39ab7b(0x103)][_0x39ab7b(0xd0)](_0x1c53b5['content'][0x0]),_0x5cbde7=await this['officialService'][_0x39ab7b(0xde)](_0x1c53b5,_0x1bd2bb);return _0x20146c[_0x39ab7b(0xb0)](0xc8)[_0x39ab7b(0xf4)](_0x5cbde7);}return'success';}async[_0x2d06eb(0xf8)](_0x40c942){const _0x3b4af6=_0x2d06eb;return this[_0x3b4af6(0x103)][_0x3b4af6(0xf8)](_0x40c942);}async[_0x2d06eb(0xe5)](_0x5a7553){return this['officialService']['getQRSceneStrByBind'](_0x5a7553);}async[_0x2d06eb(0xf9)](_0x1d1942){const _0x1c299f=_0x2d06eb;if(process[_0x1c299f(0xe1)]['ISDEV']===_0x1c299f(0xd4))return'';const _0x36e22f=await this[_0x1c299f(0x103)][_0x1c299f(0xfc)](_0x1d1942[_0x1c299f(0xb9)]);return _0x1c299f(0xc0)+encodeURIComponent(_0x36e22f);}async[_0x2d06eb(0xaf)](_0x21e7ce,_0x15bac9){const _0x438b1a=_0x2d06eb;return this[_0x438b1a(0x103)]['loginBySceneStr'](_0x21e7ce,_0x15bac9['sceneStr']);}async[_0x2d06eb(0xfb)](_0x2dbcf2,_0x3f19bb){const _0x1d8aa9=_0x2d06eb;return this[_0x1d8aa9(0x103)]['bindWxBySceneStr'](_0x2dbcf2,_0x3f19bb[_0x1d8aa9(0xb9)]);}async['getRedirectUrl'](_0x41d088){const _0x4975d1=_0x2d06eb;return this['officialService']['getRedirectUrl'](_0x41d088[_0x4975d1(0xc3)]);}async['getJsapiTicket'](_0x34c6ea){const _0x269fd7=_0x2d06eb;return this[_0x269fd7(0x103)][_0x269fd7(0xf6)](_0x34c6ea[_0x269fd7(0xc3)]);}async[_0x2d06eb(0xf0)](_0x162154,_0x36cf2d){const _0x42d31e=_0x2d06eb;return this[_0x42d31e(0x103)]['loginByCode'](_0x162154,_0x36cf2d[_0x42d31e(0xb1)]);}};__decorate([(0x0,common_1['Get'])(_0x2d06eb(0xdc)),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0x104)}),__param(0x0,(0x0,common_1[_0x2d06eb(0xea)])()),__param(0x1,(0x0,common_1[_0x2d06eb(0xe9)])()),__param(0x2,(0x0,common_1['Body'])()),__metadata(_0x2d06eb(0xe7),Function),__metadata(_0x2d06eb(0xd7),[Object,Object,Object]),__metadata('design:returntype',Promise)],OfficialController[_0x2d06eb(0x101)],_0x2d06eb(0xdc),null),__decorate([(0x0,common_1['Post'])(_0x2d06eb(0xdc)),(0x0,swagger_1['ApiOperation'])({'summary':'公众号通知接口POST'}),__param(0x0,(0x0,common_1[_0x2d06eb(0xea)])()),__param(0x1,(0x0,common_1[_0x2d06eb(0xe9)])()),__param(0x2,(0x0,common_1[_0x2d06eb(0xf5)])()),__param(0x3,(0x0,common_1[_0x2d06eb(0xdb)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object,Object,Object,Object]),__metadata(_0x2d06eb(0x100),Promise)],OfficialController[_0x2d06eb(0x101)],'notifyPost',null),__decorate([(0x0,common_1[_0x2d06eb(0xae)])('getQRSceneStr'),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0xd9)}),__param(0x0,(0x0,common_1['Body'])()),__metadata(_0x2d06eb(0xe7),Function),__metadata(_0x2d06eb(0xd7),[getQrSceneStr_dto_1[_0x2d06eb(0xb5)]]),__metadata('design:returntype',Promise)],OfficialController['prototype'],'getQRSceneStr',null),__decorate([(0x0,common_1['Post'])(_0x2d06eb(0xe5)),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0xe3)}),(0x0,common_1[_0x2d06eb(0xca)])(jwtAuth_guard_1[_0x2d06eb(0xc6)]),__param(0x0,(0x0,common_1['Req'])()),__metadata('design:type',Function),__metadata(_0x2d06eb(0xd7),[Object]),__metadata(_0x2d06eb(0x100),Promise)],OfficialController['prototype'],_0x2d06eb(0xe5),null),__decorate([(0x0,common_1['Get'])(_0x2d06eb(0xf9)),(0x0,swagger_1['ApiOperation'])({'summary':'获取二维码'}),__param(0x0,(0x0,common_1[_0x2d06eb(0xe9)])()),__metadata('design:type',Function),__metadata(_0x2d06eb(0xd7),[getQrCode_dto_1[_0x2d06eb(0xfe)]]),__metadata('design:returntype',Promise)],OfficialController[_0x2d06eb(0x101)],_0x2d06eb(0xf9),null),__decorate([(0x0,common_1[_0x2d06eb(0xae)])(_0x2d06eb(0xaf)),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0xd2)}),__param(0x0,(0x0,common_1[_0x2d06eb(0xea)])()),__param(0x1,(0x0,common_1[_0x2d06eb(0xf5)])()),__metadata(_0x2d06eb(0xe7),Function),__metadata(_0x2d06eb(0xd7),[Object,getQrCode_dto_1[_0x2d06eb(0xfe)]]),__metadata('design:returntype',Promise)],OfficialController[_0x2d06eb(0x101)],_0x2d06eb(0xaf),null),__decorate([(0x0,common_1['Post'])('bindWxBySceneStr'),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0xb2)}),(0x0,common_1['UseGuards'])(jwtAuth_guard_1[_0x2d06eb(0xc6)]),__param(0x0,(0x0,common_1[_0x2d06eb(0xea)])()),__param(0x1,(0x0,common_1['Body'])()),__metadata('design:type',Function),__metadata(_0x2d06eb(0xd7),[Object,getQrCode_dto_1[_0x2d06eb(0xfe)]]),__metadata(_0x2d06eb(0x100),Promise)],OfficialController[_0x2d06eb(0x101)],'bindWxBySceneStr',null),__decorate([(0x0,common_1[_0x2d06eb(0xae)])('getRedirectUrl'),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0xe8)}),__param(0x0,(0x0,common_1[_0x2d06eb(0xf5)])()),__metadata('design:type',Function),__metadata('design:paramtypes',[Object]),__metadata('design:returntype',Promise)],OfficialController[_0x2d06eb(0x101)],'getRedirectUrl',null),__decorate([(0x0,common_1[_0x2d06eb(0xae)])('getJsapiTicket'),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':'获取注册配置'}),__param(0x0,(0x0,common_1[_0x2d06eb(0xf5)])()),__metadata(_0x2d06eb(0xe7),Function),__metadata(_0x2d06eb(0xd7),[Object]),__metadata(_0x2d06eb(0x100),Promise)],OfficialController[_0x2d06eb(0x101)],'getJsapiTicket',null),__decorate([(0x0,common_1[_0x2d06eb(0xae)])(_0x2d06eb(0xf0)),(0x0,swagger_1[_0x2d06eb(0xda)])({'summary':_0x2d06eb(0xc9)}),__param(0x0,(0x0,common_1[_0x2d06eb(0xea)])()),__param(0x1,(0x0,common_1[_0x2d06eb(0xf5)])()),__metadata(_0x2d06eb(0xe7),Function),__metadata(_0x2d06eb(0xd7),[Object,Object]),__metadata('design:returntype',Promise)],OfficialController[_0x2d06eb(0x101)],_0x2d06eb(0xf0),null),OfficialController=__decorate([(0x0,swagger_1['ApiTags'])(_0x2d06eb(0xd6)),(0x0,common_1[_0x2d06eb(0xcc)])('official'),__metadata(_0x2d06eb(0xd7),[official_service_1['OfficialService']])],OfficialController),exports[_0x2d06eb(0xb4)]=OfficialController;