'use strict';const _0x5e726a=_0x52bd;(function(_0x49f2e,_0x289039){const _0x497c32=_0x52bd,_0x194c63=_0x49f2e();while(!![]){try{const _0x346038=parseInt(_0x497c32(0x25e))/0x1+parseInt(_0x497c32(0x241))/0x2*(-parseInt(_0x497c32(0x257))/0x3)+parseInt(_0x497c32(0x227))/0x4+-parseInt(_0x497c32(0x297))/0x5+parseInt(_0x497c32(0x215))/0x6+parseInt(_0x497c32(0x1d6))/0x7*(parseInt(_0x497c32(0x24d))/0x8)+-parseInt(_0x497c32(0x299))/0x9;if(_0x346038===_0x289039)break;else _0x194c63['push'](_0x194c63['shift']());}catch(_0x225022){_0x194c63['push'](_0x194c63['shift']());}}}(_0x2417,0xa81fd));function _0x2417(){const _0x54deb4=['REDIS_HOST','UserService','2369365OIqgFP','AppEntity','11861901QJINCR','FanyiService','chatLogService','defineProperty','openaiProxyUrl','getUploadType','prompt','getAllKeyList','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','typeId','preset','count','DESC','update','/v1/gpts/search?search=','usage','validateBalance','HttpException','getGroupInfoFromId','stringify','openaiTimeoutMs','data:image/jpeg;base64','getCurrentModelKeyInfo','\x0a\x20\x20\x20\x20\x20\x20\x20\x20statusText:','queryChatBox','../chatLog/chatLog.service','text','gptsKey','key','./chatPreType.entity','modelInfo','HttpStatus','user','chatPreEntity','你当前使用的应用已被下架、请删除当前对话开启新的对话吧！','config','write','当前对话组使用模型model:\x20','application/octet-stream;\x20charset=utf-8','setData','push','fanyiService','DeductionKey','openaiBaseUrl','gpt-4-1106','statusText','../app/app.entity','gpt-4-vision-preview','sendMessageFromOpenAi','openaiModel3MaxTokens16kRes','./zhipu','function','gpt-4','fileType','绘制图片失败，请检查你的提示词是否有非法描述！','quality','\x20机器人模型:\x20','./../user/user.service','error:\x20','deductFromBalance','getModelProxyUrl','setHeader','keyPool','b64_json','autoreplyService','badwordsService','map','ChatgptService','saveChatLog','mjDraw','当前模型key余额已耗尽','getClientIp','setChatBoxType',',\x20模型名称:\x20','message','REDIS_PORT','delChatBoxType','then','fileContent','object','appEntity','decorate','UploadService','ChatPreTypeEntity','post','chatBoxTypeEntity','status','.png','abortController','default','whiteListUser','当前分类下有未处理数据不可移除！','OpenAiErrorCodeMessage','end','../models/models.service','2727830gjNJPu','appId','./chatBoxType.entity','openaiModel3MaxTokensRes','debug','userBanance','draw\x20paompt\x20info\x20<==**==>\x20','response','systemPreMessage','https://api.openai.com','ChatGroupService','RocKetStore','catch','setChatBox','chatPreTypeEntity','gif','checkAutoReply','本次调用:\x20','onModuleInit','./gptKeys.entity','../../common/constants/errorMessage.constant',',\x20最大回复token:\x20','coverImg',',\x20key\x20===>\x20','queryChatBoxFrontend','getFileType','typeorm','openai-draw\x20error:\x20','../autoreply/autoreply.service','./chatPre.entity','keyv','绘制图片失败，请稍后试试吧！','gptKeysEntity','error','env','base64','\x20key\x20->\x20','importDynamic','../fanyi/fanyi.service','非法操作！','parentMessageId:','1106','getOwnPropertyDescriptor','当前模型不是聊天模型','formatModelToken','文件类型type:\x20','addOneIfOdd','uploadFile','data:image/gif;base64','Injectable','服务异常、请重新试试吧！！！','getConfigs','saveUseLog','forEach','isUndefined','当前模型key已被封禁','queryUserBalance','rocketStore','uploadService','gptsSearch','REDIS_USER','Incorrect\x20API\x20key\x20provided','close','3804954NvQQWI','rocketStoreData\x20model:\x20','gptsRealyAddress','UserBalanceService','InjectRepository','file_url','toLowerCase','assistant','abort','save','\x0a\x20\x20\x20\x20\x20\x20\x20\x20status:','design:paramtypes','Too\x20Many\x20Requests','lockKey','delChatBox','data','jpeg','log','5452776boRUmF','draw','@nestjs/common','当前模型调用过于频繁、请重新试试吧！','Content-type','getMaxTokenFromModelWithOpenAi','Please\x20check\x20the\x20back-end\x20console','./openai','floor','includes','Bearer\x20','当前对话组信息:\x20','chatProcess','ChatBoxTypeEntity','GET','./store','gpt-3','appInfo','size','getRequestParams','weight','dall-e-3','保存数据库参数:','split','chatGroupService','chatProcess\x20finally\x20res.end()\x20对话结束','2ieJQOL','queryChatPreType','chatSyncFree','delete','sendMessageFromBaidu','toISOString','AutoreplyService','buildMessageFromParentMessageId','billing','model3','This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported','\x0a\x20\x20\x20\x20\x20\x20\x20\x20code:','16JjEJbU','uuid','metadata','当前Key余额已不足、请重新再试一次吧！','16k','openaiModel4MaxTokensRes','getRandomDrawKey','../userBalance/userBalance.service','当前请求已过载、请稍等会儿再试试吧！','conversationId','1672941pqlRXw','getUuid','Logger','chatgpt-nine-ai','compileNetwork','find','all','261413pPQfcC','__decorate','/v1/images/generations','进入修改模型','ChatBoxEntity','CHAT_TYPE','queryChatPre','findOne','提供了错误的模型秘钥','userBalanceService','\x0a\x20Current\x20date:\x20','REDIS_PASSWORD','parse','当前模型key余额已耗尽、已冻结当前调用Key、尝试重新对话试试吧！','当前模型不是聊天模型、已冻结当前调用Key、请重新尝试对话！','getBaseConfig','maxModelTokens','openaiModel3MaxTokens','当前用户检测无问题!','checkBadWords','ModelsService','../badwords/badwords.service','unifiedFormattingResponse','缺失必要参数！','assign','length','@nestjs/typeorm','data:image/png;base64','queryChatPreList','chatProcess\x20autoReplyRes\x20对话结束','BadwordsService','chat','\x20model:\x20','getTokenCount','statusCode','slice','chatBoxEntity','modelsService','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','绘制图片失败，此次绘画被拒绝了！','Repository','hideString','setChatPre','dall-e\x20draw\x20params:\x20','32k','BAD_REQUEST','checkUserStatus','globalConfigService','chatProcess\x20onMessage失败!\x20','model','userService','filter','childList','./helper','../../common/constants/balance.constant'];_0x2417=function(){return _0x54deb4;};return _0x2417();}function _0x52bd(_0x4ecafc,_0x1ef9ff){const _0x2417a2=_0x2417();return _0x52bd=function(_0x52bd24,_0xd9cdbe){_0x52bd24=_0x52bd24-0x192;let _0x40cf5b=_0x2417a2[_0x52bd24];return _0x40cf5b;},_0x52bd(_0x4ecafc,_0x1ef9ff);}var __decorate=this&&this[_0x5e726a(0x25f)]||function(_0x11c71f,_0x2c3558,_0x4adbcc,_0xaa7fa1){const _0x46693f=_0x5e726a;var _0x370664=arguments[_0x46693f(0x277)],_0x21f3be=_0x370664<0x3?_0x2c3558:_0xaa7fa1===null?_0xaa7fa1=Object[_0x46693f(0x200)](_0x2c3558,_0x4adbcc):_0xaa7fa1,_0x37f5d0;if(typeof Reflect===_0x46693f(0x1c6)&&typeof Reflect[_0x46693f(0x1c8)]===_0x46693f(0x1aa))_0x21f3be=Reflect['decorate'](_0x11c71f,_0x2c3558,_0x4adbcc,_0xaa7fa1);else{for(var _0x3fcbc4=_0x11c71f['length']-0x1;_0x3fcbc4>=0x0;_0x3fcbc4--)if(_0x37f5d0=_0x11c71f[_0x3fcbc4])_0x21f3be=(_0x370664<0x3?_0x37f5d0(_0x21f3be):_0x370664>0x3?_0x37f5d0(_0x2c3558,_0x4adbcc,_0x21f3be):_0x37f5d0(_0x2c3558,_0x4adbcc))||_0x21f3be;}return _0x370664>0x3&&_0x21f3be&&Object[_0x46693f(0x29c)](_0x2c3558,_0x4adbcc,_0x21f3be),_0x21f3be;},__metadata=this&&this['__metadata']||function(_0x5c5079,_0x3f05ab){const _0x721738=_0x5e726a;if(typeof Reflect===_0x721738(0x1c6)&&typeof Reflect[_0x721738(0x24f)]==='function')return Reflect['metadata'](_0x5c5079,_0x3f05ab);},__param=this&&this['__param']||function(_0x403af7,_0x1b9c2a){return function(_0x321f4b,_0x2158cd){_0x1b9c2a(_0x321f4b,_0x2158cd,_0x403af7);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x5e726a(0x1ba)]=void 0x0;const upload_service_1=require('./../upload/upload.service'),user_service_1=require(_0x5e726a(0x1b0)),nestjs_config_1=require('nestjs-config'),common_1=require(_0x5e726a(0x229)),errorMessage_constant_1=require(_0x5e726a(0x1ea)),utils_1=require('../../common/utils'),axios_1=require('axios'),userBalance_service_1=require(_0x5e726a(0x254)),balance_constant_1=require(_0x5e726a(0x294)),chatLog_service_1=require(_0x5e726a(0x2b2)),uuid=require(_0x5e726a(0x24e)),config_entity_1=require('../globalConfig/config.entity'),typeorm_1=require(_0x5e726a(0x1f0)),typeorm_2=require(_0x5e726a(0x278)),badwords_service_1=require(_0x5e726a(0x273)),autoreply_service_1=require(_0x5e726a(0x1f2)),gptKeys_entity_1=require(_0x5e726a(0x1e9)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),fanyi_service_1=require(_0x5e726a(0x1fc)),app_entity_1=require(_0x5e726a(0x1a5)),chatGroup_service_1=require('../chatGroup/chatGroup.service'),models_service_1=require(_0x5e726a(0x1d5)),baidu_1=require('./baidu'),helper_1=require(_0x5e726a(0x293)),store_1=require(_0x5e726a(0x236)),zhipu_1=require(_0x5e726a(0x1a9)),openai_1=require(_0x5e726a(0x22e)),chatBoxType_entity_1=require(_0x5e726a(0x1d8)),chatBox_entity_1=require('./chatBox.entity'),chatPre_entity_1=require(_0x5e726a(0x1f3)),chatPreType_entity_1=require(_0x5e726a(0x194)),shared_utils_1=require('@nestjs/common/utils/shared.utils');let ChatgptService=class ChatgptService{constructor(_0x3d9f70,_0x550c6b,_0xd71a65,_0xe1a111,_0x333b96,_0x28cfa9,_0x47e3b6,_0x247e9c,_0xf23ffe,_0x5a307e,_0x4748c5,_0x5e29be,_0x3236f5,_0x43a31f,_0x1455d6,_0x3fb298,_0xf71742,_0x3d5292){const _0x2a771b=_0x5e726a;this['gptKeysEntity']=_0x3d9f70,this['configEntity']=_0x550c6b,this[_0x2a771b(0x1cc)]=_0xd71a65,this['chatBoxEntity']=_0xe1a111,this[_0x2a771b(0x1c7)]=_0x333b96,this[_0x2a771b(0x1e4)]=_0x28cfa9,this[_0x2a771b(0x198)]=_0x47e3b6,this['configService']=_0x247e9c,this[_0x2a771b(0x267)]=_0xf23ffe,this[_0x2a771b(0x29b)]=_0x5a307e,this[_0x2a771b(0x290)]=_0x4748c5,this[_0x2a771b(0x210)]=_0x5e29be,this[_0x2a771b(0x1b8)]=_0x3236f5,this[_0x2a771b(0x1b7)]=_0x43a31f,this[_0x2a771b(0x28d)]=_0x1455d6,this[_0x2a771b(0x1a0)]=_0x3fb298,this['chatGroupService']=_0xf71742,this['modelsService']=_0x3d5292,this[_0x2a771b(0x20f)]=null,this[_0x2a771b(0x1d1)]=[],this[_0x2a771b(0x1b5)]={'list3':[],'list4':[]};}async[_0x5e726a(0x1e8)](){const _0x779705=_0x5e726a;let _0x1392d1=await(0x0,utils_1[_0x779705(0x1fb)])(_0x779705(0x25a)),_0x1f8c41=await(0x0,utils_1[_0x779705(0x1fb)])('@keyv/redis'),_0x46a210=await(0x0,utils_1['importDynamic'])(_0x779705(0x1f4));_0x1392d1=(_0x1392d1===null||_0x1392d1===void 0x0?void 0x0:_0x1392d1[_0x779705(0x1d0)])?_0x1392d1[_0x779705(0x1d0)]:_0x1392d1,_0x1f8c41=(_0x1f8c41===null||_0x1f8c41===void 0x0?void 0x0:_0x1f8c41[_0x779705(0x1d0)])?_0x1f8c41['default']:_0x1f8c41,_0x46a210=(_0x46a210===null||_0x46a210===void 0x0?void 0x0:_0x46a210[_0x779705(0x1d0)])?_0x46a210['default']:_0x46a210;const {ChatGPTAPI:_0x33462d,ChatGPTError:_0x46fa6d,ChatGPTUnofficialProxyAPI:_0x319b33}=_0x1392d1,_0x46f3f8=+process[_0x779705(0x1f8)][_0x779705(0x1c2)],_0x3e1ff1=process['env'][_0x779705(0x295)],_0x10679d=process[_0x779705(0x1f8)][_0x779705(0x269)],_0x3a40a1=process[_0x779705(0x1f8)][_0x779705(0x212)],_0x5bf16e='redis://'+(_0x3a40a1||'')+':'+(_0x10679d||'')+'@'+_0x3e1ff1+':'+_0x46f3f8,_0x36d609=new _0x1f8c41(_0x5bf16e),_0x1b3435=new _0x46a210({'store':_0x36d609,'namespace':'rocketai-chatlog'});this['rocketStore']=new store_1[(_0x779705(0x1e1))]({'store':_0x1b3435,'namespace':_0x779705(0x27d)});}async[_0x5e726a(0x23a)](_0x401d99,_0x2aedb6,_0x1cdeb9,_0x18b338=null){const _0x485f5c=_0x5e726a;var _0x27b201;!_0x18b338&&(_0x18b338=(_0x27b201=await this[_0x485f5c(0x283)]['getBaseConfig']())===null||_0x27b201===void 0x0?void 0x0:_0x27b201[_0x485f5c(0x195)]);const {timeout:timeout=0x3c}=_0x1cdeb9,{topN:_0x430862,model:_0x5b3431}=_0x18b338,{parentMessageId:parentMessageId=0x0}=_0x401d99,_0x475f70=await this[_0x485f5c(0x28d)][_0x485f5c(0x209)]([_0x485f5c(0x2ad)]),_0x1ad655=timeout*0x3e8||_0x475f70||0x64*0x3e8,_0x171ec6={'parentMessageId':parentMessageId,'timeoutMs':+_0x1ad655,'completionParams':{'model':_0x5b3431,'temperature':_0x430862}};return _0x2aedb6&&(_0x171ec6['systemMessage']=_0x2aedb6),_0x171ec6;}async[_0x5e726a(0x243)](_0x3971a7){const _0x5625d3=_0x5e726a,_0x3106d2=await this[_0x5625d3(0x283)][_0x5625d3(0x253)](),_0x300abc=await this[_0x5625d3(0x28d)]['getConfigs'](['systemPreMessage']),{maxModelTokens:maxModelTokens=0x1f40,maxResponseTokens:maxResponseTokens=0x1000,key:_0x99941,model:_0x12be8b}=_0x3106d2,_0x429baf=await this[_0x5625d3(0x1b3)](_0x3106d2),{context:_0x4012b8}=await this['rocketStore'][_0x5625d3(0x248)](_0x3971a7,{'parentMessageId':'','systemMessage':_0x300abc});try{const _0x3c5cb0=await(0x0,openai_1[_0x5625d3(0x1a7)])(_0x4012b8,{'apiKey':(0x0,utils_1['removeSpecialCharacters'])(_0x99941),'model':_0x12be8b,'proxyUrl':_0x429baf,'onProgress':null});return _0x3c5cb0===null||_0x3c5cb0===void 0x0?void 0x0:_0x3c5cb0[_0x5625d3(0x2b3)];}catch(_0x534231){console[_0x5625d3(0x226)](_0x5625d3(0x1b1),_0x534231);}}async[_0x5e726a(0x233)](_0x52d049,_0x3c3ed3,_0x6ba7b0,_0x1b4326){const _0x1b5d91=_0x5e726a;var _0x241a04,_0x3ef944,_0xfe876f;try{const _0x5dd5bb=_0x3c3ed3[_0x1b5d91(0x1cf)],{options:options={},appId:_0x1763d0,cusromPrompt:_0x56319f,systemMessage:systemMessage=''}=_0x52d049;let _0x5818d5=systemMessage;const {parentMessageId:_0x3cd880}=options,{prompt:_0x5d9b3a}=_0x52d049,{groupId:_0x351a9d,usingNetwork:_0xbca16e}=options,_0x2e1700=await this[_0x1b5d91(0x23f)][_0x1b5d91(0x2ab)](_0x351a9d),_0x2bf1e9=(_0x2e1700===null||_0x2e1700===void 0x0?void 0x0:_0x2e1700[_0x1b5d91(0x19a)])?JSON[_0x1b5d91(0x26a)](_0x2e1700['config']):await this[_0x1b5d91(0x283)][_0x1b5d91(0x26d)](),{keyType:_0x11820c,topN:_0xa009b7,systemMessage:_0x32fc54,rounds:_0x56abfb}=_0x2bf1e9[_0x1b5d91(0x195)];let {model:_0x10ba29}=_0x2bf1e9[_0x1b5d91(0x195)];common_1['Logger'][_0x1b5d91(0x1da)]('groupConfig\x20当前对话组信息:\x20'+JSON[_0x1b5d91(0x2ac)](_0x2bf1e9),'ChatgptService');let _0x268a16=null;!_0x56319f?_0x268a16=await this[_0x1b5d91(0x283)][_0x1b5d91(0x2af)](_0x10ba29):_0x268a16=await this[_0x1b5d91(0x283)][_0x1b5d91(0x253)]();if(!_0x268a16)throw new common_1[(_0x1b5d91(0x2aa))](_0x1b5d91(0x2a1),common_1['HttpStatus'][_0x1b5d91(0x28b)]);const {deduct:_0x4b1d3d,deductType:_0x2fb7e1,key:_0x251180,secret:_0x3436eb,modelName:_0x3343bb,id:_0x3e87f1,accessToken:_0x2695c1}=_0x268a16;await this[_0x1b5d91(0x290)][_0x1b5d91(0x28c)](_0x3c3ed3[_0x1b5d91(0x197)]),await this[_0x1b5d91(0x267)][_0x1b5d91(0x2a9)](_0x3c3ed3,_0x2fb7e1===0x1?_0x1b5d91(0x24a):'model4',_0x4b1d3d),_0x6ba7b0&&_0x6ba7b0[_0x1b5d91(0x1b4)](_0x1b5d91(0x22b),_0x1b5d91(0x19d)),await this[_0x1b5d91(0x1b8)][_0x1b5d91(0x271)](_0x5d9b3a,_0x3c3ed3['user']['id']),common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x270),_0x1b5d91(0x1ba));const _0x395a26=await this[_0x1b5d91(0x1b7)][_0x1b5d91(0x1e6)](_0x5d9b3a);if(_0x395a26&&_0x6ba7b0){const _0xd97223={'message':_0x395a26,'code':0x1f4};return _0x6ba7b0[_0x1b5d91(0x19b)](JSON['stringify'](_0xd97223)),common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x27b),'ChatgptService'),_0x6ba7b0[_0x1b5d91(0x1d4)]();}if(_0x1763d0){const _0x3c055b=await this[_0x1b5d91(0x1c7)][_0x1b5d91(0x265)]({'where':{'id':_0x1763d0,'status':(0x0,typeorm_1['In'])([0x1,0x3,0x4,0x5])}});if(!_0x3c055b)throw new common_1['HttpException'](_0x1b5d91(0x199),common_1['HttpStatus'][_0x1b5d91(0x28b)]);_0x3c055b['preset']&&(_0x5818d5=_0x3c055b[_0x1b5d91(0x2a3)]);}else{if(_0x56319f)_0x5818d5=systemMessage;else{if(_0x32fc54)_0x5818d5=_0x32fc54;else{const _0x39302c=new Date()[_0x1b5d91(0x246)]()[_0x1b5d91(0x23e)]('T')[0x0],_0x1a1c67=await this[_0x1b5d91(0x28d)][_0x1b5d91(0x209)](['systemPreMessage']);_0x5818d5=_0x1a1c67+(_0x1b5d91(0x268)+_0x39302c);}}}common_1[_0x1b5d91(0x259)]['debug'](_0x1b5d91(0x1fe)+_0x3cd880);let _0x4baf03='';if(_0xbca16e){_0x4baf03=await(0x0,utils_1[_0x1b5d91(0x25b)])(_0x5d9b3a);const _0x5130fa=new Date()['toISOString']()[_0x1b5d91(0x23e)]('T')[0x0],_0x4ccdba=await this['globalConfigService']['getConfigs']([_0x1b5d91(0x1de)]);_0x5818d5=_0x4ccdba+('\x0a\x20Current\x20date:\x20'+_0x5130fa);}const _0x547d2c=await this[_0x1b5d91(0x23a)](options,_0x5818d5,_0x268a16,_0x2bf1e9[_0x1b5d91(0x195)]),{maxModelTokens:maxModelTokens=0x1f40,maxResponseTokens:maxResponseTokens=0x1000,key:_0x2c8162}=_0x268a16;_0x6ba7b0&&_0x6ba7b0[_0x1b5d91(0x1cd)](0xc8);let _0x5f01cf=null,_0x5a3bd6=null;common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)]('此次触发KeyType\x20'+_0x11820c+_0x1b5d91(0x1af)+_0x3343bb+'\x20机器人key:\x20'+(0x0,utils_1[_0x1b5d91(0x287)])(_0x251180),_0x1b5d91(0x1ba));const _0x573a17=_0x52d049['file_url'],_0x5cb17c=_0x52d049[_0x1b5d91(0x21a)];let _0x87a85d=undefined;_0x573a17&&(_0x87a85d=(0x0,utils_1[_0x1b5d91(0x1ef)])(_0x573a17));common_1[_0x1b5d91(0x259)]['debug'](_0x1b5d91(0x203)+_0x87a85d,_0x1b5d91(0x1ba));try{if(_0x6ba7b0||_0x1b4326){let _0x36826d=null,_0x409423=![];_0x6ba7b0&&_0x6ba7b0['on'](_0x1b5d91(0x214),async()=>{const _0xc736e2=_0x1b5d91;if(_0x409423)return;_0x5dd5bb[_0xc736e2(0x21d)]();const _0x42dd57=await(0x0,openai_1[_0xc736e2(0x27f)])(_0x5d9b3a)||0x0,_0x7242ef=await(0x0,openai_1['getTokenCount'])(_0x36826d===null||_0x36826d===void 0x0?void 0x0:_0x36826d[_0xc736e2(0x2b3)])||0x0,_0x3c825b=_0x42dd57+_0x7242ef,_0x3cb45f=(0x0,utils_1[_0xc736e2(0x1be)])(_0x3c3ed3),_0x28db43={'appId':_0x1763d0,'curIp':_0x3cb45f,'userId':_0x3c3ed3[_0xc736e2(0x197)]['id'],'type':balance_constant_1[_0xc736e2(0x1a1)]['CHAT_TYPE'],'prompt':_0x5d9b3a,'answer':'','promptTokens':_0x42dd57,'completionTokens':0x0,'totalTokens':_0x42dd57,'model':_0x10ba29,'role':_0xc736e2(0x197),'groupId':_0x351a9d,'requestOptions':JSON[_0xc736e2(0x2ac)]({'options':null,'prompt':_0x5d9b3a})};_0x87a85d&&(_0x28db43['fileType']=_0x87a85d,_0x28db43[_0xc736e2(0x1c5)]=_0x5cb17c),await this[_0xc736e2(0x29b)][_0xc736e2(0x1bb)](_0x28db43),await this[_0xc736e2(0x29b)][_0xc736e2(0x1bb)]({'appId':_0x1763d0,'curIp':_0x3cb45f,'userId':_0x3c3ed3['user']['id'],'type':balance_constant_1[_0xc736e2(0x1a1)][_0xc736e2(0x263)],'prompt':_0x5d9b3a,'answer':_0x36826d===null||_0x36826d===void 0x0?void 0x0:_0x36826d[_0xc736e2(0x2b3)],'promptTokens':_0x42dd57,'completionTokens':_0x7242ef,'totalTokens':_0x3c825b,'model':_0x10ba29,'role':'assistant','groupId':_0x351a9d,'requestOptions':JSON[_0xc736e2(0x2ac)]({'options':{'model':_0x10ba29,'temperature':_0xa009b7},'prompt':_0x5d9b3a}),'conversationOptions':JSON[_0xc736e2(0x2ac)]({'conversationId':_0x36826d===null||_0x36826d===void 0x0?void 0x0:_0x36826d[_0xc736e2(0x256)],'model':_0x10ba29,'parentMessageId':_0x36826d===null||_0x36826d===void 0x0?void 0x0:_0x36826d['id'],'temperature':_0xa009b7})}),await this[_0xc736e2(0x267)]['deductFromBalance'](_0x3c3ed3[_0xc736e2(0x197)]['id'],_0xc736e2(0x28f)+(_0x2fb7e1===0x1?0x3:0x4),_0x4b1d3d,_0x3c825b);});if(Number(_0x11820c)===0x1){const {key:_0x1ee83d,maxToken:_0x1d4e62,maxTokenRes:_0x507079,proxyResUrl:_0x1e5ad9}=await this[_0x1b5d91(0x202)](_0x268a16),{parentMessageId:_0x5b9165,completionParams:_0x1ae644,systemMessage:_0x59d6aa}=_0x547d2c;let {temperature:_0x469c6d}=_0x1ae644;const _0x2237b0=await this[_0x1b5d91(0x20f)][_0x1b5d91(0x248)](_0xbca16e?_0x4baf03:_0x5d9b3a,{'parentMessageId':_0x5b9165,'systemMessage':_0x59d6aa,'maxModelToken':_0x1d4e62,'maxResponseTokens':_0x507079,'maxRounds':(0x0,helper_1[_0x1b5d91(0x204)])(_0x56abfb)},_0x1b4326?!![]:![]);common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x232)+JSON[_0x1b5d91(0x2ac)](_0xbca16e?_0x4baf03:_0x5d9b3a)+'\x20'+JSON['stringify'](_0x2237b0),_0x1b5d91(0x1ba));let {context:_0x2d99c9}=_0x2237b0;common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x216)+_0x10ba29,_0x1b5d91(0x1ba));_0x52d049[_0x1b5d91(0x28f)]!==''&&!(0x0,shared_utils_1[_0x1b5d91(0x20c)])(_0x52d049[_0x1b5d91(0x28f)])&&(_0x10ba29=_0x52d049[_0x1b5d91(0x28f)],common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x261),'ChatgptService'));const _0x1b62c6=_0x2d99c9[_0x1b5d91(0x277)]-0x1,_0x5b44de=_0x2d99c9[_0x1b62c6]['content'];_0x87a85d&&(_0x2d99c9[_0x1b62c6]['content']=[{'type':_0x1b5d91(0x2b3),'text':_0x5b44de},{'type':_0x87a85d,'image_url':{'url':_0x573a17}}]);let _0x146c31=!![];common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x19c)+_0x10ba29,_0x1b5d91(0x1ba)),_0x5f01cf=await(0x0,openai_1[_0x1b5d91(0x1a7)])(_0x2d99c9,{'maxToken':_0x1d4e62,'maxTokenRes':_0x507079,'apiKey':_0x251180,'model':_0x10ba29,'temperature':_0x469c6d,'proxyUrl':_0x1e5ad9,'onProgress':_0x369980=>{const _0x2cd8e4=_0x1b5d91,_0x567668=_0x146c31?JSON[_0x2cd8e4(0x2ac)](_0x369980):'\x0a'+JSON[_0x2cd8e4(0x2ac)](_0x369980);_0x6ba7b0&&_0x6ba7b0[_0x2cd8e4(0x19b)](_0x567668),_0x36826d=_0x369980,_0x146c31=![];try{_0x1b4326&&_0x1b4326(_0x369980?_0x369980[_0x2cd8e4(0x2b3)]?_0x369980[_0x2cd8e4(0x2b3)]:_0x369980:_0x369980);}catch(_0x3d0a16){common_1[_0x2cd8e4(0x259)][_0x2cd8e4(0x1f7)](_0x2cd8e4(0x28e)+(_0x3d0a16[_0x2cd8e4(0x1c1)]||_0x3d0a16),_0x2cd8e4(0x1ba));throw new common_1[(_0x2cd8e4(0x2aa))]('chatProcess\x20onMessage失败!',common_1[_0x2cd8e4(0x196)]['BAD_REQUEST']);}}}),_0x409423=!![];}if(Number(_0x11820c)===0x2){let _0x2088e9=!![];const {context:_0x2238d3}=await this[_0x1b5d91(0x20f)][_0x1b5d91(0x248)](_0xbca16e?_0x4baf03:_0x5d9b3a,{'parentMessageId':_0x3cd880,'maxRounds':(0x0,helper_1[_0x1b5d91(0x204)])(_0x56abfb)});_0x5f01cf=await(0x0,baidu_1[_0x1b5d91(0x245)])(_0xbca16e?_0x4baf03:_0x2238d3,{'temperature':_0xa009b7,'accessToken':_0x2695c1,'model':_0x10ba29,'onProgress':_0x123197=>{const _0x6ffcf6=_0x1b5d91;_0x6ba7b0&&_0x6ba7b0[_0x6ffcf6(0x19b)](_0x2088e9?JSON['stringify'](_0x123197):'\x0a'+JSON[_0x6ffcf6(0x2ac)](_0x123197)),_0x2088e9=![],_0x36826d=_0x123197;}}),_0x409423=!![];}if(Number(_0x11820c)===0x3){let _0x46c2da=!![];const {context:_0x1b5857}=await this[_0x1b5d91(0x20f)][_0x1b5d91(0x248)](_0xbca16e?_0x4baf03:_0x5d9b3a,{'parentMessageId':_0x3cd880,'maxRounds':(0x0,helper_1[_0x1b5d91(0x204)])(_0x56abfb)});_0x5f01cf=await(0x0,zhipu_1['sendMessageFromZhipu'])(_0xbca16e?_0x4baf03:_0x1b5857,{'temperature':_0xa009b7,'key':_0x2c8162,'model':_0x10ba29,'onProgress':_0x58a881=>{const _0x173962=_0x1b5d91;_0x6ba7b0&&_0x6ba7b0[_0x173962(0x19b)](_0x46c2da?JSON[_0x173962(0x2ac)](_0x58a881):'\x0a'+JSON['stringify'](_0x58a881)),_0x46c2da=![],_0x36826d=_0x58a881;}}),_0x409423=!![];}const _0x1713af={'id':this[_0x1b5d91(0x20f)][_0x1b5d91(0x258)](),'text':_0x5d9b3a,'role':_0x1b5d91(0x197),'name':undefined,'usage':null,'parentMessageId':_0x3cd880,'conversationId':_0x5f01cf===null||_0x5f01cf===void 0x0?void 0x0:_0x5f01cf[_0x1b5d91(0x256)]};_0x5a3bd6={'model':_0x10ba29,'parentMessageId':_0x3cd880},await this['rocketStore'][_0x1b5d91(0x19e)](_0x1713af);const _0x370eb1={'id':_0x5f01cf['id'],'text':_0x5f01cf['text'],'role':'assistant','name':undefined,'usage':_0x5f01cf[_0x1b5d91(0x2a8)],'parentMessageId':_0x1713af['id'],'conversationId':_0x5f01cf===null||_0x5f01cf===void 0x0?void 0x0:_0x5f01cf['conversationId']};await this['rocketStore'][_0x1b5d91(0x19e)](_0x370eb1),_0x5a3bd6={'model':_0x10ba29,'parentMessageId':_0x1713af['id']};}else{const {key:_0x281820,maxToken:_0x39759d,maxTokenRes:_0x53d4be,proxyResUrl:_0x2b2420}=await this[_0x1b5d91(0x202)](_0x268a16),{parentMessageId:_0x476783,completionParams:_0x4866ee,systemMessage:_0x5201d9}=_0x547d2c,{model:_0xe0d7d7,temperature:_0x543352}=_0x4866ee,{context:_0x5a99fe}=await this[_0x1b5d91(0x20f)][_0x1b5d91(0x248)](_0xbca16e?_0x4baf03:_0x5d9b3a,{'parentMessageId':_0x476783,'systemMessage':_0x5201d9,'maxRounds':(0x0,helper_1[_0x1b5d91(0x204)])(_0x56abfb)});_0x5f01cf=await(0x0,openai_1[_0x1b5d91(0x1a7)])(_0x5a99fe,{'apiKey':_0x251180,'model':_0xe0d7d7,'temperature':_0x543352,'proxyUrl':_0x2b2420,'onProgress':null});}const _0x1f54de=await(0x0,helper_1[_0x1b5d91(0x274)])(_0x11820c,_0x5f01cf,_0x5a3bd6),{prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=_0x1f54de[_0x1b5d91(0x2a8)];await this[_0x1b5d91(0x267)]['deductFromBalance'](_0x3c3ed3[_0x1b5d91(0x197)]['id'],_0x1b5d91(0x28f)+(_0x2fb7e1===0x1?0x3:0x4),_0x4b1d3d,total_tokens),await this['modelsService'][_0x1b5d91(0x20a)](_0x3e87f1,total_tokens);const _0x22a4f5=(0x0,utils_1['getClientIp'])(_0x3c3ed3),_0xf48eea={'appId':_0x1763d0,'curIp':_0x22a4f5,'userId':_0x3c3ed3[_0x1b5d91(0x197)]['id'],'type':balance_constant_1[_0x1b5d91(0x1a1)][_0x1b5d91(0x263)],'prompt':_0x5d9b3a,'answer':'','promptTokens':prompt_tokens,'completionTokens':0x0,'totalTokens':total_tokens,'model':_0x1f54de['model'],'role':_0x1b5d91(0x197),'groupId':_0x351a9d,'requestOptions':JSON[_0x1b5d91(0x2ac)]({'options':null,'prompt':_0x5d9b3a})};_0x87a85d&&(_0xf48eea[_0x1b5d91(0x1ac)]=_0x87a85d,_0xf48eea[_0x1b5d91(0x1c5)]=_0x5cb17c);common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x23d)+JSON['stringify'](_0xf48eea),_0x1b5d91(0x1ba)),await this[_0x1b5d91(0x29b)]['saveChatLog'](_0xf48eea),await this[_0x1b5d91(0x29b)][_0x1b5d91(0x1bb)]({'appId':_0x1763d0,'curIp':_0x22a4f5,'userId':_0x3c3ed3[_0x1b5d91(0x197)]['id'],'type':balance_constant_1[_0x1b5d91(0x1a1)][_0x1b5d91(0x263)],'prompt':_0x5d9b3a,'answer':_0x1f54de===null||_0x1f54de===void 0x0?void 0x0:_0x1f54de[_0x1b5d91(0x2b3)],'promptTokens':prompt_tokens,'completionTokens':completion_tokens,'totalTokens':total_tokens,'model':_0x10ba29,'role':_0x1b5d91(0x21c),'groupId':_0x351a9d,'requestOptions':JSON[_0x1b5d91(0x2ac)]({'options':{'model':_0x10ba29,'temperature':_0xa009b7},'prompt':_0x5d9b3a}),'conversationOptions':JSON[_0x1b5d91(0x2ac)]({'conversationId':_0x5f01cf['conversationId'],'model':_0x10ba29,'parentMessageId':_0x5f01cf['id'],'temperature':_0xa009b7})}),common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1da)](_0x1b5d91(0x1e7)+_0x3c3ed3[_0x1b5d91(0x197)]['id']+_0x1b5d91(0x27e)+_0x10ba29+_0x1b5d91(0x1fa)+_0x2c8162+_0x1b5d91(0x1c0)+_0x3343bb+_0x1b5d91(0x1eb)+maxResponseTokens,_0x1b5d91(0x1ba));const _0x5cd17c=await this[_0x1b5d91(0x267)][_0x1b5d91(0x20e)](_0x3c3ed3[_0x1b5d91(0x197)]['id']);_0x5f01cf[_0x1b5d91(0x1db)]=Object[_0x1b5d91(0x276)]({},_0x5cd17c),_0x5f01cf['result']&&(_0x5f01cf['result']=''),_0x5f01cf['is_end']=!![];if(_0x1b4326)return _0x5f01cf;return _0x6ba7b0?_0x6ba7b0[_0x1b5d91(0x19b)]('\x0a'+JSON[_0x1b5d91(0x2ac)](_0x5f01cf)):_0x5f01cf[_0x1b5d91(0x2b3)];}catch(_0x113e0c){const _0x1e751a=((_0x241a04=_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c['response'])===null||_0x241a04===void 0x0?void 0x0:_0x241a04['status'])||0x190,_0x3d7a5b=((_0x3ef944=_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x1dd)])===null||_0x3ef944===void 0x0?void 0x0:_0x3ef944[_0x1b5d91(0x1cd)])||(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x280)])||0x190;common_1['Logger'][_0x1b5d91(0x1f7)]('chat-error-detail\x20\x20<----------------------------------------->\x0a\x20\x20\x20\x20\x20\x20\x20\x20modelKey:'+_0x251180+_0x1b5d91(0x21f)+_0x3d7a5b+_0x1b5d91(0x24c)+_0x1e751a+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20message:'+(_0x113e0c[_0x1b5d91(0x1c1)]||_0x113e0c)+_0x1b5d91(0x2b0)+((_0xfe876f=_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x1dd)])===null||_0xfe876f===void 0x0?void 0x0:_0xfe876f[_0x1b5d91(0x1a4)])+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20');if(_0x113e0c['status']&&_0x113e0c[_0x1b5d91(0x1cd)]===0x192){const _0x10c35d={'message':'Catch\x20Error\x20'+_0x113e0c[_0x1b5d91(0x1c1)],'code':0x192};if(_0x6ba7b0)return _0x6ba7b0['write'](JSON[_0x1b5d91(0x2ac)](_0x10c35d));else throw new common_1[(_0x1b5d91(0x2aa))](_0x113e0c[_0x1b5d91(0x1c1)],common_1[_0x1b5d91(0x196)]['PAYMENT_REQUIRED']);}if(!_0x3d7a5b){if(_0x6ba7b0)return _0x6ba7b0[_0x1b5d91(0x19b)](JSON[_0x1b5d91(0x2ac)]({'message':_0x113e0c[_0x1b5d91(0x1c1)],'code':0x1f4}));else throw new common_1['HttpException'](_0x113e0c['message'],common_1[_0x1b5d91(0x196)]['BAD_REQUEST']);}let _0xc58ebe=errorMessage_constant_1[_0x1b5d91(0x1d3)][_0x3d7a5b]?errorMessage_constant_1[_0x1b5d91(0x1d3)][_0x3d7a5b]:_0x1b5d91(0x208);(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x1c1)]['includes']('The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.'))&&Number(_0x11820c)===0x1&&(await this[_0x1b5d91(0x283)][_0x1b5d91(0x222)](_0x3e87f1,'当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',-0x1),_0xc58ebe=_0x1b5d91(0x20d));(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x280)])===0x1ad&&_0x113e0c[_0x1b5d91(0x1c1)][_0x1b5d91(0x230)](_0x1b5d91(0x249))&&Number(_0x11820c)===0x1&&(await this['modelsService'][_0x1b5d91(0x222)](_0x3e87f1,_0x1b5d91(0x26b),-0x3),_0xc58ebe=_0x1b5d91(0x1bd));(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x280)])===0x1ad&&(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x1a4)])===_0x1b5d91(0x221)&&(_0xc58ebe=_0x1b5d91(0x22a));(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x280)])===0x191&&_0x113e0c[_0x1b5d91(0x1c1)][_0x1b5d91(0x230)](_0x1b5d91(0x213))&&Number(_0x11820c)===0x1&&(await this[_0x1b5d91(0x283)][_0x1b5d91(0x222)](_0x3e87f1,_0x1b5d91(0x266),-0x2),_0xc58ebe='提供了错误的模型秘钥、已冻结当前调用Key、请重新尝试对话！');(_0x113e0c===null||_0x113e0c===void 0x0?void 0x0:_0x113e0c[_0x1b5d91(0x280)])===0x194&&_0x113e0c[_0x1b5d91(0x1c1)][_0x1b5d91(0x230)](_0x1b5d91(0x24b))&&Number(_0x11820c)===0x1&&(await this[_0x1b5d91(0x283)][_0x1b5d91(0x222)](_0x3e87f1,_0x1b5d91(0x201),-0x4),_0xc58ebe=_0x1b5d91(0x26c));const _0x14dc4f={'message':_0xc58ebe||_0x1b5d91(0x22d),'code':_0x1e751a===0x191?0x190:_0x1e751a||0x1f4};if(_0x6ba7b0)return _0x6ba7b0['write'](JSON[_0x1b5d91(0x2ac)](_0x14dc4f));else throw new common_1[(_0x1b5d91(0x2aa))](_0x14dc4f[_0x1b5d91(0x1c1)],common_1['HttpStatus'][_0x1b5d91(0x28b)]);}finally{common_1[_0x1b5d91(0x259)][_0x1b5d91(0x1f7)]('chatProcess\x20finally\x20对话结束',_0x1b5d91(0x1ba)),_0x6ba7b0&&_0x6ba7b0[_0x1b5d91(0x1d4)]&&(_0x6ba7b0[_0x1b5d91(0x1d4)](),common_1['Logger'][_0x1b5d91(0x1da)](_0x1b5d91(0x240),_0x1b5d91(0x1ba)));}}catch(_0x31461d){const _0x35c4f2=''+(_0x31461d[_0x1b5d91(0x1c1)]||_0x31461d);common_1[_0x1b5d91(0x259)]['error']('chatProcess\x20error:'+_0x35c4f2,_0x1b5d91(0x1ba));throw new Error(_0x35c4f2);}}async[_0x5e726a(0x228)](_0x58b408,_0x45d8fd){const _0x1dd000=_0x5e726a;var _0x3713f2,_0x460f87,_0x14b162,_0x654bcb;await this[_0x1dd000(0x1b8)][_0x1dd000(0x271)](_0x58b408[_0x1dd000(0x29f)],_0x45d8fd[_0x1dd000(0x197)]['id']),await this[_0x1dd000(0x290)]['checkUserStatus'](_0x45d8fd[_0x1dd000(0x197)]);const _0x2036ca=(_0x58b408===null||_0x58b408===void 0x0?void 0x0:_0x58b408['quality'])==='hd'?0x4:0x2;await this[_0x1dd000(0x267)][_0x1dd000(0x2a9)](_0x45d8fd,_0x1dd000(0x1bc),_0x2036ca);let _0x5e881e=[];const _0x525df1=await this['modelsService'][_0x1dd000(0x253)](),_0x8f7e79=_0x525df1===null||_0x525df1===void 0x0?void 0x0:_0x525df1['id'],{key:_0x3eae1f,proxyResUrl:_0x11c99b}=await this[_0x1dd000(0x202)](_0x525df1);common_1['Logger']['log'](_0x1dd000(0x1dc)+_0x58b408['prompt']+_0x1dd000(0x1ed)+_0x3eae1f,'DrawService');try{const _0xf3d2c9=_0x11c99b+_0x1dd000(0x260),_0x1ec48b=Object[_0x1dd000(0x276)](Object[_0x1dd000(0x276)]({},_0x58b408),{'model':_0x1dd000(0x23c)});console['log'](_0x1dd000(0x289),_0x1ec48b);const _0x546606=await axios_1[_0x1dd000(0x1d0)][_0x1dd000(0x1cb)](_0xf3d2c9,Object['assign'](Object[_0x1dd000(0x276)]({},_0x1ec48b),{'response_format':_0x1dd000(0x1b6)}),{'headers':{'Authorization':_0x1dd000(0x231)+_0x3eae1f}});_0x5e881e=_0x546606[_0x1dd000(0x224)][_0x1dd000(0x224)];const _0x241ea7=[];for(const _0x2d0ff9 of _0x5e881e){const _0x3d5ddb=uuid['v4']()[_0x1dd000(0x281)](0x0,0xa)+_0x1dd000(0x1ce),_0x271508=Buffer['from'](_0x2d0ff9[_0x1dd000(0x1b6)],_0x1dd000(0x1f9));_0x241ea7[_0x1dd000(0x19f)](this[_0x1dd000(0x210)][_0x1dd000(0x205)]({'filename':_0x3d5ddb,'buffer':_0x271508}));}const _0x196ecd=await Promise[_0x1dd000(0x25d)](_0x241ea7);await this[_0x1dd000(0x267)][_0x1dd000(0x1b2)](_0x45d8fd[_0x1dd000(0x197)]['id'],_0x1dd000(0x1bc),(_0x1ec48b===null||_0x1ec48b===void 0x0?void 0x0:_0x1ec48b[_0x1dd000(0x1ae)])==='standard'?0x2:0x4,_0x2036ca);const _0x5465a8=(0x0,utils_1[_0x1dd000(0x1be)])(_0x45d8fd),_0xba0dc=[],_0x576a0a=await this[_0x1dd000(0x210)][_0x1dd000(0x29e)](),[_0x5f5c5d,_0x28fc77]=_0x58b408[_0x1dd000(0x239)][_0x1dd000(0x23e)]('x');return _0x196ecd['forEach'](_0x2dfba=>{const _0x43ccf1=_0x1dd000;_0xba0dc[_0x43ccf1(0x19f)](this['chatLogService'][_0x43ccf1(0x1bb)]({'curIp':_0x5465a8,'userId':_0x45d8fd[_0x43ccf1(0x197)]['id'],'type':balance_constant_1['DeductionKey']['PAINT_TYPE'],'prompt':_0x58b408[_0x43ccf1(0x29f)],'answer':_0x2dfba,'fileInfo':JSON[_0x43ccf1(0x2ac)]({'cosType':_0x576a0a,'width':_0x5f5c5d,'height':_0x28fc77,'cosUrl':_0x2dfba}),'promptTokens':0x0,'completionTokens':0x0,'totalTokens':0x0,'model':_0x43ccf1(0x23c)}));}),await Promise[_0x1dd000(0x25d)](_0xba0dc),_0x196ecd;}catch(_0x22f6dd){const _0x4dfc21=((_0x3713f2=_0x22f6dd===null||_0x22f6dd===void 0x0?void 0x0:_0x22f6dd[_0x1dd000(0x1dd)])===null||_0x3713f2===void 0x0?void 0x0:_0x3713f2['status'])||0x1f4;console[_0x1dd000(0x226)](_0x1dd000(0x1f1),JSON[_0x1dd000(0x2ac)](_0x22f6dd),_0x3eae1f,_0x4dfc21);const _0x2cfc79=(_0x654bcb=(_0x14b162=(_0x460f87=_0x22f6dd===null||_0x22f6dd===void 0x0?void 0x0:_0x22f6dd[_0x1dd000(0x1dd)])===null||_0x460f87===void 0x0?void 0x0:_0x460f87[_0x1dd000(0x224)])===null||_0x14b162===void 0x0?void 0x0:_0x14b162['error'])===null||_0x654bcb===void 0x0?void 0x0:_0x654bcb['message'];if(_0x4dfc21===0x1ad)throw new common_1[(_0x1dd000(0x2aa))](_0x1dd000(0x255),common_1[_0x1dd000(0x196)]['BAD_REQUEST']);if(_0x4dfc21===0x190&&_0x2cfc79[_0x1dd000(0x230)](_0x1dd000(0x284)))throw new common_1[(_0x1dd000(0x2aa))]('您的请求已被系统拒绝。您的提示可能存在一些非法的文本。',common_1[_0x1dd000(0x196)][_0x1dd000(0x28b)]);if(_0x4dfc21===0x190&&_0x2cfc79[_0x1dd000(0x230)]('Billing\x20hard\x20limit\x20has\x20been\x20reached')){await this['modelsService'][_0x1dd000(0x222)](_0x8f7e79,'当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',-0x1);throw new common_1[(_0x1dd000(0x2aa))](_0x1dd000(0x250),common_1[_0x1dd000(0x196)][_0x1dd000(0x28b)]);}if(_0x4dfc21===0x1f4)throw new common_1['HttpException'](_0x1dd000(0x1ad),common_1[_0x1dd000(0x196)][_0x1dd000(0x28b)]);if(_0x4dfc21===0x191)throw new common_1[(_0x1dd000(0x2aa))](_0x1dd000(0x285),common_1[_0x1dd000(0x196)]['BAD_REQUEST']);throw new common_1[(_0x1dd000(0x2aa))](_0x1dd000(0x1f5),common_1['HttpStatus'][_0x1dd000(0x28b)]);}}async[_0x5e726a(0x2a0)](){const _0x3fd2ea=_0x5e726a,_0x43ff6e=await this[_0x3fd2ea(0x1f6)][_0x3fd2ea(0x25c)]({'where':{'status':0x1},'select':['id',_0x3fd2ea(0x193),_0x3fd2ea(0x23b),_0x3fd2ea(0x28f),_0x3fd2ea(0x26e),'maxResponseTokens',_0x3fd2ea(0x29d),'openaiTimeoutMs']}),_0x44cdad=_0x43ff6e[_0x3fd2ea(0x291)](_0x33da78=>_0x33da78[_0x3fd2ea(0x28f)]['includes'](_0x3fd2ea(0x237))),_0x160536=_0x43ff6e[_0x3fd2ea(0x291)](_0x3db4b1=>_0x3db4b1['model'][_0x3fd2ea(0x230)](_0x3fd2ea(0x1ab)));this[_0x3fd2ea(0x1b5)]={'list3':_0x44cdad,'list4':_0x160536};}async['getModelProxyUrl'](_0x55ebed){const _0x4b19a6=_0x5e726a,_0xda40a3=await this['globalConfigService'][_0x4b19a6(0x209)]([_0x4b19a6(0x1a2)]);return(_0x55ebed===null||_0x55ebed===void 0x0?void 0x0:_0x55ebed['proxyUrl'])||_0xda40a3||_0x4b19a6(0x1df);}async[_0x5e726a(0x202)](_0x4cf878){const _0x5afcc8=_0x5e726a,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x5afcc8(0x28d)][_0x5afcc8(0x209)]([_0x5afcc8(0x26f),_0x5afcc8(0x1d9),'openaiModel3MaxTokens16k',_0x5afcc8(0x1a8),'openaiModel4MaxTokens',_0x5afcc8(0x252),'openaiModel4MaxTokens32k','openaiModel4MaxTokens32kRes',_0x5afcc8(0x1a2)]);let _0x3b0525=null,_0x35ec80=null,_0x11351d=null,{model:_0x2f0414,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,proxyUrl:proxyUrl='',key:_0x18f2b7}=_0x4cf878;return _0x2f0414['toLowerCase']()[_0x5afcc8(0x230)](_0x5afcc8(0x1ab))&&(maxModelTokens>=0x2000&&(maxModelTokens=0x2000),_0x35ec80>=0x1000&&(maxModelTokens=0x1000),_0x3b0525=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x35ec80=maxResponseTokens||openaiModel4MaxTokensRes||0x1000,_0x2f0414[_0x5afcc8(0x21b)]()[_0x5afcc8(0x230)](_0x5afcc8(0x28a))&&(maxModelTokens>=0x8000&&(maxModelTokens=0x8000),_0x35ec80>=0x4000&&(maxModelTokens=0x4000),_0x3b0525=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x35ec80=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000),_0x2f0414[_0x5afcc8(0x21b)]()[_0x5afcc8(0x230)](_0x5afcc8(0x1ff))&&(maxModelTokens>=0x3ffc&&(maxModelTokens=0x3ffc),_0x35ec80>=0x1000&&(maxModelTokens=0x1000),_0x3b0525=maxModelTokens||0x3ffc,_0x35ec80=maxResponseTokens||0x1000)),_0x2f0414[_0x5afcc8(0x21b)]()[_0x5afcc8(0x230)](_0x5afcc8(0x237))&&(maxModelTokens>=0x1000&&(maxModelTokens=0x1000),_0x35ec80>=0x7d0&&(maxModelTokens=0x7d0),_0x3b0525=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x35ec80=maxResponseTokens||openaiModel3MaxTokensRes||0x7d0,_0x2f0414[_0x5afcc8(0x21b)]()[_0x5afcc8(0x230)]('16k')&&(maxModelTokens>=0x4000&&(maxModelTokens=0x4000),_0x35ec80>=0x2000&&(maxModelTokens=0x2000),_0x3b0525=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x35ec80=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000),_0x2f0414[_0x5afcc8(0x21b)]()[_0x5afcc8(0x230)](_0x5afcc8(0x1ff))&&(maxModelTokens>=0x4000&&(maxModelTokens=0x4000),_0x35ec80>=0x1000&&(maxModelTokens=0x1000),_0x3b0525=maxModelTokens||0x4000,_0x35ec80=maxResponseTokens||0x1000)),_0x11351d=proxyUrl||openaiBaseUrl||_0x5afcc8(0x1df),_0x35ec80>=_0x3b0525&&(_0x35ec80=Math[_0x5afcc8(0x22f)](_0x3b0525/0x2)),{'key':_0x18f2b7,'maxToken':_0x3b0525,'maxTokenRes':_0x35ec80,'proxyResUrl':_0x11351d};}async[_0x5e726a(0x1bf)](_0x3e1701,_0x38e0f3){const _0xbe2e5e=_0x5e726a;try{const {name:_0x3d0e28,icon:_0x410923,order:_0x3129c9,id:_0x31fd13,status:_0x300d9c}=_0x38e0f3;return _0x31fd13?await this['chatBoxTypeEntity'][_0xbe2e5e(0x2a6)]({'id':_0x31fd13},{'name':_0x3d0e28,'icon':_0x410923,'order':_0x3129c9,'status':_0x300d9c}):await this['chatBoxTypeEntity'][_0xbe2e5e(0x21e)]({'name':_0x3d0e28,'icon':_0x410923,'order':_0x3129c9,'status':_0x300d9c});}catch(_0x119fdc){console[_0xbe2e5e(0x226)]('error:\x20',_0x119fdc);}}async[_0x5e726a(0x1c3)](_0x3a79b9,_0x138156){const _0x2b690f=_0x5e726a,{id:_0x476ed3}=_0x138156;if(!_0x476ed3)throw new common_1['HttpException'](_0x2b690f(0x1fd),common_1[_0x2b690f(0x196)]['BAD_REQUEST']);const _0x3ba129=await this['chatBoxEntity']['count']({'where':{'typeId':_0x476ed3}});if(_0x3ba129)throw new common_1[(_0x2b690f(0x2aa))](_0x2b690f(0x1d2),common_1['HttpStatus'][_0x2b690f(0x28b)]);return await this['chatBoxTypeEntity'][_0x2b690f(0x244)]({'id':_0x476ed3});}async['queryChatBoxType'](){const _0x2c4632=_0x5e726a;return await this[_0x2c4632(0x1cc)]['find']({'order':{'order':'DESC'}});}async[_0x5e726a(0x1e3)](_0x41ce38,_0x44c90){const _0x561286=_0x5e726a,{title:_0x51121d,prompt:_0x5be4b2,appId:_0x3645d4,order:_0x223377,status:_0x2c9a4e,typeId:_0x1ba139,id:_0x597c8e,url:_0x346bc8}=_0x44c90;if(!_0x1ba139)throw new common_1['HttpException'](_0x561286(0x275),common_1[_0x561286(0x196)][_0x561286(0x28b)]);try{const _0x226533={'title':_0x51121d,'order':_0x223377,'status':_0x2c9a4e,'typeId':_0x1ba139,'url':_0x346bc8};return _0x226533[_0x561286(0x1d7)]=_0x3645d4||0x0,_0x226533['prompt']=_0x5be4b2||'',_0x597c8e?await this[_0x561286(0x282)][_0x561286(0x2a6)]({'id':_0x597c8e},_0x226533):await this['chatBoxEntity'][_0x561286(0x21e)](_0x226533);}catch(_0x53b91d){console[_0x561286(0x226)](_0x561286(0x1b1),_0x53b91d);}}async[_0x5e726a(0x223)](_0x250181,_0x22f4e1){const _0x190b69=_0x5e726a,{id:_0x2a4d8f}=_0x22f4e1;if(!_0x2a4d8f)throw new common_1[(_0x190b69(0x2aa))](_0x190b69(0x1fd),common_1[_0x190b69(0x196)]['BAD_REQUEST']);return await this[_0x190b69(0x282)][_0x190b69(0x244)]({'id':_0x2a4d8f});}async[_0x5e726a(0x2b1)](){const _0x36452d=_0x5e726a,_0x188262=await this[_0x36452d(0x282)][_0x36452d(0x25c)]({'order':{'order':_0x36452d(0x2a5)}}),_0x1bff63=[...new Set(_0x188262[_0x36452d(0x1b9)](_0xf2c30c=>_0xf2c30c[_0x36452d(0x2a2)]))],_0x10b0de=[...new Set(_0x188262[_0x36452d(0x1b9)](_0x27882c=>_0x27882c[_0x36452d(0x1d7)]))],_0x215197=await this[_0x36452d(0x1cc)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0x1bff63)}}),_0x2832e7=await this['appEntity'][_0x36452d(0x25c)]({'where':{'id':(0x0,typeorm_1['In'])(_0x10b0de)}});return _0x188262[_0x36452d(0x1b9)](_0x167600=>{const _0x541ed3=_0x36452d,{typeId:_0x1b49cb,appId:_0x5ed54d}=_0x167600;return _0x167600['typeInfo']=_0x215197[_0x541ed3(0x25c)](_0xd9086=>_0xd9086['id']===_0x1b49cb),_0x167600[_0x541ed3(0x238)]=_0x2832e7[_0x541ed3(0x25c)](_0x54f5c4=>_0x54f5c4['id']===_0x5ed54d),_0x167600;});}async[_0x5e726a(0x1ee)](){const _0x19e042=_0x5e726a,_0x409017=await this[_0x19e042(0x1cc)][_0x19e042(0x25c)]({'order':{'order':_0x19e042(0x2a5)},'where':{'status':!![]}}),_0x39e6b1=await this['chatBoxEntity'][_0x19e042(0x25c)]({'where':{'status':!![]}}),_0x626c5b=[...new Set(_0x39e6b1[_0x19e042(0x1b9)](_0x38444d=>_0x38444d['appId']))],_0x189736=await this[_0x19e042(0x1c7)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0x626c5b)}});return _0x39e6b1[_0x19e042(0x20b)](_0x1d19cc=>{const _0x3a0384=_0x19e042,_0x1e42f8=_0x189736['find'](_0x1c6a4c=>_0x1c6a4c['id']===_0x1d19cc[_0x3a0384(0x1d7)]);return _0x1d19cc['coverImg']=_0x1e42f8===null||_0x1e42f8===void 0x0?void 0x0:_0x1e42f8[_0x3a0384(0x1ec)],_0x1d19cc;}),_0x409017['map'](_0x6124c7=>{const _0x4015c6=_0x19e042;return _0x6124c7[_0x4015c6(0x292)]=_0x39e6b1[_0x4015c6(0x291)](_0x315f89=>_0x315f89[_0x4015c6(0x2a2)]===_0x6124c7['id']&&_0x315f89[_0x4015c6(0x1cd)]),_0x6124c7;});}async['setChatPreType'](_0x5d5067,_0x47f014){const _0x177705=_0x5e726a;try{const {name:_0x15de5e,icon:_0x48531a,order:_0x2542eb,id:_0x20b1d9,status:_0x5a7475}=_0x47f014;return _0x20b1d9?await this[_0x177705(0x1e4)][_0x177705(0x2a6)]({'id':_0x20b1d9},{'name':_0x15de5e,'icon':_0x48531a,'order':_0x2542eb,'status':_0x5a7475}):await this[_0x177705(0x1e4)][_0x177705(0x21e)]({'name':_0x15de5e,'icon':_0x48531a,'order':_0x2542eb,'status':_0x5a7475});}catch(_0x198255){console[_0x177705(0x226)](_0x177705(0x1b1),_0x198255);}}async['delChatPreType'](_0x271f90,_0x2faaea){const _0x415216=_0x5e726a,{id:_0x5bdb50}=_0x2faaea;if(!_0x5bdb50)throw new common_1[(_0x415216(0x2aa))](_0x415216(0x1fd),common_1[_0x415216(0x196)]['BAD_REQUEST']);const _0x3a8b31=await this[_0x415216(0x282)][_0x415216(0x2a4)]({'where':{'typeId':_0x5bdb50}});if(_0x3a8b31)throw new common_1[(_0x415216(0x2aa))](_0x415216(0x1d2),common_1['HttpStatus'][_0x415216(0x28b)]);return await this[_0x415216(0x1e4)][_0x415216(0x244)]({'id':_0x5bdb50});}async[_0x5e726a(0x242)](){const _0x334c93=_0x5e726a;return await this[_0x334c93(0x1e4)][_0x334c93(0x25c)]({'order':{'order':_0x334c93(0x2a5)}});}async[_0x5e726a(0x288)](_0x232d59,_0x306fac){const _0x24bbda=_0x5e726a,{title:_0x332042,prompt:_0x2713b7,appId:_0x3fe4b0,order:_0x4c2bdf,status:_0x160105,typeId:_0xf8a4aa,id:_0x5d8a69,url:_0x3703e5}=_0x306fac;if(!_0xf8a4aa)throw new common_1[(_0x24bbda(0x2aa))](_0x24bbda(0x275),common_1[_0x24bbda(0x196)][_0x24bbda(0x28b)]);try{const _0x1bb328={'title':_0x332042,'prompt':_0x2713b7,'order':_0x4c2bdf,'status':_0x160105,'typeId':_0xf8a4aa,'url':_0x3703e5};return _0x5d8a69?await this[_0x24bbda(0x198)]['update']({'id':_0x5d8a69},_0x1bb328):await this[_0x24bbda(0x198)][_0x24bbda(0x21e)](_0x1bb328);}catch(_0x2e6a57){console['log'](_0x24bbda(0x1b1),_0x2e6a57);}}async['delChatPre'](_0x649728,_0xc52957){const _0x5a5b53=_0x5e726a,{id:_0x3fb08e}=_0xc52957;if(!_0x3fb08e)throw new common_1['HttpException'](_0x5a5b53(0x1fd),common_1['HttpStatus'][_0x5a5b53(0x28b)]);return await this[_0x5a5b53(0x198)][_0x5a5b53(0x244)]({'id':_0x3fb08e});}async[_0x5e726a(0x264)](){const _0x4b4043=_0x5e726a,_0x524887=await this[_0x4b4043(0x198)][_0x4b4043(0x25c)]({'order':{'order':_0x4b4043(0x2a5)}}),_0x1e158a=[...new Set(_0x524887['map'](_0xedbf8e=>_0xedbf8e[_0x4b4043(0x2a2)]))],_0x2cb295=await this[_0x4b4043(0x1e4)][_0x4b4043(0x25c)]({'where':{'id':(0x0,typeorm_1['In'])(_0x1e158a)}});return _0x524887[_0x4b4043(0x1b9)](_0x4e5197=>{const _0x4dfadf=_0x4b4043,{typeId:_0x31a557,appId:_0x52fb95}=_0x4e5197;return _0x4e5197['typeInfo']=_0x2cb295[_0x4dfadf(0x25c)](_0x49ece7=>_0x49ece7['id']===_0x31a557),_0x4e5197;});}async[_0x5e726a(0x27a)](){const _0x4cd941=_0x5e726a,_0x58c458=await this[_0x4cd941(0x1e4)][_0x4cd941(0x25c)]({'order':{'order':_0x4cd941(0x2a5)},'where':{'status':!![]}}),_0x1515bd=await this[_0x4cd941(0x198)][_0x4cd941(0x25c)]({'where':{'status':!![]}});return _0x58c458[_0x4cd941(0x1b9)](_0x51beab=>{const _0x139658=_0x4cd941;return _0x51beab[_0x139658(0x292)]=_0x1515bd['filter'](_0x379475=>_0x379475[_0x139658(0x2a2)]===_0x51beab['id']&&_0x379475[_0x139658(0x1cd)]),_0x51beab;});}async[_0x5e726a(0x211)](_0x1c7345,_0x3eb37d){const _0x1101ab=_0x5e726a,_0x249c9=await this[_0x1101ab(0x28d)][_0x1101ab(0x209)]([_0x1101ab(0x192)]);let _0x53f772=await this[_0x1101ab(0x28d)][_0x1101ab(0x209)]([_0x1101ab(0x217)]);return _0x53f772=_0x53f772+_0x1101ab(0x2a7)+_0x3eb37d['keyword'],fetch(_0x53f772,{'method':_0x1101ab(0x235),'headers':{'Authorization':_0x1101ab(0x231)+_0x249c9}})[_0x1101ab(0x1c4)](_0x5f2752=>_0x5f2752[_0x1101ab(0x2b3)]())[_0x1101ab(0x1c4)](async _0x4b0068=>{const _0x3c9988=_0x1101ab,_0x283901=JSON[_0x3c9988(0x26a)](_0x4b0068);return _0x283901;})[_0x1101ab(0x1e2)](_0x2edf41=>{const _0x3a616c=_0x1101ab;throw new common_1['HttpException'](_0x2edf41,common_1['HttpStatus'][_0x3a616c(0x28b)]);});}async[_0x5e726a(0x22c)](_0x23954a,_0xb7ff56,_0x4399e2){const _0x1cb2da=_0x5e726a;let _0x3be58e=0x1000,_0x10c9e3=0x800;return _0x23954a['toLowerCase']()[_0x1cb2da(0x230)](_0x1cb2da(0x1ab))&&(_0x3be58e=_0xb7ff56>=0x2004?0x2004:_0xb7ff56,_0x10c9e3=_0x4399e2>=0x1000?0x1000:_0x4399e2,_0x23954a[_0x1cb2da(0x21b)]()[_0x1cb2da(0x230)](_0x1cb2da(0x28a))&&(_0x3be58e=_0xb7ff56>=0x8000?0x8000:_0xb7ff56,_0x10c9e3=_0x4399e2>=0x3e80?0x3e80:_0x4399e2),(_0x23954a[_0x1cb2da(0x21b)]()[_0x1cb2da(0x230)](_0x1cb2da(0x1a3))||_0x23954a['toLowerCase']()[_0x1cb2da(0x230)](_0x1cb2da(0x1a6)))&&(_0x3be58e=_0xb7ff56>=0x1f400?0x1f400:_0xb7ff56,_0x10c9e3=_0x4399e2>=0x1000?0x1000:_0x4399e2)),_0x23954a[_0x1cb2da(0x21b)]()[_0x1cb2da(0x230)](_0x1cb2da(0x237))&&(_0x3be58e=_0xb7ff56>=0x1000?0x1000:_0xb7ff56,_0x10c9e3=_0x4399e2>=0x800?0x800:_0x4399e2,_0x23954a['toLowerCase']()[_0x1cb2da(0x230)](_0x1cb2da(0x251))&&(_0x3be58e=_0xb7ff56>=0x4000?0x4000:_0xb7ff56,_0x10c9e3=_0x4399e2>=0x1f40?0x1f40:_0x4399e2),_0x23954a[_0x1cb2da(0x21b)]()[_0x1cb2da(0x230)](_0x1cb2da(0x1ff))&&(_0x3be58e=_0xb7ff56>=0x4000?0x4000:_0xb7ff56,_0x10c9e3=_0x4399e2>=0x1f40?0x1f40:_0x4399e2)),{'maxToken':_0x3be58e,'maxRes':_0x10c9e3};}['getImageFormat'](_0x321e03){const _0x2798c5=_0x5e726a,_0x2ecc26=_0x321e03[_0x2798c5(0x281)](0x0,0x1e);if(_0x2ecc26[_0x2798c5(0x230)](_0x2798c5(0x2ae)))return _0x2798c5(0x225);else{if(_0x2ecc26[_0x2798c5(0x230)](_0x2798c5(0x279)))return'png';else{if(_0x2ecc26[_0x2798c5(0x230)](_0x2798c5(0x206)))return _0x2798c5(0x1e5);else return _0x2ecc26[_0x2798c5(0x230)]('data:image/webp;base64')?'webp':null;}}}};ChatgptService=__decorate([(0x0,common_1[_0x5e726a(0x207)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(gptKeys_entity_1['GptKeysEntity'])),__param(0x1,(0x0,typeorm_2[_0x5e726a(0x219)])(config_entity_1['ConfigEntity'])),__param(0x2,(0x0,typeorm_2[_0x5e726a(0x219)])(chatBoxType_entity_1[_0x5e726a(0x234)])),__param(0x3,(0x0,typeorm_2[_0x5e726a(0x219)])(chatBox_entity_1[_0x5e726a(0x262)])),__param(0x4,(0x0,typeorm_2[_0x5e726a(0x219)])(app_entity_1[_0x5e726a(0x298)])),__param(0x5,(0x0,typeorm_2['InjectRepository'])(chatPreType_entity_1[_0x5e726a(0x1ca)])),__param(0x6,(0x0,typeorm_2['InjectRepository'])(chatPre_entity_1['ChatPreEntity'])),__metadata(_0x5e726a(0x220),[typeorm_1[_0x5e726a(0x286)],typeorm_1[_0x5e726a(0x286)],typeorm_1[_0x5e726a(0x286)],typeorm_1[_0x5e726a(0x286)],typeorm_1[_0x5e726a(0x286)],typeorm_1['Repository'],typeorm_1[_0x5e726a(0x286)],nestjs_config_1['ConfigService'],userBalance_service_1[_0x5e726a(0x218)],chatLog_service_1['ChatLogService'],user_service_1[_0x5e726a(0x296)],upload_service_1[_0x5e726a(0x1c9)],badwords_service_1[_0x5e726a(0x27c)],autoreply_service_1[_0x5e726a(0x247)],globalConfig_service_1['GlobalConfigService'],fanyi_service_1[_0x5e726a(0x29a)],chatGroup_service_1[_0x5e726a(0x1e0)],models_service_1[_0x5e726a(0x272)]])],ChatgptService),exports[_0x5e726a(0x1ba)]=ChatgptService;