'use strict';const _0x4ca938=_0x2343;(function(_0x5b1f64,_0x40149a){const _0x1f5140=_0x2343,_0x1b6fa5=_0x5b1f64();while(!![]){try{const _0x5007d=parseInt(_0x1f5140(0xa2))/0x1+parseInt(_0x1f5140(0xe2))/0x2+-parseInt(_0x1f5140(0xa7))/0x3*(-parseInt(_0x1f5140(0xb2))/0x4)+-parseInt(_0x1f5140(0xb6))/0x5*(-parseInt(_0x1f5140(0xd3))/0x6)+parseInt(_0x1f5140(0xc7))/0x7+parseInt(_0x1f5140(0xaf))/0x8*(-parseInt(_0x1f5140(0xad))/0x9)+-parseInt(_0x1f5140(0xcc))/0xa;if(_0x5007d===_0x40149a)break;else _0x1b6fa5['push'](_0x1b6fa5['shift']());}catch(_0x554bc2){_0x1b6fa5['push'](_0x1b6fa5['shift']());}}}(_0x1027,0x7e952));var __decorate=this&&this[_0x4ca938(0xb7)]||function(_0x467a84,_0x183318,_0x4b7cc0,_0x407e41){const _0x43e928=_0x4ca938;var _0x212262=arguments[_0x43e928(0xce)],_0x41ed0b=_0x212262<0x3?_0x183318:_0x407e41===null?_0x407e41=Object['getOwnPropertyDescriptor'](_0x183318,_0x4b7cc0):_0x407e41,_0x1d573d;if(typeof Reflect===_0x43e928(0xcb)&&typeof Reflect['decorate']===_0x43e928(0xa3))_0x41ed0b=Reflect[_0x43e928(0xda)](_0x467a84,_0x183318,_0x4b7cc0,_0x407e41);else{for(var _0x3bee18=_0x467a84[_0x43e928(0xce)]-0x1;_0x3bee18>=0x0;_0x3bee18--)if(_0x1d573d=_0x467a84[_0x3bee18])_0x41ed0b=(_0x212262<0x3?_0x1d573d(_0x41ed0b):_0x212262>0x3?_0x1d573d(_0x183318,_0x4b7cc0,_0x41ed0b):_0x1d573d(_0x183318,_0x4b7cc0))||_0x41ed0b;}return _0x212262>0x3&&_0x41ed0b&&Object[_0x43e928(0xab)](_0x183318,_0x4b7cc0,_0x41ed0b),_0x41ed0b;},__metadata=this&&this[_0x4ca938(0xd7)]||function(_0x394114,_0xd119e7){const _0x303a12=_0x4ca938;if(typeof Reflect===_0x303a12(0xcb)&&typeof Reflect[_0x303a12(0xdb)]==='function')return Reflect['metadata'](_0x394114,_0xd119e7);},__param=this&&this[_0x4ca938(0xbc)]||function(_0x58c188,_0x783434){return function(_0x2dcbf7,_0x2a3bbc){_0x783434(_0x2dcbf7,_0x2a3bbc,_0x58c188);};};Object['defineProperty'](exports,_0x4ca938(0xb8),{'value':!![]}),exports['SigninService']=void 0x0;const globalConfig_service_1=require(_0x4ca938(0xb5)),userBalance_service_1=require(_0x4ca938(0xd5)),common_1=require(_0x4ca938(0xc4)),signIn_entity_1=require('./signIn.entity'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x4ca938(0xcd)),date_1=require(_0x4ca938(0xa0)),user_entity_1=require('../user/user.entity'),balance_constant_1=require(_0x4ca938(0xd9));let SigninService=class SigninService{constructor(_0x157486,_0x1021dc,_0x500069,_0x535336){const _0x1d4715=_0x4ca938;this['signinEntity']=_0x157486,this[_0x1d4715(0xb9)]=_0x1021dc,this[_0x1d4715(0xed)]=_0x500069,this[_0x1d4715(0xdf)]=_0x535336;}async[_0x4ca938(0xb3)](_0x11fb2e){const _0x27620c=_0x4ca938,{id:_0x319d7e}=_0x11fb2e[_0x27620c(0xea)],_0x5d3a97=(0x0,date_1[_0x27620c(0xb4)])(new Date())[_0x27620c(0xe1)](_0x27620c(0xa4)),_0x1d06f7=await this['signinEntity'][_0x27620c(0x9f)]({'where':{'userId':_0x319d7e,'signInDate':_0x5d3a97}});if(_0x1d06f7)throw new common_1[(_0x27620c(0xdc))](_0x27620c(0xe4),common_1[_0x27620c(0xcf)][_0x27620c(0xb1)]);const {model3Count:_0x5afae3,model4Count:_0x4057a0,drawMjCount:_0x49a46c}=await this[_0x27620c(0xdf)][_0x27620c(0xb0)]();await this[_0x27620c(0xbd)][_0x27620c(0xec)]({'userId':_0x319d7e,'signInTime':new Date(),'signInDate':_0x5d3a97,'isSigned':!![]}),await this['userBalanceService'][_0x27620c(0xc5)](_0x319d7e,{'model3Count':_0x5afae3,'model4Count':_0x4057a0,'drawMjCount':_0x49a46c}),await this['userBalanceService'][_0x27620c(0xc0)]({'userId':_0x319d7e,'rechargeType':balance_constant_1[_0x27620c(0xe3)][_0x27620c(0xdd)],'model3Count':_0x5afae3,'model4Count':_0x4057a0,'drawMjCount':_0x49a46c});const _0x5ec409=(0x0,date_1['default'])(new Date())[_0x27620c(0xa8)](0x1,_0x27620c(0xc3))[_0x27620c(0xe1)](_0x27620c(0xa4)),_0x379d18=await this[_0x27620c(0xbd)][_0x27620c(0x9f)]({'where':{'userId':_0x319d7e,'signInDate':_0x5ec409}});if(_0x379d18){common_1['Logger'][_0x27620c(0xd6)]('用户'+_0x319d7e+'昨天签到了、今天是连续签到！',_0x27620c(0xe0));const _0x65c04b=await this['userEntity'][_0x27620c(0x9f)]({'where':{'id':_0x319d7e}});if(!_0x65c04b)throw new common_1['HttpException'](_0x27620c(0xc8),common_1['HttpStatus']['BAD_REQUEST']);const {consecutiveDays:consecutiveDays=0x0}=_0x65c04b;await this[_0x27620c(0xb9)][_0x27620c(0xd1)]({'id':_0x319d7e},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x27620c(0xe7)][_0x27620c(0xd6)]('用户'+_0x319d7e+_0x27620c(0xc6),'SigninService'),await this['userEntity'][_0x27620c(0xd1)]({'id':_0x319d7e},{'consecutiveDays':0x1});return _0x27620c(0xd0);}async[_0x4ca938(0xbf)](_0x14cb7e){const _0x167821=_0x4ca938;try{const {id:_0x3b8fe3}=_0x14cb7e[_0x167821(0xea)],_0x4c866e=(0x0,date_1[_0x167821(0xb4)])()['startOf']('month')['format'](_0x167821(0xc2)),_0x11ab9a=(0x0,date_1[_0x167821(0xb4)])()[_0x167821(0xd2)]('month')[_0x167821(0xe1)](_0x167821(0xc2)),_0x329656=this[_0x167821(0xbd)][_0x167821(0xc1)](_0x167821(0xbb)),_0x3ea611=await _0x329656['select'](_0x167821(0xa5))[_0x167821(0xbe)](_0x167821(0xd8),{'userId':_0x14cb7e[_0x167821(0xea)]['id']})[_0x167821(0xbe)](_0x167821(0xde),{'firstDay':_0x4c866e})['andWhere'](_0x167821(0xe6),{'lastDay':_0x11ab9a})[_0x167821(0xac)](),_0x1193fa=new Date(_0x4c866e),_0x3cffbc=new Date(_0x11ab9a),_0x4f33c1=[],_0x143681=new Date(_0x1193fa);while(_0x143681<=_0x3cffbc){_0x4f33c1[_0x167821(0xe9)]((0x0,date_1[_0x167821(0xb4)])(new Date(_0x143681))[_0x167821(0xe1)](_0x167821(0xa4))),_0x143681[_0x167821(0xca)](_0x143681[_0x167821(0xd4)]()+0x1);}const _0x3d8994=[];for(const _0x3bd83e of _0x4f33c1){const _0x379ba4=_0x3ea611[_0x167821(0xa9)](_0x35fe04=>_0x35fe04[_0x167821(0xa6)]===_0x3bd83e);!_0x379ba4?_0x3d8994[_0x167821(0xe9)]({'signInDate':_0x3bd83e,'isSigned':![]}):(_0x379ba4[_0x167821(0xae)]=!![],_0x3d8994[_0x167821(0xe9)](_0x379ba4));}return _0x3d8994;}catch(_0x490781){console[_0x167821(0xc9)](_0x167821(0xa1),_0x490781);throw new common_1[(_0x167821(0xdc))]('获取签到数据失败！',common_1[_0x167821(0xcf)][_0x167821(0xb1)]);}}};function _0x2343(_0x121a9d,_0x583725){const _0x10270c=_0x1027();return _0x2343=function(_0x2343d5,_0x5e464d){_0x2343d5=_0x2343d5-0x9f;let _0x32312e=_0x10270c[_0x2343d5];return _0x32312e;},_0x2343(_0x121a9d,_0x583725);}function _0x1027(){const _0x4bcb09=['saveRecordRechargeLog','createQueryBuilder','YYYY-MM-DD\x20HH:mm:ss','day','@nestjs/common','addBalanceToUser','昨天没签到、今天重置天数！','4337095hHBGZz','用户不存在','log','setDate','object','21853050PfrWzJ','typeorm','length','HttpStatus','Sign\x20in\x20successful.','update','endOf','6nhMScn','getDate','./../userBalance/userBalance.service','debug','__metadata','signin.userId\x20=\x20:userId','../../common/constants/balance.constant','decorate','metadata','HttpException','SIGN_IN','signin.signInTime\x20>=\x20:firstDay','globalConfigService','SigninService','format','149124aoObeN','RechargeType','今日已签到、改天再来吧!.','GlobalConfigService','signin.signInTime\x20<=\x20:lastDay','Logger','UserEntity','push','user','InjectRepository','save','userBalanceService','Injectable','findOne','../../common/utils/date','error:\x20','726332rEPQhz','function','YYYY-MM-DD','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','signInDate','1230bDEIKC','subtract','find','SigninEntity','defineProperty','getRawMany','6084XNzDXt','isSigned','1840BePFcb','getSignatureGiftConfig','BAD_REQUEST','7684uRqNWE','sign','default','./../globalConfig/globalConfig.service','3255890rXSMru','__decorate','__esModule','userEntity','Repository','signin','__param','signinEntity','andWhere','getSigninLog'];_0x1027=function(){return _0x4bcb09;};return _0x1027();}SigninService=__decorate([(0x0,common_1[_0x4ca938(0xee)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1[_0x4ca938(0xaa)])),__param(0x1,(0x0,typeorm_1[_0x4ca938(0xeb)])(user_entity_1[_0x4ca938(0xe8)])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x4ca938(0xba)],userBalance_service_1['UserBalanceService'],globalConfig_service_1[_0x4ca938(0xe5)]])],SigninService),exports['SigninService']=SigninService;